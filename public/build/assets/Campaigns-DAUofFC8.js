var A=Object.defineProperty;var M=(r,n,c)=>n in r?A(r,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[n]=c;var j=(r,n,c)=>M(r,typeof n!="symbol"?n+"":n,c);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{B as q}from"./Base-DDgVAx9J.js";import{S as D}from"./SwitchFormGroup-CPKgKErd.js";import{T as F}from"./TextareaFormGroup-CgEriU3j.js";import{r as o}from"./index-BOnQTV8N.js";import{c as V}from"./ReactAppend-DTVVXReZ.js";import{S as z}from"./ProductCard-CwyKCVe-.js";import{B as O}from"./ModalImportItem-08p2KSos.js";import{I as S}from"./ImageFormGroup-BJgwOQgt.js";import{M as H}from"./Modal-D318Q6e0.js";import{T as J}from"./Table-DaiyF0kF.js";import{D as P}from"./DxButton-CsjWvhyj.js";import{C as K}from"./CreateReactScript-CrlrjA2p.js";import{R as w}from"./ReactAppend-D7S498fx.js";import{S as L}from"./SelectAPIFormGroup-ohdoPKKE.js";import{T as Q}from"./trash-2-DU7LB6-f.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BktTnHXY.js";import"./index-DE3dzT5W.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-BOnt0YF6.js";import"./main-Bp3JhiuO.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-BFMpZmqE.js";import"./index.esm-DFiNGWUA.js";/* empty css               */import"./General-BmbBKdsB.js";import"./createLucideIcon-DfjclApS.js";class U extends O{constructor(){super(...arguments);j(this,"path","admin/campaigns");j(this,"hasFiles",!0)}}const l=new U,W=()=>{const r=o.useRef(),n=o.useRef(),c=o.useRef(),h=o.useRef(),x=o.useRef(),b=o.useRef(),m=o.useRef(),d=o.useRef(),[T,R]=o.useState(!1),[C,v]=o.useState([]),y=e=>{e!=null&&e.id?R(!0):R(!1),h.current.value=(e==null?void 0:e.id)??"";const i=e.items||[];console.log(i),v(i),setTimeout(()=>{const s=i.map(a=>a.id.toString());c.current.setValue(s)},0),x.current.value=(e==null?void 0:e.name)??"",b.current.value=(e==null?void 0:e.description)??"",m.image.src=`/storage/images/campaign/${e==null?void 0:e.banner}`,m.current.value=null,d.image.src=`/storage/images/campaign/${e==null?void 0:e.image}`,d.current.value=null,$(n.current).modal("show")},E=async e=>{e.preventDefault();const i={id:h.current.value||void 0,name:x.current.value,description:b.current.value},s=new FormData;for(const g in i)s.append(g,i[g]);const a=d.current.files[0];a&&s.append("image",a);const u=m.current.files[0];u&&s.append("banner",u);const p=$(c.current).val();p&&p.forEach(g=>s.append("products[]",g)),await l.save(s)&&($(r.current).dxDataGrid("instance").refresh(),$(n.current).modal("hide"))},N=async({id:e,value:i})=>{await l.boolean({id:e,field:"featured",value:i})&&$(r.current).dxDataGrid("instance").refresh()},B=async({id:e,value:i})=>{await l.boolean({id:e,field:"visible",value:i})&&$(r.current).dxDataGrid("instance").refresh()},k=async e=>{const{isConfirmed:i}=await z.fire({title:"Eliminar registro",text:"¿Estas seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"Cancelar"});!i||!await l.delete(e)||$(r.current).dxDataGrid("instance").refresh()},I=e=>{const s=$(e.target).select2("data").map(a=>a.data);v(a=>{const u=a.map(f=>f.id),p=s.filter(f=>!u.includes(f.id));return[...a,...p]})},G=e=>{const i=C.filter(a=>a.id!==e);v(i);const s=i.map(a=>a.id.toString());$(c.current).val(s).trigger("change"),(mainProduct==null?void 0:mainProduct.id)===e&&setMainProduct(null)};return t.jsxs(t.Fragment,{children:[t.jsx(J,{gridRef:r,title:"Campañas",rest:l,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo registro",hint:"Nuevo registro",onClick:()=>y()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Camapaña",width:"30%"},{dataField:"description",caption:"Descripción",width:"50%"},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:i})=>{w(e,t.jsx("img",{src:`/storage/images/campaign/${i.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:s=>s.target.src="/api/cover/thumbnail/null"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),w(e,t.jsx(D,{checked:i.featured==1,onChange:()=>N({id:i.id,value:!i.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),w(e,t.jsx(D,{checked:i.visible==1,onChange:()=>B({id:i.id,value:!i.visible})}))}},{caption:"Acciones",cellTemplate:(e,{data:i})=>{e.css("text-overflow","unset"),e.append(P({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>y(i)})),e.append(P({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>k(i.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(H,{modalRef:n,title:T?"Editar Camapaña":"Agregar Camapaña",onSubmit:E,children:[t.jsx("input",{ref:h,type:"hidden"}),t.jsxs("div",{className:"row",id:"campaign-container",children:[t.jsxs("div",{className:"col-md-6",children:[t.jsx(S,{eRef:m,label:"Banner",col:"col-12",aspect:3/1}),t.jsx(S,{eRef:d,label:"Imagen",col:"col-12",aspect:16/9})]}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(F,{eRef:x,label:"Camapaña",rows:2,required:!0}),t.jsx(F,{eRef:b,label:"Descripción",rows:3})]}),t.jsx(L,{eRef:c,label:"Productos asociados",multiple:!0,searchAPI:"/api/admin/items/paginate",searchBy:"name",id:"items",dropdownParent:"#campaign-container",onChange:I})]}),t.jsxs("div",{className:"row",children:[t.jsx("h4",{children:"Productos Seleccionados"}),t.jsx("ul",{className:"list-unstyled col-md-12 row",children:C.map(e=>t.jsx("li",{className:"col-md-4",children:t.jsx("div",{children:t.jsx("div",{class:"card mb-3",children:t.jsxs("div",{class:"row g-0",children:[t.jsxs("div",{className:"position-relative d-inline-block ratio ratio-1x1 border rounded overflow-hidden",children:[t.jsx("img",{src:`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,className:"object-fit-cover w-100 h-100",alt:e.name,onError:i=>i.target.src="/api/cover/thumbnail/null"}),t.jsx("button",{className:"btn btn-sm btn-danger position-absolute top-0 end-0 m-1 d-inline-flex align-items-center justify-content-center",type:"button",onClick:()=>G(e.id),style:{width:"auto",height:"auto",padding:"0.25rem 0.5rem"},children:t.jsx(Q,{size:16})})]}),t.jsx("div",{class:"",children:t.jsx("div",{class:"card-body",children:t.jsxs("h5",{class:"card-title",children:[e==null?void 0:e.name," "]})})})]})})})},e.id))})]})]})]})};K((r,n)=>{V.createRoot(r).render(t.jsx(q,{...n,title:"Camapañas",children:t.jsx(W,{...n})}))});
