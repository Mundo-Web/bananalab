var ka=Object.defineProperty;var $a=(j,c,x)=>c in j?ka(j,c,{enumerable:!0,configurable:!0,writable:!0,value:x}):j[c]=x;var ne=(j,c,x)=>$a(j,typeof c!="symbol"?c+"":c,x);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ga}from"./Base-iD3WjR8i.js";import{S as Q}from"./SwitchFormGroup-zwNBvRf7.js";import{T as na}from"./TextareaFormGroup-CdwdsTk2.js";import{r as s}from"./index-BH53Isel.js";import{c as Ta}from"./ReactAppend-DTVVXReZ.js";import{s as Ae}from"./DxBox-CTFD8z_X.js";import{S as R}from"./ProductCard-Bvp3XiVT.js";import"./main-BvVILmTO.js";import{B as Ma}from"./ModalImportItem-edN7nyz1.js";import{M as Be}from"./Modal-BJ3DTV_x.js";import{T as Aa}from"./Table-cP0w99G1.js";import{I as k}from"./ImageFormGroup-Dx5myhwn.js";import{I as u}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ba}from"./QuillFormGroup-D8zDHSfJ.js";import{S as ia}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as la}from"./SelectFormGroup-BPkIDnvX.js";import{D as X}from"./DxButton-CsjWvhyj.js";import{C as Oa}from"./CreateReactScript-DSwc0KqF.js";import{N as Y}from"./Number2Currency-e57Tgsuk.js";import{R as F}from"./ReactAppend-D7S498fx.js";import{S as za}from"./SetSelectValue-UxyCmHse.js";import{I as Va}from"./ItemPresetsRest-DAo8oqYC.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./General-BmbBKdsB.js";const La=({label:j,structure:c,onChange:x,typeOptions:v=[]})=>{const[d,b]=s.useState([]),C=()=>{b(typeof c=="object"?[...d,{...c}]:[...d,""])},E=i=>{const h=d.filter((f,l)=>l!==i);b(h),x(h)},I=(i,h,f)=>{const l=[...d];typeof l[i]=="object"?l[i][h]=f:l[i]=f,b(l),x(l)};return e.jsxs("div",{className:"dynamic-field-container",children:[e.jsx("label",{className:"form-label",children:j}),e.jsx("div",{className:"fields-list",children:d.map((i,h)=>e.jsxs("div",{className:"field-row",children:[typeof i=="object"?Object.keys(c).map(f=>e.jsx("div",{className:"field-input",children:f==="type"?e.jsxs("select",{className:"form-select select-type",value:i[f],onChange:l=>I(h,f,l.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar..."}),v.map(l=>e.jsx("option",{value:l,children:l},l))]}):e.jsx("input",{type:"text",className:"form-control ",value:i[f],onChange:l=>I(h,f,l.target.value),placeholder:f.charAt(0).toUpperCase()+f.slice(1)})},f)):e.jsx("div",{className:"field-input",children:e.jsx("input",{type:"text",className:"form-control ",value:i,onChange:f=>I(h,null,f.target.value),placeholder:"Nueva característica"})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger remove-btn",onClick:()=>E(h),children:e.jsx("i",{className:"fas fa-times"})})]},h))}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary add-btn",onClick:C,children:[e.jsx("i",{className:"fas fa-plus me-1"})," Agregar"]}),e.jsx("style",{jsx:!0,children:`
                .dynamic-field-container {
                    margin-bottom: 1rem;
                }

                .fields-list {
                    margin-bottom: 0.5rem;
                }

                .field-row {
                    display: flex;
                    gap: 0.5rem;
                    margin-bottom: 0.5rem;
                    align-items: center;
                }

                .field-input {
                    flex: 1;
                }

                .remove-btn {
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 0;
                }

                .add-btn {
                    width: 100%;
                }
            `})]})};class ca extends Ma{constructor(){super(...arguments);ne(this,"path","admin/items");ne(this,"hasFiles",!0);ne(this,"importData",async x=>{console.log("FormData recibido en importData:",[...x.entries()]);try{const v=await fetch("/api/import-items",{method:"POST",body:x}),d=await v.json();if(console.log("Respuesta del servidor:",d),!v.ok)throw new Error((d==null?void 0:d.error)??(d==null?void 0:d.message)??"Error en la importación");return d}catch(v){throw console.error("Error en importData:",v.message),v}})}}const Ja=new ca,qa=({gridRef:j,modalRef:c})=>{const[x,v]=s.useState(null),[d,b]=s.useState(!1),[C,E]=s.useState(""),[I,i]=s.useState(!1),h=l=>{v(l.target.files[0])},f=async()=>{var P,y;if(!x){E("Por favor, selecciona un archivo."),i(!0);return}const l=new FormData;l.append("file",x),b(!0);try{const m=await Ja.importData(l);if(console.log(m),m.error){const S=Array.isArray(m.error)?m.error.join(`
`):m.error;E(`Error en la importación:
${S}`),i(!0)}else E(m.message),i(!1),$(j.current).dxDataGrid("instance").refresh(),c.current&&c.current.close()}catch(m){E("Error al importar: "+(((y=(P=m.response)==null?void 0:P.data)==null?void 0:y.error)||m.message)),i(!0)}b(!1)};return e.jsx("div",{className:"bg-white",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{children:e.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:h})}),e.jsx("button",{onClick:f,disabled:d,className:"btn btn-primary mt-2",type:"button",children:d?"Subiendo...":"Subir Archivo"}),C&&e.jsx("div",{className:`alert ${I?"alert-danger":"alert-success"} mt-2`,role:"alert",children:e.jsx("div",{className:"alert-message",children:C})})]})})},ie=new ca,D=new Va,Ua=({categories:j,brands:c,collections:x})=>{const[v,d]=s.useState([]),b=s.useRef(),C=s.useRef(),[E,I]=s.useState(!1),[i,h]=s.useState(null),[f,l]=s.useState([]),P=s.useRef(),y=s.useRef(),m=s.useRef(null),S=s.useRef(),le=s.useRef(),K=s.useRef(),ce=s.useRef(),G=s.useRef(),oe=s.useRef(),Z=s.useRef(),de=s.useRef(),A=s.useRef(),me=s.useRef(),B=s.useRef(),O=s.useRef(),z=s.useRef(),V=s.useRef(),ue=s.useRef(),fe=s.useRef(),pe=s.useRef(),he=s.useRef(),xe=s.useRef(),ge=s.useRef(),ve=s.useRef(),be=s.useRef(),je=s.useRef(),ye=s.useRef(),Ne=s.useRef(),[ee,oa]=s.useState(!1),[N,L]=s.useState("basic"),[da,ae]=s.useState(!1),[Oe,ze]=s.useState(!1),we=s.useRef(),Re=s.useRef(),Pe=s.useRef(),Ce=s.useRef(),Ie=s.useRef(),Se=s.useRef(),_e=s.useRef(),Fe=s.useRef(),De=s.useRef(),Ee=s.useRef(),re=s.useRef(),ke=s.useRef(),$e=s.useRef(),Ge=s.useRef();s.useRef([]);const[ma,ua]=s.useState(!1),[fa,pa]=s.useState(null),[ha,xa]=s.useState(null),[te,T]=s.useState([]),Ve=s.useRef(),[ga,va]=s.useState([]),[ba,Le]=s.useState([]),[Ha,Wa]=s.useState(!1),Je=s.useRef(),ja=async a=>{if(console.log("openPresetsModal called with item:",a),!a||!a.id){R.fire({title:"Error",text:"No se ha seleccionado un item válido para gestionar presets.",icon:"error"});return}console.log("Setting selectedItemForPresets:",a),h(a),m.current=a,I(!0),$(P.current).modal("show"),$(P.current).on("shown.bs.modal",async function(){console.log("Modal shown, loading presets for item:",a.id),await Ia(a.id),$(P.current).off("shown.bs.modal")})};s.useEffect(()=>{if(P.current){const a=P.current,r=()=>{if(y.current)try{const t=$(y.current).dxDataGrid("instance");t&&t.dispose()}catch(t){console.warn("Error disposing DataGrid:",t)}I(!1),h(null),m.current=null,l([])};return $(a).on("hidden.bs.modal",r),()=>{$(a).off("hidden.bs.modal",r)}}},[]),s.useEffect(()=>{const a=()=>{console.log("presetModal is opening - currentItemForPresetsRef:",m.current),console.log("presetModal is opening - selectedItemForPresets:",i)},r=()=>{console.log("presetModal is closing")};return $("#presetModal").on("shown.bs.modal",a),$("#presetModal").on("hidden.bs.modal",r),()=>{$("#presetModal").off("shown.bs.modal",a),$("#presetModal").off("hidden.bs.modal",r)}},[i]);const ya=a=>{const t=Array.from(a.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},Na=a=>{a.preventDefault();const t=Array.from(a.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},wa=a=>a.preventDefault(),Ra=(a,r)=>{a.preventDefault(),te[r].id?T(n=>n.map((g,w)=>w===r?{...g,toDelete:!0}:g)):T(n=>n.filter((g,w)=>w!==r))};s.useEffect(()=>{if(v&&v.images){const a=v.images.map(r=>({id:r.id,url:`/storage/images/item_image/${r.url}`}));T(a)}},[v]);const qe=a=>{var r,t;d(a||null),ua(!!(a!=null&&a.id)),we.current.value=(a==null?void 0:a.id)||"",$(Re.current).val((a==null?void 0:a.category_id)||null).trigger("change"),$(Pe.current).val((a==null?void 0:a.collection_id)||null).trigger("change"),za(Ce.current,(r=a==null?void 0:a.subcategory)==null?void 0:r.id,(t=a==null?void 0:a.subcategory)==null?void 0:t.name),$(Ie.current).val((a==null?void 0:a.brand_id)||null).trigger("change"),Se.current.value=(a==null?void 0:a.name)||"",_e.current.value=(a==null?void 0:a.color)||"",Fe.current.value=(a==null?void 0:a.summary)||"",De.current.value=(a==null?void 0:a.price)||0,Ee.current.value=(a==null?void 0:a.discount)||0,Ge.current.value=(a==null?void 0:a.stock)||0,re.current.value=null,re.image.src=`/storage/images/item/${(a==null?void 0:a.image)??"undefined"}`,ke.image.src=`/storage/images/item/${(a==null?void 0:a.texture)??"undefined"}`,$e.editor.root.innerHTML=(a==null?void 0:a.description)??"",va((a==null?void 0:a.features)||[]),Le((a==null?void 0:a.specifications)||[]),$(C.current).modal("show")},Pa=async a=>{a.preventDefault();const r={id:we.current.value||void 0,category_id:Re.current.value,collection_id:Pe.current.value||null,subcategory_id:Ce.current.value,brand_id:Ie.current.value,name:Se.current.value,color:_e.current.value,summary:Fe.current.value,price:De.current.value,discount:Ee.current.value,description:$e.current.value,stock:Ge.current.value},t=new FormData;for(const p in r)t.append(p,r[p]);t.append("features",JSON.stringify(ga)),t.append("specifications",JSON.stringify(ba));const n=re.current.files[0];n&&t.append("image",n);const g=ke.current.files[0];g&&t.append("texture",g),te.forEach((p,_)=>{p.toDelete||(p.file?t.append(`gallery[${_}]`,p.file):t.append(`gallery_ids[${_}]`,p.id))});const w=te.filter(p=>p.toDelete).map(p=>parseInt(p.id,10));w.length>0&&t.append("deleted_images",JSON.stringify(w)),await ie.save(t)&&($(b.current).dxDataGrid("instance").refresh(),$(C.current).modal("hide"),T([]))},Ca=async({id:a,value:r})=>{await ie.boolean({id:a,field:"visible",value:r})&&$(b.current).dxDataGrid("instance").refresh()},se=async({id:a,field:r,value:t})=>{await ie.boolean({id:a,field:r,value:t})&&$(b.current).dxDataGrid("instance").refresh()};function Ia(a){if(!a){console.warn("loadPresets called without itemId");return}console.log("loadPresets called with itemId:",a),ae(!0),l([]),D.getByItem(a).then(r=>{console.log("loadPresets result:",r);const t=r.data||[];l(t),setTimeout(()=>{console.log("Attempting to initialize presets grid with data:",t),Me(t)},300)}).catch(r=>{console.error("Error loading presets:",r),l([]),R.fire({title:"Error",text:"No se pudieron cargar los presets. Por favor, intenta nuevamente.",icon:"error"})}).finally(()=>{ae(!1)})}const Ue=(a=null,r=null)=>{var n,g,w,M,p,_,J,q,U,H,W;const t=r||i||m.current;if(!t||!t.id){R.fire({title:"Error",text:"No hay item seleccionado para gestionar presets. Por favor, selecciona un item válido.",icon:"error"});return}h(t),m.current=t,oa(!!(a!=null&&a.id)),L("basic"),S.current.value=(a==null?void 0:a.id)||"",le.current.value=(t==null?void 0:t.id)||"",K.current.value=(a==null?void 0:a.name)||"",ce.current.value=(a==null?void 0:a.description)||"",G.current.value=(a==null?void 0:a.price)||"",oe.current.value=(a==null?void 0:a.discount)||0,de.current.value=(a==null?void 0:a.sort_order)||0,A.current.value=a!=null&&a.configuration?JSON.stringify(a.configuration,null,2):"",me.current.checked=(a==null?void 0:a.is_active)!==!1,Z.current.value="",B.current&&(B.current.value=""),O.current&&(O.current.value=""),z.current&&(z.current.value=""),V.current&&(V.current.value=""),ue.current.value=((n=a==null?void 0:a.canvas_config)==null?void 0:n.width)||1e3,fe.current.value=((g=a==null?void 0:a.canvas_config)==null?void 0:g.height)||1e3,pe.current.value=((w=a==null?void 0:a.canvas_config)==null?void 0:w.dpi)||300,he.current.value=((M=a==null?void 0:a.canvas_config)==null?void 0:M.background_color)||"#ffffff",xe.current.value=((p=a==null?void 0:a.content_layer_config)==null?void 0:p.x)||0,ge.current.value=((_=a==null?void 0:a.content_layer_config)==null?void 0:_.y)||0,ve.current.value=((J=a==null?void 0:a.content_layer_config)==null?void 0:J.width)||1e3,be.current.value=((q=a==null?void 0:a.content_layer_config)==null?void 0:q.height)||1e3,je.current.value=((U=a==null?void 0:a.content_layer_config)==null?void 0:U.rotation)||0,ye.current.value=((H=a==null?void 0:a.content_layer_config)==null?void 0:H.opacity)||1,Ne.current.value=((W=a==null?void 0:a.content_layer_config)==null?void 0:W.fit_mode)||"cover",console.log("onPresetModalOpen - antes de mostrar modal, selectedItemForPresets:",i,"targetItem:",t),$("#presetModal").modal("show")},Te=a=>{if(console.log("updatePresetsGrid called with data:",a),!y.current){console.warn("presetsGridRef.current is null in updatePresetsGrid");return}try{const r=$(y.current).dxDataGrid("instance");r?(console.log("Updating existing DataGrid instance"),r.option("dataSource",a)):(console.log("No DataGrid instance found, initializing new one"),Me(a))}catch(r){console.warn("DataGrid instance not available, will initialize on next load",r)}},Me=a=>{if(console.log("initializePresetsGrid called with data:",a),!y.current){console.warn("presetsGridRef.current is null in initializePresetsGrid");return}if(!$(y.current).is(":visible")){console.warn("Grid element is not visible, retrying in 500ms"),setTimeout(()=>Me(a),500);return}try{const r=$(y.current).dxDataGrid("instance");if(r){console.log("DataGrid already initialized, updating data"),r.option("dataSource",a);return}}catch{console.log("No existing DataGrid instance found, creating new one")}console.log("Creating new DataGrid instance"),$(y.current).dxDataGrid({dataSource:a,keyExpr:"id",showBorders:!0,columnAutoWidth:!0,searchPanel:{visible:!0,placeholder:"Buscar presets..."},filterRow:{visible:!0},headerFilter:{visible:!0},paging:{enabled:!1},onContentReady:function(){console.log("DataGrid content ready with",a.length,"items")},columns:[{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"description",caption:"Descripción",width:"250px"},{dataField:"price",caption:"Precio",width:"80px",cellTemplate:(r,t)=>{r.text(`S/. ${Y(t.value)}`)}},{dataField:"discount",caption:"Descuento",width:"80px",cellTemplate:(r,t)=>{t.value>0?r.text(`S/. ${Y(t.value)}`):r.text("-")}},{caption:"Precio Final",width:"100px",cellTemplate:(r,t)=>{const n=t.data.discount>0?t.data.price-t.data.discount:t.data.price;r.html(`<span class="fw-bold text-success">S/. ${Y(n)}</span>`)}},{dataField:"sort_order",caption:"Orden",width:"70px"},{dataField:"is_active",caption:"Estado",width:"100px",cellTemplate:(r,t)=>{F(r,e.jsx("div",{className:"form-check form-switch",children:e.jsx("input",{className:"form-check-input",type:"checkbox",checked:t.value,onChange:n=>_a({id:t.data.id,value:n.target.checked})})}))}},{caption:"Acciones",width:"120px",allowFiltering:!1,allowSorting:!1,cellTemplate:(r,t)=>{F(r,e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(X,{text:"",icon:"edit",type:"default",stylingMode:"text",onClick:()=>{const n=i||m.current;console.log("Edit preset clicked - item:",n,"preset:",t.data),Ue(t.data,n)},hint:"Editar"}),e.jsx(X,{text:"",icon:"trash",type:"danger",stylingMode:"text",onClick:()=>Fa(t.data.id),hint:"Eliminar"})]}))}}]})},Sa=async a=>{var g,w,M,p,_,J,q,U,H,W,He,We,Qe,Xe,Ye,Ke,Ze,ea,aa,ra,ta;a.preventDefault();const r=i||m.current,t=(g=le.current)==null?void 0:g.value;console.log("onPresetSubmit - selectedItemForPresets:",i),console.log("onPresetSubmit - currentItemForPresetsRef.current:",m.current),console.log("onPresetSubmit - targetItem:",r),console.log("onPresetSubmit - itemIdFromForm:",t);const n=(r==null?void 0:r.id)||t;if(!n){R.fire({title:"Error",text:"No hay item seleccionado para asociar el preset. Por favor, cierra este modal y vuelve a abrir desde el botón 'Gestionar Presets' del item deseado.",icon:"error"});return}ze(!0);try{if(!((M=(w=K.current)==null?void 0:w.value)!=null&&M.trim()))throw new Error("El nombre es obligatorio");if(!((p=G.current)!=null&&p.value)||isNaN(parseFloat(G.current.value)))throw new Error("El precio debe ser un número válido");if(parseFloat(G.current.value)<0)throw new Error("El precio no puede ser negativo");const o=new FormData;if((_=S.current)!=null&&_.value&&o.append("id",S.current.value),o.append("item_id",n),o.append("name",K.current.value.trim()),o.append("description",ce.current.value||""),o.append("price",G.current.value),o.append("discount",oe.current.value||0),o.append("sort_order",de.current.value||0),o.append("is_active",me.current.checked?1:0),A.current.value.trim())try{JSON.parse(A.current.value),o.append("configuration",A.current.value)}catch{throw new Error("La configuración debe ser un JSON válido")}Z.current.files[0]&&o.append("image",Z.current.files[0]),(J=B.current)!=null&&J.files[0]&&o.append("cover_image",B.current.files[0]),(q=O.current)!=null&&q.files[0]&&o.append("content_layer_image",O.current.files[0]),(U=z.current)!=null&&U.files[0]&&o.append("final_layer_image",z.current.files[0]),(H=V.current)!=null&&H.files[0]&&o.append("preview_image",V.current.files[0]);const Da={width:parseInt((W=ue.current)==null?void 0:W.value)||1e3,height:parseInt((He=fe.current)==null?void 0:He.value)||1e3,dpi:parseInt((We=pe.current)==null?void 0:We.value)||300,background_color:((Qe=he.current)==null?void 0:Qe.value)||"#ffffff",format:"JPEG",quality:90};o.append("canvas_config",JSON.stringify(Da));const Ea={x:parseInt((Xe=xe.current)==null?void 0:Xe.value)||0,y:parseInt((Ye=ge.current)==null?void 0:Ye.value)||0,width:parseInt((Ke=ve.current)==null?void 0:Ke.value)||1e3,height:parseInt((Ze=be.current)==null?void 0:Ze.value)||1e3,rotation:parseFloat((ea=je.current)==null?void 0:ea.value)||0,opacity:parseFloat((aa=ye.current)==null?void 0:aa.value)||1,blend_mode:"normal",fit_mode:((ra=Ne.current)==null?void 0:ra.value)||"cover",allow_upload:!0,max_file_size:10,allowed_formats:["jpg","jpeg","png","gif"]};o.append("content_layer_config",JSON.stringify(Ea)),ee&&((ta=S.current)!=null&&ta.value)?await D.updateForItem(n,S.current.value,o):await D.saveForItem(n,o),ae(!0);const sa=await D.getByItem(n);l(sa.data||[]),Te(sa.data||[]),ae(!1),$("#presetModal").modal("hide"),R.fire({title:"¡Éxito!",text:`Preset ${ee?"actualizado":"creado"} correctamente`,icon:"success",timer:2e3})}catch(o){R.fire({title:"Error",text:o.message||"Error al guardar el preset",icon:"error"})}finally{ze(!1)}},_a=async({id:a,value:r})=>{try{await D.toggleStatusForItem(i.id,a);const t=await D.getByItem(i.id);l(t.data||[]),Te(t.data||[]),R.fire({title:"¡Éxito!",text:`Preset ${r?"activado":"desactivado"} correctamente`,icon:"success",timer:2e3})}catch{R.fire({title:"Error",text:"Error al cambiar el estado del preset",icon:"error"})}},Fa=async a=>{if((await R.fire({title:"¿Estás seguro?",text:"Esta acción eliminará permanentemente el preset",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await D.deleteForItem(i.id,a);const t=await D.getByItem(i.id);l(t.data||[]),Te(t.data||[]),R.fire({title:"¡Eliminado!",text:"El preset ha sido eliminado correctamente",icon:"success",timer:2e3})}catch{R.fire({title:"Error",text:"Error al eliminar el preset",icon:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Aa,{gridRef:b,title:"Items",rest:ie,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(b.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>qe()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>onModalImportOpen()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(a,{data:r})=>{var t,n,g;a.html(Ae.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block fst-italic text-muted",children:(t=r.collection)==null?void 0:t.name}),e.jsx("b",{className:"d-block",children:(n=r.category)==null?void 0:n.name}),e.jsx("small",{className:"text-muted",children:(g=r.subcategory)==null?void 0:g.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(a,{data:r})=>{a.html(Ae.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{children:r.name}),e.jsx("br",{}),e.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(a,{data:r})=>{a.html(Ae.renderToString(e.jsxs(e.Fragment,{children:[r.discount>0&&e.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",Y(r.price)]}),e.jsxs("span",{children:["S/.",Y(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(a,{data:r})=>{F(a,e.jsx("img",{src:`/storage/images/item/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:t=>t.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{F(a,e.jsx(Q,{checked:r.is_new,onChange:t=>se({id:r.id,field:"is_new",value:t.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{F(a,e.jsx(Q,{checked:r.offering,onChange:t=>se({id:r.id,field:"offering",value:t.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{F(a,e.jsx(Q,{checked:r.recommended,onChange:t=>se({id:r.id,field:"recommended",value:t.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{F(a,e.jsx(Q,{checked:r.featured,onChange:t=>se({id:r.id,field:"featured",value:t.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{F(a,e.jsx(Q,{checked:r.visible,onChange:t=>Ca({id:r.id,value:t.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(a,{data:r})=>{a.css("text-overflow","unset"),a.append(X({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>qe(r)})),a.append(X({className:"btn btn-xs btn-soft-info",title:"Gestionar Presets",icon:"fa fa-layer-group",onClick:()=>ja(r)})),a.append(X({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(Be,{modalRef:C,title:ma?"Editar Item":"Agregar Item",onSubmit:Pa,size:"xl",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",id:"principal-container",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Información Básica"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("input",{ref:we,type:"hidden"}),e.jsx(la,{eRef:Pe,label:"Colección",dropdownParent:"#principal-container",onChange:a=>xa(a.target.value),children:x.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(ia,{onChange:a=>pa(a.target.value),eRef:Re,label:"Categoría",searchAPI:"/api/admin/categories/paginate",searchBy:"name",filter:["collection_id","=",ha],dropdownParent:"#principal-container"}),e.jsx(ia,{eRef:Ce,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",fa],dropdownParent:"#principal-container"}),e.jsx(la,{eRef:Ie,label:"Marca",required:!0,dropdownParent:"#principal-container",children:c.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(u,{eRef:Se,label:"Nombre",required:!0}),e.jsx(u,{eRef:_e,label:"Color",required:!0}),e.jsx(na,{eRef:Fe,label:"Resumen",rows:3,required:!0})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Precios y Stock"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(u,{eRef:De,label:"Precio",type:"number",step:"0.01",required:!0}),e.jsx(u,{eRef:Ee,label:"Descuento",type:"number",step:"0.01"}),e.jsx(u,{label:"Stock",eRef:Ge,type:"number"})]})]})]})}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Especificaciones"})}),e.jsx("div",{className:"card-body",children:e.jsx(La,{onChange:Le,label:"Especificaciones",structure:{type:"",title:"",description:""},typeOptions:["General","Principal"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Imágenes"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:re,label:"Imagen Principal",aspect:1})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:ke,label:"Textura",aspect:1})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Galería de Imágenes"}),e.jsx("input",{id:"input-item-gallery",ref:Ve,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:ya}),e.jsx("div",{className:"gallery-upload-area",onClick:()=>Ve.current.click(),onDrop:Na,onDragOver:wa,children:e.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})}),e.jsx("div",{className:"gallery-preview mt-2",children:te.map((a,r)=>e.jsxs("div",{className:"gallery-thumbnail",children:[e.jsx("img",{src:`${a.url}`,alt:"preview"}),e.jsx("button",{className:"btn btn-xs btn-danger gallery-remove-btn",onClick:t=>Ra(t,r),children:"×"})]},r))})]})]})]})]})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Descripción Completa"})}),e.jsx("div",{className:"card-body",children:e.jsx(Ba,{eRef:$e,label:""})})]})]}),e.jsx(Be,{modalRef:Je,title:"Importar Datos",size:"sm",children:e.jsx(qa,{gridRef:b,modalRef:Je})}),e.jsxs(Be,{modalRef:P,title:`Gestión de Presets - ${(i==null?void 0:i.name)||""}`,size:"xl",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:["Presets de ",i==null?void 0:i.name]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>{const a=i||m.current;console.log("Nuevo Preset button clicked - currentItem:",a),Ue(null,a)},children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Nuevo Preset"]})]})})}),e.jsx("div",{className:"table-responsive",children:da?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fa fa-spinner fa-spin fa-2x"}),e.jsx("p",{className:"mt-2",children:"Cargando presets..."})]}):e.jsx("div",{ref:y,style:{height:"400px"}})})]}),e.jsx("div",{className:"modal fade",id:"presetModal",tabIndex:"-1","aria-labelledby":"presetModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"presetModalLabel",children:ee?"Editar Preset":"Nuevo Preset"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("form",{onSubmit:Sa,children:[e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{ref:S,type:"hidden",name:"id"}),e.jsx("input",{ref:le,type:"hidden",name:"item_id"}),e.jsxs("ul",{className:"nav nav-tabs mb-3",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${N==="basic"?"active":""}`,onClick:()=>L("basic"),href:"#",children:"Información Básica"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${N==="design"?"active":""}`,onClick:()=>L("design"),href:"#",children:"Capas de Diseño"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${N==="canvas"?"active":""}`,onClick:()=>L("canvas"),href:"#",children:"Configuración Canvas"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${N==="content"?"active":""}`,onClick:()=>L("content"),href:"#",children:"Área de Contenido"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:`tab-pane fade ${N==="basic"?"show active":""}`,style:{display:N==="basic"?"block":"none"},children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(u,{eRef:K,name:"name",label:"Nombre del Preset",placeholder:"Ej: Álbum Premium 30x30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:G,name:"price",label:"Precio",type:"number",step:"0.01",min:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:oe,name:"discount",label:"Descuento (%)",type:"number",step:"0.01",min:"0",max:"100"})})]}),e.jsx(na,{eRef:ce,name:"description",label:"Descripción",placeholder:"Descripción del preset...",rows:3}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:Z,name:"image",label:"Imagen Principal del Preset"})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:V,name:"preview_image",label:"Imagen de Vista Previa"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:de,name:"sort_order",label:"Orden",type:"number",min:"0",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{ref:me,className:"form-check-input",type:"checkbox",defaultChecked:!0}),e.jsx("label",{className:"form-check-label",children:"Activo"})]})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Configuración Adicional (JSON)"}),e.jsx("textarea",{ref:A,className:"form-control",rows:"4",placeholder:'{"pages": 50, "size": "30x30", "cover": "hardcover"}'}),e.jsx("small",{className:"form-text text-muted",children:"Configuración técnica en formato JSON (opcional)"})]})]}),e.jsx("div",{className:`tab-pane fade ${N==="design"?"show active":""}`,style:{display:N==="design"?"block":"none"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Portada (Cover)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:B,name:"cover_image",label:"Imagen de Portada"}),e.jsx("small",{className:"text-muted",children:"Esta es la imagen de fondo que aparecerá en el editor"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Contenido"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:O,name:"content_layer_image",label:"Imagen de Contenido"}),e.jsx("small",{className:"text-muted",children:"Capa intermedia donde el usuario subirá su imagen"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa Final (Tapa)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:z,name:"final_layer_image",label:"Imagen de Tapa Final"}),e.jsx("small",{className:"text-muted",children:"Esta es la capa superior que se superpone al contenido"})]})]})})]})}),e.jsxs("div",{className:`tab-pane fade ${N==="canvas"?"show active":""}`,style:{display:N==="canvas"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Canvas"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:ue,name:"canvas_width",label:"Ancho (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:fe,name:"canvas_height",label:"Alto (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:pe,name:"canvas_dpi",label:"DPI (puntos por pulgada)",type:"number",min:"72",defaultValue:"300"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Color de Fondo"}),e.jsx("input",{ref:he,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})})]}),e.jsx("div",{className:"mb-2",children:e.jsx("small",{className:"form-text text-muted",children:"El tamaño del canvas se ingresa en centímetros. El valor DPI recomendado para impresión es 300."})})]}),e.jsxs("div",{className:`tab-pane fade ${N==="content"?"show active":""}`,style:{display:N==="content"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Área de Contenido del Usuario"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:xe,name:"content_x",label:"Posición X",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:ge,name:"content_y",label:"Posición Y",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:ve,name:"content_width",label:"Ancho",type:"number",min:"1",defaultValue:"1000"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:be,name:"content_height",label:"Alto",type:"number",min:"1",defaultValue:"1000"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:je,name:"content_rotation",label:"Rotación (grados)",type:"number",min:"-360",max:"360",step:"0.1",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(u,{eRef:ye,name:"content_opacity",label:"Opacidad",type:"number",min:"0",max:"1",step:"0.1",defaultValue:"1"})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Modo de Ajuste"}),e.jsxs("select",{ref:Ne,className:"form-control",children:[e.jsx("option",{value:"cover",children:"Cover (cubrir área)"}),e.jsx("option",{value:"contain",children:"Contain (ajustar manteniendo aspecto)"}),e.jsx("option",{value:"fill",children:"Fill (estirar para llenar)"}),e.jsx("option",{value:"none",children:"None (tamaño original)"})]})]})})]})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:Oe,children:Oe?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-spinner fa-spin me-2"}),"Guardando..."]}):`${ee?"Actualizar":"Crear"} Preset`})]})]})]})})}),e.jsx("style",{jsx:!0,children:`
                .gallery-upload-area {
                    border: 2px dashed #ccc;
                    padding: 0px;
                    text-align: center;
                    cursor: pointer;
                    border-radius: 4px;
                    box-shadow: 2.5px 2.5px 5px rgba(0, 0, 0, 0.125);

                    height: 100px;
                    width: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f8f9fa;
                    transition: all 0.3s ease;
                }

                .gallery-upload-area:hover {
                    border-color: #0d6efd;
                    background-color: #e9f0ff;
                }

                .gallery-preview {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                }

                .gallery-thumbnail {
                    position: relative;
                    width: 80px;
                    height: 80px;
                    border-radius: 4px;
                    overflow: hidden;
                }

                .gallery-thumbnail img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .gallery-remove-btn {
                    position: absolute;
                    top: 0;
                    right: 0;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                }
            `})]})};Oa((j,c)=>{Ta.createRoot(j).render(e.jsx(Ga,{...c,title:"Items",children:e.jsx(Ua,{...c})}))});
