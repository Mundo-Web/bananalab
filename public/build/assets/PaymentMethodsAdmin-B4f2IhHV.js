var ie=Object.defineProperty;var le=(u,g,l)=>g in u?ie(u,g,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[g]=l;var x=(u,g,l)=>le(u,typeof g!="symbol"?g+"":g,l);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as me}from"./Base-BEMHs2oE.js";import{S as A}from"./SwitchFormGroup-CPKgKErd.js";import{T as de}from"./TextareaFormGroup-CgEriU3j.js";import{r as p}from"./index-BOnQTV8N.js";import{c as pe}from"./ReactAppend-DTVVXReZ.js";import{s as B}from"./DxBox-C2WMS09E.js";import{S as v}from"./ProductCard-CwyKCVe-.js";import{B as ue}from"./ModalImportItem-08p2KSos.js";import{M as fe}from"./Modal-D318Q6e0.js";import{T as ge}from"./Table-DaiyF0kF.js";import{I as J}from"./ImageFormGroup-BJgwOQgt.js";import{I as q}from"./InputFormGroup-BRr_So2P.js";import{S as he}from"./SelectFormGroup-D5ZAG8Pz.js";import{D as Q}from"./DxButton-CsjWvhyj.js";import{C as xe}from"./CreateReactScript-CrlrjA2p.js";import{N as je}from"./Number2Currency-e57Tgsuk.js";import{R as be}from"./ReactAppend-D7S498fx.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BktTnHXY.js";import"./index-DE3dzT5W.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-BOnt0YF6.js";import"./main-Bp3JhiuO.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./MenuItemContainer-BFMpZmqE.js";import"./index.esm-DFiNGWUA.js";/* empty css               */import"./General-BmbBKdsB.js";class ye extends ue{constructor(){super(...arguments);x(this,"path","admin/payment-methods");x(this,"hasFiles",!0);x(this,"toggleStatus",async l=>{var m;try{const n=await fetch(`/api/admin/payment-methods/${l}/toggle`,{method:"PATCH",headers:{"X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")}}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.message)??"Error cambiando estado");return c}catch(n){throw console.error("Error en toggleStatus:",n.message),n}});x(this,"reorder",async l=>{var m;try{const n=await fetch("/api/admin/payment-methods/reorder",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")},body:JSON.stringify({methods:l})}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.message)??"Error reordenando m√©todos");return c}catch(n){throw console.error("Error en reorder:",n.message),n}});x(this,"getTemplates",async()=>{try{const l=await fetch("/api/admin/payment-methods/templates"),m=await l.json();if(!l.ok)throw new Error((m==null?void 0:m.message)??"Error obteniendo plantillas");return m}catch(l){throw console.error("Error en getTemplates:",l.message),l}});x(this,"store",async l=>{var m;try{const n=await fetch(`/api/${this.path}`,{method:"POST",headers:{"X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")},body:l}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.message)??"Error creando m√©todo de pago");return c}catch(n){throw console.error("Error en store:",n.message),n}});x(this,"update",async l=>{var m;try{const n=l.get("id");if(!n)throw new Error("ID es requerido para actualizar");l.append("_method","PUT");const c=await fetch(`/api/${this.path}/${n}`,{method:"POST",headers:{"X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")},body:l}),h=await c.json();if(!c.ok)throw new Error((h==null?void 0:h.message)??"Error actualizando m√©todo de pago");return h}catch(n){throw console.error("Error en update:",n.message),n}});x(this,"destroy",async l=>{var m;try{const n=await fetch(`/api/${this.path}/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")}}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.message)??"Error eliminando m√©todo de pago");return c}catch(n){throw console.error("Error en destroy:",n.message),n}});x(this,"list",async l=>{var m;try{const n=await fetch(`/api/${this.path}/paginate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content")},body:JSON.stringify(l)}),c=await n.json();if(!n.ok)throw new Error((c==null?void 0:c.message)??"Error obteniendo m√©todos de pago");return c}catch(n){throw console.error("Error en list:",n.message),n}})}}const N=new ye,Ne=()=>{const u=p.useRef(),g=p.useRef(),l=p.useRef(),m=p.useRef(),n=p.useRef(),c=p.useRef(),h=p.useRef(),T=p.useRef(),E=p.useRef(),S=p.useRef(),_=p.useRef(),y=p.useRef(),R=p.useRef(),F=p.useRef({}),[w,U]=p.useState(!1),[f,G]=p.useState({}),[we,P]=p.useState("gateway"),[k,I]=p.useState(""),[j,X]=p.useState(null);p.useEffect(()=>{z()},[]);const z=async()=>{try{const r=await N.getTemplates();r.status&&G(r.templates)}catch(r){console.error("Error loading templates:",r)}},D=async r=>{console.log("üöÄ Opening modal with data:",r),X(r||null),U(!!(r!=null&&r.id));let t=f,s=!1;if(!t||Object.keys(t).length===0){console.log("‚è≥ Templates not loaded, fetching directly...");try{const i=await N.getTemplates();i.status?(t=i.templates,G(t),s=!0,console.log("‚úÖ Templates loaded directly:",Object.keys(t))):(console.error("‚ùå Failed to load templates:",i),t={})}catch(i){console.error("‚ùå Error loading templates:",i),t={}}}const o=(r==null?void 0:r.template_key)||"";let a=(r==null?void 0:r.configuration)||{};if(typeof a=="string")try{a=JSON.parse(a),console.log("‚úÖ Parsed configuration JSON:",a)}catch{console.warn("‚ö†Ô∏è Could not parse configuration JSON:",a),a={}}console.log("üìã Template key:",o),console.log("üîß Configuration data:",a),console.log("üìä Available templates:",Object.keys(t)),F.current=a,V(r),r!=null&&r.type&&P(r.type),o&&I(o),$(g.current).modal("show"),setTimeout(async()=>{console.log("üîÑ Setting up dynamic fields..."),h.current&&$(h.current).val((r==null?void 0:r.type)||"gateway").trigger("change"),await new Promise(i=>setTimeout(i,300)),o&&t[o]&&Object.keys(a).length>0?(console.log("üéØ Populating configuration fields..."),await L(o,a,t)):(console.log("‚ÑπÔ∏è No configuration data to populate or template not found"),console.log("üìã Debug info:",{templateKey:o,hasTemplate:!!t[o],configDataKeys:Object.keys(a),availableTemplateKeys:Object.keys(t)})),Y(o,t)},s?800:500)},V=r=>{console.log("üìù Populating basic fields..."),l.current&&(l.current.value=(r==null?void 0:r.id)||""),m.current&&(m.current.value=(r==null?void 0:r.name)||""),n.current&&(n.current.value=(r==null?void 0:r.display_name)||""),c.current&&(c.current.value=(r==null?void 0:r.description)||""),T.current&&(T.current.checked=(r==null?void 0:r.is_active)??!0),E.current&&(E.current.checked=(r==null?void 0:r.requires_proof)??!1),S.current&&(S.current.value=(r==null?void 0:r.fee_percentage)||0),_.current&&(_.current.value=(r==null?void 0:r.fee_fixed)||0),R.current&&(R.current.value=(r==null?void 0:r.sort_order)||0),y.current&&(y.current.value=null,y.image&&(y.image.src=r!=null&&r.icon?`/storage/payment_icons/${r.icon}`:"/storage/images/item/undefined"))},Y=(r,t=f)=>{setTimeout(()=>{const s=document.getElementById("instructions-preview-container");if(s){const o=t[r];o&&o.instructions?s.style.display="block":s.style.display="none"}},200)},L=async(r,t,s=f)=>{const o=s[r];if(!o||!o.config){console.warn("‚ùå Template or config not found for templateKey:",r),console.warn("üìã Available templates:",Object.keys(s));return}return console.log("üîß Starting robust config field population for template:",r),console.log("üìä Config data to populate:",t),console.log("üèóÔ∏è Template structure:",o.config),new Promise(a=>{const d=(i=1)=>{console.log(`üîç Population attempt ${i}/25`);const ce=Object.keys(o.config),O=[],C=[];if(ce.forEach(M=>{document.getElementById(`config_${M}`)?C.push(M):O.push(M)}),console.log(`‚úÖ Available fields (${C.length}):`,C),console.log(`‚ùå Missing fields (${O.length}):`,O),O.length===0){console.log("üéØ All fields found! Populating values..."),H(o,t),a(!0);return}i<25?(console.log("‚è≥ Waiting 300ms before retry..."),setTimeout(()=>d(i+1),300)):(console.warn("üö® Max attempts reached. Populating available fields only."),H(o,t),a(!1))};setTimeout(()=>d(),100)})},H=(r,t)=>{console.log("ÔøΩ Populating configuration fields with data:",t),Object.keys(r.config).forEach(s=>{const o=document.getElementById(`config_${s}`),a=r.config[s],d=t[s]||a.default||"";if(!o){console.warn(`‚ö†Ô∏è Element config_${s} not found during population`);return}console.log(`üìù Setting field ${s} =`,d),o.type==="checkbox"?o.checked=!!d:o.type==="file"?W(o,s,d,a):o.value=d}),console.log("‚úÖ Configuration field population completed")},W=(r,t,s,o)=>{const a=r.closest("[data-image-form-group]");if(a&&o.accept&&o.accept.includes("image")){console.log(`üñºÔ∏è Populating ImageFormGroup for ${t} with value:`,s);const d=a.querySelector("img");if(s&&s!==""){d&&(d.src=`/storage/payment_config/${s}`,d.style.display="block",console.log(`‚úÖ Image preview set for ${t}:`,`/storage/payment_config/${s}`));let i=a.querySelector(".config-file-info");i||(i=document.createElement("div"),i.className="config-file-info mt-2",a.appendChild(i)),i.innerHTML=`<small class="text-success"><i class="mdi mdi-check-circle"></i> Archivo actual: <strong>${s}</strong></small>`}else{d&&(d.src="/api/cover/thumbnail/null",d.style.display="block");const i=a.querySelector(".config-file-info");i&&i.remove()}}else{console.log(`üìé Populating regular file field ${t} with value:`,s);let d=document.getElementById(`config_${t}_info`);d||(d=document.createElement("div"),d.id=`config_${t}_info`,d.className="mt-2",r.parentNode.appendChild(d)),s&&s!==""?d.innerHTML=`<small class="text-success"><i class="mdi mdi-check-circle"></i> Archivo actual: <strong>${s}</strong></small>`:d.innerHTML='<small class="text-muted">No hay archivo subido</small>'}},Z=async r=>{r.preventDefault();const t=new FormData;w&&l.current&&t.append("id",l.current.value),m.current&&t.append("name",m.current.value),n.current&&t.append("display_name",n.current.value),c.current&&t.append("description",c.current.value),h.current&&t.append("type",h.current.value),T.current&&t.append("is_active",T.current.checked?1:0),E.current&&t.append("requires_proof",E.current.checked?1:0),S.current&&t.append("fee_percentage",S.current.value),_.current&&t.append("fee_fixed",_.current.value),R.current&&t.append("sort_order",R.current.value),y.current&&y.current.files[0]&&t.append("icon",y.current.files[0]);const s={},o={},a=f[k];a&&a.config&&Object.keys(a.config).forEach(i=>{const b=document.getElementById(`config_${i}`);b&&(b.type==="checkbox"?s[i]=b.checked:b.type==="file"&&b.files[0]?(o[i]=b.files[0],s[i]=b.files[0].name):s[i]=b.value)}),t.append("template_key",k),t.append("configuration",JSON.stringify(s)),Object.keys(o).forEach(i=>{t.append(`config_files[${i}]`,o[i])});const d=(a==null?void 0:a.instructions)||{};t.append("instructions",JSON.stringify(d));try{(w?await N.update(t):await N.store(t))&&(g.current&&$(g.current).modal("hide"),u.current&&$(u.current).dxDataGrid("instance").refresh(),v.fire({title:"¬°√âxito!",text:`M√©todo de pago ${w?"actualizado":"creado"} correctamente`,icon:"success"}))}catch(i){v.fire({title:"Error",text:i.message||"Error guardando m√©todo de pago",icon:"error"})}},K=async({id:r,value:t})=>{try{await N.toggleStatus(r),u.current&&$(u.current).dxDataGrid("instance").refresh()}catch(s){v.fire({title:"Error",text:s.message||"Error cambiando estado",icon:"error"})}},ee=async r=>{if((await v.fire({title:"¬øEst√°s seguro?",text:"Esta acci√≥n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await N.destroy(r),u.current&&$(u.current).dxDataGrid("instance").refresh(),v.fire({title:"¬°Eliminado!",text:"M√©todo de pago eliminado correctamente",icon:"success"})}catch(s){v.fire({title:"Error",text:s.message||"Error eliminando m√©todo de pago",icon:"error"})}},re=r=>{const t=r.target.value;P(t);const s=Object.keys(f).find(o=>f[o].type===t);s&&(I(s),F.current={},updateConfigurationFields(s,{}),setTimeout(()=>{const o=document.getElementById("instructions-preview-container");if(o){const a=f[s];a&&a.instructions?o.style.display="block":o.style.display="none"}},100))},te=()=>{const r=f[k];return!r||!r.config?k?null:e.jsxs("div",{className:"alert alert-warning mt-4 mb-0",children:[e.jsx("i",{className:"mdi mdi-information"})," Seleccione un m√©todo de pago espec√≠fico para ver sus campos de configuraci√≥n."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsx("h5",{className:"mb-3",children:"Configuraci√≥n espec√≠fica"})}),Object.entries(r.config).map(([t,s])=>e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsxs("label",{className:"form-label",children:[s.label,s.required&&e.jsx("span",{className:"text-danger",children:"*"})]}),oe(t,s)]},t))]}),"                ",r.instructions&&e.jsx("div",{className:"row mt-4",id:"instructions-preview-container",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-info",children:[e.jsxs("div",{className:"card-header bg-light",children:[e.jsxs("h6",{className:"mb-0 text-info",children:[e.jsx("i",{className:"mdi mdi-information-outline me-2"}),"Vista previa de instrucciones para el usuario"]}),e.jsx("small",{className:"text-muted",children:"Estas son las instrucciones que ver√°n los usuarios al seleccionar este m√©todo de pago"})]}),e.jsx("div",{className:"card-body bg-light",children:se(r.instructions)})]})})})]})},se=r=>e.jsxs("div",{className:"instructions-preview",children:[r.title&&e.jsx("div",{className:"mb-3",children:e.jsxs("h6",{className:"text-primary mb-2",children:[e.jsx("i",{className:"mdi mdi-format-title me-1"}),r.title]})}),r.bank_info&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{className:"text-success",children:[e.jsx("i",{className:"mdi mdi-bank me-1"}),"Datos bancarios:"]}),e.jsx("div",{className:"bg-white p-2 rounded border mt-2",children:e.jsx("ul",{className:"list-unstyled mb-0",children:r.bank_info.map((t,s)=>e.jsx("li",{className:"mb-1",dangerouslySetInnerHTML:{__html:t}},s))})})]}),r.contact_info&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{className:"text-info",children:[e.jsx("i",{className:"mdi mdi-phone me-1"}),"Informaci√≥n de contacto:"]}),e.jsx("div",{className:"bg-white p-2 rounded border mt-2",children:e.jsx("ul",{className:"list-unstyled mb-0",children:r.contact_info.map((t,s)=>e.jsx("li",{className:"mb-1",dangerouslySetInnerHTML:{__html:t}},s))})})]}),r.account_info&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{className:"text-warning",children:[e.jsx("i",{className:"mdi mdi-account me-1"}),"Datos de la cuenta:"]}),e.jsx("div",{className:"bg-white p-2 rounded border mt-2",children:e.jsx("ul",{className:"list-unstyled mb-0",children:r.account_info.map((t,s)=>e.jsx("li",{className:"mb-1",dangerouslySetInnerHTML:{__html:t}},s))})})]}),r.steps&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{className:"text-primary",children:[e.jsx("i",{className:"mdi mdi-format-list-numbered me-1"}),"Pasos a seguir:"]}),e.jsx("div",{className:"bg-white p-2 rounded border mt-2",children:e.jsx("ol",{className:"mb-0",children:r.steps.map((t,s)=>e.jsx("li",{className:"mb-2",dangerouslySetInnerHTML:{__html:t}},s))})})]}),r.qr_display&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"alert alert-info border-0",children:[e.jsx("i",{className:"mdi mdi-qrcode me-2 fs-5"}),e.jsx("strong",{children:"C√≥digo QR:"})," Se mostrar√° el c√≥digo QR que subas en el campo correspondiente.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Los usuarios podr√°n escanear el c√≥digo para realizar el pago directamente."})]})}),r.show_phone&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"alert alert-info border-0",children:[e.jsx("i",{className:"mdi mdi-cellphone me-2 fs-5"}),e.jsx("strong",{children:"N√∫mero de tel√©fono:"})," Se mostrar√° el n√∫mero configurado para b√∫squeda manual.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"√ötil como alternativa al QR para usuarios que prefieren buscar manualmente."})]})}),r.show_cci&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"alert alert-success border-0",children:[e.jsx("i",{className:"mdi mdi-bank-transfer me-2 fs-5"}),e.jsx("strong",{children:"CCI:"})," Se mostrar√° el c√≥digo de cuenta interbancario configurado.",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Para transferencias entre diferentes bancos."})]})}),r.note&&e.jsxs("div",{className:"alert alert-warning border-0",children:[e.jsx("i",{className:"mdi mdi-alert-circle-outline me-2 fs-5"}),e.jsx("strong",{children:"Nota importante:"})," ",r.note]}),e.jsx("div",{className:"mt-3 pt-2 border-top",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"mdi mdi-information me-1"}),"Estas instrucciones se generan autom√°ticamente seg√∫n el tipo de m√©todo de pago seleccionado. Los datos espec√≠ficos (QR, CCI, tel√©fono) se mostrar√°n seg√∫n la configuraci√≥n que hagas arriba."]})})]}),oe=(r,t)=>{const s=`config_${r}`;switch(t.type){case"text":case"tel":case"url":return e.jsx("input",{type:t.type,id:s,className:"form-control",placeholder:t.placeholder,required:t.required});case"password":return e.jsx("input",{type:"password",id:s,className:"form-control",placeholder:t.placeholder,required:t.required});case"select":return e.jsxs("select",{id:s,className:"form-control",required:t.required,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),Object.entries(t.options||{}).map(([o,a])=>e.jsx("option",{value:o,children:a},o))]});case"boolean":return e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",id:s,className:"form-check-input"}),e.jsx("label",{className:"form-check-label",htmlFor:s,children:t.label})]});case"file":return t.accept&&t.accept.includes("image")?e.jsx("div",{"data-image-form-group":s,children:e.jsx(J,{eRef:null,id:s,label:t.label||r,accept:t.accept,required:t.required,help:t.help})}):e.jsxs("div",{children:[e.jsx("input",{type:"file",id:s,className:"form-control",accept:t.accept,required:t.required}),e.jsx("div",{id:`${s}_info`,className:"mt-1"}),t.help&&e.jsx("small",{className:"form-text text-muted",children:t.help})]});case"textarea":return e.jsx("textarea",{id:s,className:"form-control",rows:"3",placeholder:t.placeholder,required:t.required});default:return e.jsx("input",{type:"text",id:s,className:"form-control",placeholder:t.placeholder,required:t.required})}},ne=r=>{switch(r){case"gateway":return"mdi mdi-credit-card";case"qr":return"mdi mdi-qrcode";case"manual":return"mdi mdi-bank";default:return"mdi mdi-credit-card"}},ae=r=>{switch(r){case"gateway":return'<span class="badge bg-primary">Gateway</span>';case"qr":return'<span class="badge bg-info">QR/M√≥vil</span>';case"manual":return'<span class="badge bg-success">Manual</span>';default:return'<span class="badge bg-secondary">Otro</span>'}};return e.jsxs(e.Fragment,{children:["            ",e.jsx(ge,{gridRef:u,title:"M√©todos de Pago",rest:N,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>{u.current&&$(u.current).dxDataGrid("instance").refresh()}}}),r.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar M√©todo",hint:"Agregar M√©todo de Pago",onClick:()=>D()}})},exportable:!0,exportableName:"MetodosPago",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"icon",caption:"Icono",width:"60px",cellTemplate:(r,{data:t})=>{const s=t.icon?`/storage/payment_icons/${t.icon}`:null;r.html(B.renderToString(e.jsx("div",{className:"text-center",children:s?e.jsx("img",{src:s,alt:t.name,style:{width:"32px",height:"32px",objectFit:"contain"}}):e.jsx("i",{className:`${ne(t.type)} fs-4`})})))}},{dataField:"display_name",caption:"M√©todo",cellTemplate:(r,{data:t})=>{r.html(B.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{children:t.display_name}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:t.description})]})))}},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(r,{data:t})=>{r.html(ae(t.type))}},{dataField:"fee_percentage",caption:"Comisi√≥n",width:"120px",cellTemplate:(r,{data:t})=>{r.html(B.renderToString(e.jsxs(e.Fragment,{children:[t.fee_percentage>0&&e.jsxs("div",{children:[t.fee_percentage,"%"]}),t.fee_fixed>0&&e.jsxs("div",{children:["S/ ",je(t.fee_fixed)]}),t.fee_percentage==0&&t.fee_fixed==0&&e.jsx("span",{className:"text-success",children:"Gratis"})]})))}},{dataField:"requires_proof",caption:"Comprobante",width:"100px",cellTemplate:(r,{data:t})=>{r.html(t.requires_proof?'<span class="badge bg-warning">Requerido</span>':'<span class="badge bg-light text-muted">No</span>')}},{dataField:"is_active",caption:"Estado",dataType:"boolean",width:"80px",cellTemplate:(r,{data:t})=>{be(r,e.jsx(A,{checked:t.is_active,onChange:s=>K({id:t.id,value:s.target.checked})}))}},{dataField:"sort_order",caption:"Orden",width:"70px"},{caption:"Acciones",width:"120px",cellTemplate:(r,{data:t})=>{r.css("text-overflow","unset"),r.append(Q({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>D(t)})),r.append(Q({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>ee(t.id)}))}}]}),e.jsxs(fe,{modalRef:g,title:w?"Editar M√©todo de Pago":"Nuevo M√©todo de Pago",onSubmit:Z,size:"lg",id:"modalForm",children:[e.jsx("input",{ref:l,type:"hidden"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(q,{eRef:m,label:"Nombre interno",placeholder:"Ej: Yape",required:!0})}),e.jsx("div",{className:"col-md-6",children:e.jsx(q,{eRef:n,label:"Nombre para usuario",placeholder:"Ej: Pago con Yape",required:!0})})]}),"                ",e.jsx(de,{eRef:c,label:"Descripci√≥n",placeholder:"Descripci√≥n del m√©todo de pago",rows:3}),"                ",e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4",children:["                        ",e.jsxs(he,{eRef:h,label:"Tipo de m√©todo",required:!0,onChange:re,dropdownParent:"#modalForm",children:[e.jsx("option",{value:"",children:"Seleccionar tipo..."}),f&&[...new Set(Object.values(f).map(r=>r.type))].map(r=>{const t={gateway:"Gateway (Online)",qr:"QR/M√≥vil",manual:"Manual"};return e.jsx("option",{value:r,children:t[r]||r.charAt(0).toUpperCase()+r.slice(1)},r)})]})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["M√©todo de pago espec√≠fico",e.jsx("span",{className:"text-danger",children:"*"})]}),"                            ",e.jsxs("select",{className:"form-select",value:k,onChange:r=>{const t=r.target.value;if(I(t),console.log("Template changed to:",t),t&&f[t]){const s=f[t].type;P(s),h.current&&$(h.current).val(s).trigger("change");let o={};w&&(j==null?void 0:j.template_key)===t?(o=(j==null?void 0:j.configuration)||{},console.log("Using original saved config for template:",t,o)):w&&(j==null?void 0:j.template_key)!==t?(o={},console.log("Template changed during edit, clearing config")):(o={},console.log("New payment method, using empty config")),F.current=o,setTimeout(()=>{L(t,o,f)},100)}else F.current={}},required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar m√©todo..."}),f&&Object.entries(f).map(([r,t])=>{const o={yape:"Yape",plin:"Plin",culqi:"Culqi",mercadopago:"MercadoPago",transferencia_bancaria:"Transferencia Bancaria",efectivo:"Pago en Efectivo",agente_bancario:"Agente Bancario"}[r]||t.name||r.charAt(0).toUpperCase()+r.slice(1);return e.jsx("option",{value:r,children:o},r)})]}),e.jsx("small",{className:"form-text text-muted",children:"Seleccione el m√©todo espec√≠fico para mostrar sus campos de configuraci√≥n"})]})}),e.jsx("div",{className:"col-md-4",children:e.jsx(q,{eRef:S,label:"Comisi√≥n (%)",type:"number",step:"0.01",min:"0",max:"100",defaultValue:"0"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(q,{eRef:_,label:"Comisi√≥n fija (S/)",type:"number",step:"0.01",min:"0",defaultValue:"0"})})]}),e.jsxs("div",{className:"row",children:["                    ",e.jsx("div",{className:"col-md-4",children:e.jsx(J,{eRef:y,label:"Icono",accept:"image/*"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(q,{eRef:R,label:"Orden",type:"number",min:"0",defaultValue:"0"})}),e.jsxs("div",{className:"col-md-4 d-flex flex-column justify-content-end",children:["                        ",e.jsx("div",{className:"mb-3",children:e.jsx(A,{eRef:T,label:"Activo",checked:!0})}),e.jsx("div",{className:"mb-3",children:e.jsx(A,{eRef:E,label:"Requiere comprobante",checked:!1})})]})]}),"                ",e.jsx("div",{id:"dynamic-config-section",children:!f||Object.keys(f).length===0?e.jsxs("div",{className:"alert alert-info mt-4 mb-0",children:[e.jsx("i",{className:"mdi mdi-timer-sand"})," Cargando configuraci√≥n din√°mica..."]}):te()})]})]})};xe((u,g)=>{pe.createRoot(u).render(e.jsx(me,{...g,title:"M√©todos de Pago",children:e.jsx(Ne,{...g})}))});
