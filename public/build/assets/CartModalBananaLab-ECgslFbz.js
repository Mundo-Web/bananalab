import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BOnQTV8N.js";import{R as E}from"./index-BtQtP3Fl.js";import{N as v}from"./Number2Currency-e57Tgsuk.js";import{m as x}from"./main-Bp3JhiuO.js";import{G as p}from"./Global-BM4Id4Pw.js";import{i as N}from"./tippy-react.esm-BktTnHXY.js";/* empty css              */import{m as t}from"./proxy-DTU49k-A.js";import{B as S}from"./book-C1IPlXSj.js";import{T as C}from"./trash-2-DU7LB6-f.js";import{M as k}from"./minus-Db6MFKEO.js";import{P}from"./plus-CTIomuuF.js";import{A as _}from"./index-BNMCJu8J.js";import{c as T}from"./createLucideIcon-DfjclApS.js";import{X as z}from"./x-fof_H3Vv.js";import{S as A}from"./shopping-cart-DLRnxGTD.js";import{A as M}from"./arrow-right-MB8dWH_Y.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=T("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),$=({setCart:h,triggerShake:l,...a})=>{var g,d;const o=r=>{h(c=>{const i=c.filter(u=>u.id!==r);return x.Local.set(`${p.APP_CORRELATIVE}_cart`,i),i}),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{cart:h,action:"remove",itemId:r}}))},j=()=>{if(a.type==="custom_album"){l&&l();return}h(r=>{const c=r.map(i=>i.id===a.id?{...i,quantity:(i.quantity||1)+1}:i);return x.Local.set(`${p.APP_CORRELATIVE}_cart`,c),c})},w=()=>{if(a.type==="custom_album"){o(a.id);return}h(r=>{const c=r.map(i=>{if(i.id===a.id){const u=(i.quantity||1)-1;return u<=0?(o(a.id),null):{...i,quantity:u}}return i}).filter(Boolean);return x.Local.set(`${p.APP_CORRELATIVE}_cart`,c),c})},b=()=>{var r;return a.type==="custom_album"?a.image&&a.image.startsWith("data:")?a.image:a.image?`/storage/images/item/${a.image}`:(r=a.preset_data)!=null&&r.cover_image?`/storage/images/item_preset/${a.preset_data.cover_image}`:"/api/cover/thumbnail/null":`/storage/images/item/${a.image}`},f=()=>{var r;return a.type==="custom_album"?a.name||`Ãlbum Personalizado - ${((r=a.preset_data)==null?void 0:r.name)||"Sin tÃ­tulo"}`:a.name};return e.jsxs(t.tr,{className:"border-b border-gray-100 font-font-general hover:bg-gray-50 transition-colors",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:50},transition:{duration:.3},children:[e.jsx("td",{className:"p-4 w-28",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:b(),className:"block bg-white rounded-lg p-0 aspect-square w-20 h-20 object-cover object-center shadow-sm",alt:f(),onError:r=>r.target.src="/api/cover/thumbnail/null"}),a.type==="custom_album"&&e.jsx(t.div,{className:"absolute -top-2 -right-2 bg-purple-500 text-white p-1 rounded-full",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500},children:e.jsx(S,{size:12})}),a.discount>0&&e.jsxs(t.div,{className:"absolute -top-2 -left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500},children:["-",Math.round(a.discount/a.price*100),"%"]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col h-full justify-between",children:[e.jsx("div",{children:a.type==="custom_album"?e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-purple-600 mb-1 font-medium",children:"ðŸ“– Ãlbum Personalizado"}),e.jsx("h3",{className:"font-semibold text-gray-800 line-clamp-2",children:f()}),a.album_data&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("p",{children:["ðŸ”— ",a.album_data.pages_count," pÃ¡ginas"]}),e.jsxs("p",{children:["ðŸŽ¨ ",(g=a.preset_data)==null?void 0:g.name]})]})]}):e.jsxs("div",{children:[(a==null?void 0:a.category)&&e.jsx("span",{className:"block text-xs text-gray-500 mb-1",children:((d=a==null?void 0:a.category)==null?void 0:d.name)??"Sin categorÃ­a"}),e.jsx("h3",{className:"font-semibold text-gray-800 line-clamp-2",children:f()})]})}),e.jsx("div",{className:"flex items-center gap-4 mt-3",children:a.type==="custom_album"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600 bg-purple-50 px-2 py-1 rounded",children:"Cantidad: 1 (Ãºnico)"}),e.jsx(N,{content:"Eliminar Ã¡lbum personalizado",children:e.jsx(t.button,{type:"button",onClick:()=>o(a.id),className:"w-8 h-8 flex justify-center items-center bg-red-50 hover:bg-red-100 transition-colors rounded-lg",whileTap:{scale:.9},children:e.jsx(C,{size:16,className:"text-red-600"})})})]}):e.jsxs(t.div,{className:"flex items-center border border-gray-200 rounded-lg overflow-hidden",whileHover:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx(t.button,{type:"button",onClick:w,className:"w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 transition-colors",whileTap:{scale:.9},children:e.jsx(k,{size:16,className:"text-gray-600"})}),e.jsx("div",{className:"w-8 h-8 flex justify-center items-center bg-white",children:e.jsx("span",{className:"font-medium text-sm text-gray-800",children:a.quantity||1})}),e.jsx(t.button,{type:"button",onClick:j,className:"w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 transition-colors",whileTap:{scale:.9},children:e.jsx(P,{size:16,className:"text-gray-600"})})]})})]})}),e.jsx("td",{className:"p-4 text-right w-28",children:e.jsxs("div",{className:"flex flex-col items-end h-full justify-between",children:[e.jsxs("div",{children:[(a==null?void 0:a.discount)>0&&e.jsxs("span",{className:"block text-xs text-gray-400 line-through mb-1",children:["S/. ",v(a==null?void 0:a.price)]}),e.jsxs("p",{className:"font-bold customtext-neutral-dark text-base",children:["S/. ",v(a==null?void 0:a.final_price)]})]}),e.jsx(N,{content:"Eliminar",placement:"left",animation:"scale",children:e.jsx(t.button,{type:"button",onClick:()=>o(a==null?void 0:a.id),className:"mt-3 p-2 rounded-full hover:bg-red-50 text-gray-400 hover:text-red-500 transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(C,{size:18})})})]})})]})};E.setAppElement("#app");const ae=({data:h,cart:l,setCart:a,modalOpen:o,setModalOpen:j})=>{const[w,b]=m.useState(!1),[f,g]=m.useState(!1);m.useEffect(()=>{o?(document.body.classList.add("overflow-hidden"),document.documentElement.classList.add("overflow-hidden")):(document.body.classList.remove("overflow-hidden"),document.documentElement.classList.remove("overflow-hidden"))},[o]),m.useEffect(()=>{const s=n=>{console.log("ðŸ“¢ CartModal: Carrito actualizado:",n.detail);const y=x.Local.get(`${p.APP_CORRELATIVE}_cart`)||[];console.log("ðŸ”„ CartModal: Cargando carrito desde localStorage:",y),JSON.stringify(y)!==JSON.stringify(l)?(console.log("âœ… CartModal: Actualizando carrito con datos diferentes"),a(y)):console.log("â„¹ï¸ CartModal: Carrito sin cambios, no actualizar"),!o&&n.detail.action==="add"&&i()};return window.addEventListener("cartUpdated",s),()=>{window.removeEventListener("cartUpdated",s)}},[o,a,l]),m.useEffect(()=>{if(o){console.log("ðŸ”„ CartModal: Modal abierto, sincronizando carrito...");const s=x.Local.get(`${p.APP_CORRELATIVE}_cart`)||[];console.log("ðŸ“¦ CartModal: Carrito desde localStorage:",s),a(s)}},[o,a]),m.useEffect(()=>{const s=n=>{console.log("ðŸ“¢ CartModal: Carrito actualizado:",n.detail);const y=x.Local.get(`${p.APP_CORRELATIVE}_cart`)||[];a(y),!o&&n.detail.action==="add"&&i()};return window.addEventListener("cartUpdated",s),()=>{window.removeEventListener("cartUpdated",s)}},[o,a]);const d=()=>{b(!0),setTimeout(()=>{j(!1),b(!1)},300)},r=l.reduce((s,n)=>s+n.final_price*n.quantity,0),c=l.reduce((s,n)=>s+n.quantity,0),i=()=>{g(!0),setTimeout(()=>g(!1),1e3)},u={hidden:{x:"100%",opacity:0},visible:{x:0,opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{x:"100%",opacity:0,transition:{ease:"easeInOut",duration:.3}}},L={hidden:{opacity:0,y:20},visible:s=>({opacity:1,y:0,transition:{delay:s*.05,duration:.4}}),exit:{opacity:0,x:50}};return e.jsx(_,{children:o&&e.jsx(E,{isOpen:o,onRequestClose:d,closeTimeoutMS:300,contentLabel:"Carrito de compras",className:"absolute right-0 top-0 bottom-0 bg-white p-6 rounded-l-2xl shadow-2xl w-full max-w-md outline-none h-screen flex flex-col",overlayClassName:"fixed inset-0 z-50",children:e.jsxs(t.div,{className:"flex-1 flex flex-col",initial:"hidden",animate:w?"exit":"visible",exit:"exit",variants:u,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-100",children:[e.jsxs(t.div,{className:"flex items-center gap-3",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:[e.jsx(R,{className:"text-primary",size:24}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Tu Carrito"}),e.jsxs(t.span,{className:"bg-primary text-white text-sm font-medium px-2 py-1 rounded-full",animate:f?{scale:[1,1.1,1],rotate:[0,5,-5,0]}:{},transition:{duration:.6},children:[c," ",c===1?"Ã­tem":"Ã­tems"]})]}),e.jsx(t.button,{onClick:d,whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-1 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Cerrar carrito",children:e.jsx(z,{size:24,className:"text-gray-500"})})]}),l.length>0?e.jsx(t.div,{className:"flex-1 overflow-y-auto pr-2 scroll__carrito",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.jsx(_,{children:l.map((s,n)=>e.jsx(t.table,{custom:n,initial:"hidden",animate:"visible",exit:"exit",variants:L,layout:!0,className:"mb-4",children:e.jsx($,{...s,setCart:a,triggerShake:i})},`${s.id}-${n}`))})}):e.jsxs(t.div,{className:"flex-1 flex flex-col items-center justify-center gap-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[e.jsx(A,{size:48,className:"text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Tu carrito estÃ¡ vacÃ­o"}),e.jsx(t.button,{onClick:d,whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-6 py-2 bg-primary text-white rounded-lg font-medium",children:"Seguir comprando"})]}),l.length>0&&e.jsxs(t.div,{className:"pt-4 border-t border-gray-100",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Subtotal"}),e.jsxs("span",{className:"text-gray-900 font-bold text-xl",children:["S/. ",v(r)]})]}),e.jsxs(t.a,{href:"/cart",whileHover:{scale:1.02,boxShadow:"0 5px 15px rgba(0,0,0,0.1)"},whileTap:{scale:.98},className:"w-full bg-primary hover:bg-primary-dark text-white py-3 px-6 rounded-xl font-semibold flex items-center justify-center gap-2 transition-colors",children:["Proceder al pago",e.jsx(M,{size:20})]}),e.jsx(t.button,{onClick:d,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full mt-3 bg-white text-primary border border-primary py-3 px-6 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors",children:"Seguir comprando"})]})]})})})};export{ae as C,R as S};
