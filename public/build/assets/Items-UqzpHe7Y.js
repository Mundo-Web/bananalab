var ka=Object.defineProperty;var $a=(N,d,v)=>d in N?ka(N,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):N[d]=v;var se=(N,d,v)=>$a(N,typeof d!="symbol"?d+"":d,v);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ga}from"./Base-iD3WjR8i.js";import{S as Q}from"./SwitchFormGroup-zwNBvRf7.js";import{T as na}from"./TextareaFormGroup-CdwdsTk2.js";import{r as s}from"./index-BH53Isel.js";import{c as Ta}from"./ReactAppend-DTVVXReZ.js";import{s as Me}from"./DxBox-CTFD8z_X.js";import{S as y}from"./ProductCard-Bvp3XiVT.js";import"./main-BvVILmTO.js";import{B as Ma}from"./ModalImportItem-edN7nyz1.js";import{M as Ae}from"./Modal-BJ3DTV_x.js";import{T as Aa}from"./Table-cP0w99G1.js";import{I as k}from"./ImageFormGroup-Dx5myhwn.js";import{I as p}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ba}from"./QuillFormGroup-D8zDHSfJ.js";import{S as ia}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as la}from"./SelectFormGroup-BPkIDnvX.js";import{D as Be}from"./DxButton-CsjWvhyj.js";import{C as Oa}from"./CreateReactScript-DSwc0KqF.js";import{N as X}from"./Number2Currency-e57Tgsuk.js";import{R as M}from"./ReactAppend-D7S498fx.js";import{S as za}from"./SetSelectValue-UxyCmHse.js";import{I as La}from"./ItemPresetsRest-DAo8oqYC.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./General-BmbBKdsB.js";const Va=({label:N,structure:d,onChange:v,typeOptions:b=[]})=>{const[f,j]=s.useState([]),_=()=>{j(typeof d=="object"?[...f,{...d}]:[...f,""])},D=i=>{const x=f.filter((h,l)=>l!==i);j(x),v(x)},I=(i,x,h)=>{const l=[...f];typeof l[i]=="object"?l[i][x]=h:l[i]=h,j(l),v(l)};return e.jsxs("div",{className:"dynamic-field-container",children:[e.jsx("label",{className:"form-label",children:N}),e.jsx("div",{className:"fields-list",children:f.map((i,x)=>e.jsxs("div",{className:"field-row",children:[typeof i=="object"?Object.keys(d).map(h=>e.jsx("div",{className:"field-input",children:h==="type"?e.jsxs("select",{className:"form-select select-type",value:i[h],onChange:l=>I(x,h,l.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar..."}),b.map(l=>e.jsx("option",{value:l,children:l},l))]}):e.jsx("input",{type:"text",className:"form-control ",value:i[h],onChange:l=>I(x,h,l.target.value),placeholder:h.charAt(0).toUpperCase()+h.slice(1)})},h)):e.jsx("div",{className:"field-input",children:e.jsx("input",{type:"text",className:"form-control ",value:i,onChange:h=>I(x,null,h.target.value),placeholder:"Nueva característica"})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger remove-btn",onClick:()=>D(x),children:e.jsx("i",{className:"fas fa-times"})})]},x))}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary add-btn",onClick:_,children:[e.jsx("i",{className:"fas fa-plus me-1"})," Agregar"]}),e.jsx("style",{jsx:!0,children:`
                .dynamic-field-container {
                    margin-bottom: 1rem;
                }

                .fields-list {
                    margin-bottom: 0.5rem;
                }

                .field-row {
                    display: flex;
                    gap: 0.5rem;
                    margin-bottom: 0.5rem;
                    align-items: center;
                }

                .field-input {
                    flex: 1;
                }

                .remove-btn {
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 0;
                }

                .add-btn {
                    width: 100%;
                }
            `})]})};class oa extends Ma{constructor(){super(...arguments);se(this,"path","admin/items");se(this,"hasFiles",!0);se(this,"importData",async v=>{console.log("FormData recibido en importData:",[...v.entries()]);try{const b=await fetch("/api/import-items",{method:"POST",body:v}),f=await b.json();if(console.log("Respuesta del servidor:",f),!b.ok)throw new Error((f==null?void 0:f.error)??(f==null?void 0:f.message)??"Error en la importación");return f}catch(b){throw console.error("Error en importData:",b.message),b}})}}const Ja=new oa,qa=({gridRef:N,modalRef:d})=>{const[v,b]=s.useState(null),[f,j]=s.useState(!1),[_,D]=s.useState(""),[I,i]=s.useState(!1),x=l=>{b(l.target.files[0])},h=async()=>{var C,w;if(!v){D("Por favor, selecciona un archivo."),i(!0);return}const l=new FormData;l.append("file",v),j(!0);try{const c=await Ja.importData(l);if(console.log(c),c.error){const S=Array.isArray(c.error)?c.error.join(`
`):c.error;D(`Error en la importación:
${S}`),i(!0)}else D(c.message),i(!1),$(N.current).dxDataGrid("instance").refresh(),d.current&&d.current.close()}catch(c){D("Error al importar: "+(((w=(C=c.response)==null?void 0:C.data)==null?void 0:w.error)||c.message)),i(!0)}j(!1)};return e.jsx("div",{className:"bg-white",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{children:e.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:x})}),e.jsx("button",{onClick:h,disabled:f,className:"btn btn-primary mt-2",type:"button",children:f?"Subiendo...":"Subir Archivo"}),_&&e.jsx("div",{className:`alert ${I?"alert-danger":"alert-success"} mt-2`,role:"alert",children:e.jsx("div",{className:"alert-message",children:_})})]})})},ne=new oa,F=new La,Ua=({categories:N,brands:d,collections:v})=>{const[b,f]=s.useState([]),j=s.useRef(),_=s.useRef(),[D,I]=s.useState(!1),[i,x]=s.useState(null),[h,l]=s.useState([]),C=s.useRef(),w=s.useRef(),c=s.useRef(null),S=s.useRef(),ie=s.useRef(),Y=s.useRef(),le=s.useRef(),G=s.useRef(),oe=s.useRef(),K=s.useRef(),ce=s.useRef(),A=s.useRef(),de=s.useRef(),B=s.useRef(),O=s.useRef(),z=s.useRef(),L=s.useRef(),me=s.useRef(),ue=s.useRef(),fe=s.useRef(),pe=s.useRef(),he=s.useRef(),ge=s.useRef(),xe=s.useRef(),ve=s.useRef(),be=s.useRef(),je=s.useRef(),Ne=s.useRef(),[Z,ca]=s.useState(!1),[R,V]=s.useState("basic"),[da,ee]=s.useState(!1),[Oe,ze]=s.useState(!1),ye=s.useRef(),we=s.useRef(),Re=s.useRef(),Ce=s.useRef(),Pe=s.useRef(),_e=s.useRef(),Ie=s.useRef(),Se=s.useRef(),Ee=s.useRef(),Fe=s.useRef(),ae=s.useRef(),De=s.useRef(),ke=s.useRef(),$e=s.useRef();s.useRef([]);const[ma,ua]=s.useState(!1),[fa,pa]=s.useState(null),[ha,ga]=s.useState(null),[re,T]=s.useState([]),Le=s.useRef(),[xa,va]=s.useState([]),[ba,Ve]=s.useState([]),[Ha,Wa]=s.useState(!1),Je=s.useRef(),ja=async a=>{if(console.log("openPresetsModal called with item:",a),!a||!a.id){y.fire({title:"Error",text:"No se ha seleccionado un item válido para gestionar presets.",icon:"error"});return}console.log("Setting selectedItemForPresets:",a),x(a),c.current=a,I(!0),$(C.current).modal("show"),$(C.current).on("shown.bs.modal",async function(){console.log("Modal shown, loading presets for item:",a.id),await _a(a.id),$(C.current).off("shown.bs.modal")})};s.useEffect(()=>{if(C.current){const a=C.current,r=()=>{if(w.current)try{const t=$(w.current).dxDataGrid("instance");t&&t.dispose()}catch(t){console.warn("Error disposing DataGrid:",t)}I(!1),x(null),c.current=null,l([])};return $(a).on("hidden.bs.modal",r),()=>{$(a).off("hidden.bs.modal",r)}}},[]),s.useEffect(()=>{const a=()=>{console.log("presetModal is opening - currentItemForPresetsRef:",c.current),console.log("presetModal is opening - selectedItemForPresets:",i)},r=()=>{console.log("presetModal is closing")};return $("#presetModal").on("shown.bs.modal",a),$("#presetModal").on("hidden.bs.modal",r),()=>{$("#presetModal").off("shown.bs.modal",a),$("#presetModal").off("hidden.bs.modal",r)}},[i]);const Na=a=>{const t=Array.from(a.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},ya=a=>{a.preventDefault();const t=Array.from(a.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},wa=a=>a.preventDefault(),Ra=(a,r)=>{a.preventDefault(),re[r].id?T(n=>n.map((o,m)=>m===r?{...o,toDelete:!0}:o)):T(n=>n.filter((o,m)=>m!==r))};s.useEffect(()=>{if(b&&b.images){const a=b.images.map(r=>({id:r.id,url:`/storage/images/item_image/${r.url}`}));T(a)}},[b]);const qe=a=>{var r,t;f(a||null),ua(!!(a!=null&&a.id)),ye.current.value=(a==null?void 0:a.id)||"",$(we.current).val((a==null?void 0:a.category_id)||null).trigger("change"),$(Re.current).val((a==null?void 0:a.collection_id)||null).trigger("change"),za(Ce.current,(r=a==null?void 0:a.subcategory)==null?void 0:r.id,(t=a==null?void 0:a.subcategory)==null?void 0:t.name),$(Pe.current).val((a==null?void 0:a.brand_id)||null).trigger("change"),_e.current.value=(a==null?void 0:a.name)||"",Ie.current.value=(a==null?void 0:a.color)||"",Se.current.value=(a==null?void 0:a.summary)||"",Ee.current.value=(a==null?void 0:a.price)||0,Fe.current.value=(a==null?void 0:a.discount)||0,$e.current.value=(a==null?void 0:a.stock)||0,ae.current.value=null,ae.image.src=`/storage/images/item/${(a==null?void 0:a.image)??"undefined"}`,De.image.src=`/storage/images/item/${(a==null?void 0:a.texture)??"undefined"}`,ke.editor.root.innerHTML=(a==null?void 0:a.description)??"",va((a==null?void 0:a.features)||[]),Ve((a==null?void 0:a.specifications)||[]),$(_.current).modal("show")},Ca=async a=>{a.preventDefault();const r={id:ye.current.value||void 0,category_id:we.current.value,collection_id:Re.current.value||null,subcategory_id:Ce.current.value,brand_id:Pe.current.value,name:_e.current.value,color:Ie.current.value,summary:Se.current.value,price:Ee.current.value,discount:Fe.current.value,description:ke.current.value,stock:$e.current.value},t=new FormData;for(const g in r)t.append(g,r[g]);t.append("features",JSON.stringify(xa)),t.append("specifications",JSON.stringify(ba));const n=ae.current.files[0];n&&t.append("image",n);const o=De.current.files[0];o&&t.append("texture",o),re.forEach((g,E)=>{g.toDelete||(g.file?t.append(`gallery[${E}]`,g.file):t.append(`gallery_ids[${E}]`,g.id))});const m=re.filter(g=>g.toDelete).map(g=>parseInt(g.id,10));m.length>0&&t.append("deleted_images",JSON.stringify(m)),await ne.save(t)&&($(j.current).dxDataGrid("instance").refresh(),$(_.current).modal("hide"),T([]))},Pa=async({id:a,value:r})=>{await ne.boolean({id:a,field:"visible",value:r})&&$(j.current).dxDataGrid("instance").refresh()},te=async({id:a,field:r,value:t})=>{await ne.boolean({id:a,field:r,value:t})&&$(j.current).dxDataGrid("instance").refresh()};function _a(a){if(!a){console.warn("loadPresets called without itemId");return}console.log("loadPresets called with itemId:",a),ee(!0),l([]),F.getByItem(a).then(r=>{console.log("loadPresets result:",r);const t=r.data||[];l(t),setTimeout(()=>{console.log("Attempting to initialize presets grid with data:",t),Te(t)},300)}).catch(r=>{console.error("Error loading presets:",r),l([]),y.fire({title:"Error",text:"No se pudieron cargar los presets. Por favor, intenta nuevamente.",icon:"error"})}).finally(()=>{ee(!1)})}const Ue=(a=null,r=null)=>{var n,o,m,P,g,E,J,q,U,H,W;const t=r||i||c.current;if(!t||!t.id){y.fire({title:"Error",text:"No hay item seleccionado para gestionar presets. Por favor, selecciona un item válido.",icon:"error"});return}x(t),c.current=t,ca(!!(a!=null&&a.id)),V("basic"),S.current.value=(a==null?void 0:a.id)||"",ie.current.value=(t==null?void 0:t.id)||"",Y.current.value=(a==null?void 0:a.name)||"",le.current.value=(a==null?void 0:a.description)||"",G.current.value=(a==null?void 0:a.price)||"",oe.current.value=(a==null?void 0:a.discount)||0,ce.current.value=(a==null?void 0:a.sort_order)||0,A.current.value=a!=null&&a.configuration?JSON.stringify(a.configuration,null,2):"",de.current.checked=(a==null?void 0:a.is_active)!==!1,K.image.src=`/storage/images/item_preset/${(a==null?void 0:a.image)??"undefined"}`,B.current&&(B.image.src=`/storage/images/item_preset/${(a==null?void 0:a.cover_image)??"undefined"}`),O.current&&(O.image.src=`/storage/images/item_preset/${(a==null?void 0:a.content_layer_image)??"undefined"}`),z.current&&(z.image.src=`/storage/images/item_preset/${(a==null?void 0:a.final_layer_image)??"undefined"}`),L.current&&(L.image.src=`/storage/images/item_preset/${(a==null?void 0:a.preview_image)??"undefined"}`),me.current.value=((n=a==null?void 0:a.canvas_config)==null?void 0:n.width)||1e3,ue.current.value=((o=a==null?void 0:a.canvas_config)==null?void 0:o.height)||1e3,fe.current.value=((m=a==null?void 0:a.canvas_config)==null?void 0:m.dpi)||300,pe.current.value=((P=a==null?void 0:a.canvas_config)==null?void 0:P.background_color)||"#ffffff",he.current.value=((g=a==null?void 0:a.content_layer_config)==null?void 0:g.x)||0,ge.current.value=((E=a==null?void 0:a.content_layer_config)==null?void 0:E.y)||0,xe.current.value=((J=a==null?void 0:a.content_layer_config)==null?void 0:J.width)||1e3,ve.current.value=((q=a==null?void 0:a.content_layer_config)==null?void 0:q.height)||1e3,be.current.value=((U=a==null?void 0:a.content_layer_config)==null?void 0:U.rotation)||0,je.current.value=((H=a==null?void 0:a.content_layer_config)==null?void 0:H.opacity)||1,Ne.current.value=((W=a==null?void 0:a.content_layer_config)==null?void 0:W.fit_mode)||"cover",console.log("onPresetModalOpen - antes de mostrar modal, selectedItemForPresets:",i,"targetItem:",t),$("#presetModal").modal("show")},Ge=a=>{if(console.log("updatePresetsGrid called with data:",a),!w.current){console.warn("presetsGridRef.current is null in updatePresetsGrid");return}try{const r=$(w.current).dxDataGrid("instance");r?(console.log("Updating existing DataGrid instance"),r.option("dataSource",a)):(console.log("No DataGrid instance found, initializing new one"),Te(a))}catch(r){console.warn("DataGrid instance not available, will initialize on next load",r)}},Te=a=>{if(console.log("initializePresetsGrid called with data:",a),!w.current){console.warn("presetsGridRef.current is null in initializePresetsGrid");return}if(!$(w.current).is(":visible")){console.warn("Grid element is not visible, retrying in 500ms"),setTimeout(()=>Te(a),500);return}try{const r=$(w.current).dxDataGrid("instance");if(r){console.log("DataGrid already initialized, updating data"),r.option("dataSource",a);return}}catch{console.log("No existing DataGrid instance found, creating new one")}console.log("Creating new DataGrid instance"),$(w.current).dxDataGrid({dataSource:a,keyExpr:"id",showBorders:!0,columnAutoWidth:!0,searchPanel:{visible:!0,placeholder:"Buscar presets..."},filterRow:{visible:!0},headerFilter:{visible:!0},paging:{enabled:!1},onContentReady:function(){console.log("DataGrid content ready with",a.length,"items")},columns:[{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"description",caption:"Descripción",width:"250px"},{dataField:"price",caption:"Precio",width:"80px",cellTemplate:(r,t)=>{r.text(`S/. ${X(t.value)}`)}},{dataField:"discount",caption:"Descuento",width:"80px",cellTemplate:(r,t)=>{t.value>0?r.text(`S/. ${X(t.value)}`):r.text("-")}},{caption:"Precio Final",width:"100px",cellTemplate:(r,t)=>{const n=t.data.discount>0?t.data.price-t.data.discount:t.data.price;r.html(`<span class="fw-bold text-success">S/. ${X(n)}</span>`)}},{dataField:"sort_order",caption:"Orden",width:"70px"},{dataField:"is_active",caption:"Estado",width:"100px",cellTemplate:(r,t)=>{const n=document.createElement("div");n.className="form-check form-switch";const o=document.createElement("input");o.className="form-check-input",o.type="checkbox",o.checked=t.value,o.onchange=m=>Sa({id:t.data.id,value:m.target.checked}),n.appendChild(o),r.append(n)}},{caption:"Acciones",width:"120px",allowFiltering:!1,allowSorting:!1,cellTemplate:(r,t)=>{const n=document.createElement("div");n.className="d-flex gap-1";const o=document.createElement("button");o.className="btn btn-sm btn-outline-primary",o.innerHTML='<i class="fas fa-edit"></i>',o.title="Editar preset",o.onclick=()=>{const P=i||c.current;console.log("Edit preset clicked - item:",P,"preset:",t.data),Ue(t.data,P)};const m=document.createElement("button");m.className="btn btn-sm btn-outline-danger",m.innerHTML='<i class="fas fa-trash"></i>',m.title="Eliminar preset",m.onclick=()=>Ea(t.data.id),n.appendChild(o),n.appendChild(m),r.append(n)}}]})},Ia=async a=>{var o,m,P,g,E,J,q,U,H,W,He,We,Qe,Xe,Ye,Ke,Ze,ea,aa,ra,ta;a.preventDefault();const r=i||c.current,t=(o=ie.current)==null?void 0:o.value;console.log("onPresetSubmit - selectedItemForPresets:",i),console.log("onPresetSubmit - currentItemForPresetsRef.current:",c.current),console.log("onPresetSubmit - targetItem:",r),console.log("onPresetSubmit - itemIdFromForm:",t);const n=(r==null?void 0:r.id)||t;if(!n){y.fire({title:"Error",text:"No hay item seleccionado para asociar el preset. Por favor, cierra este modal y vuelve a abrir desde el botón 'Gestionar Presets' del item deseado.",icon:"error"});return}ze(!0);try{if(!((P=(m=Y.current)==null?void 0:m.value)!=null&&P.trim()))throw new Error("El nombre es obligatorio");if(!((g=G.current)!=null&&g.value)||isNaN(parseFloat(G.current.value)))throw new Error("El precio debe ser un número válido");if(parseFloat(G.current.value)<0)throw new Error("El precio no puede ser negativo");const u=new FormData;if((E=S.current)!=null&&E.value&&u.append("id",S.current.value),u.append("item_id",n),u.append("name",Y.current.value.trim()),u.append("description",le.current.value||""),u.append("price",G.current.value),u.append("discount",oe.current.value||0),u.append("sort_order",ce.current.value||0),u.append("is_active",de.current.checked?1:0),A.current.value.trim())try{JSON.parse(A.current.value),u.append("configuration",A.current.value)}catch{throw new Error("La configuración debe ser un JSON válido")}K.current.files[0]&&u.append("image",K.current.files[0]),(J=B.current)!=null&&J.files[0]&&u.append("cover_image",B.current.files[0]),(q=O.current)!=null&&q.files[0]&&u.append("content_layer_image",O.current.files[0]),(U=z.current)!=null&&U.files[0]&&u.append("final_layer_image",z.current.files[0]),(H=L.current)!=null&&H.files[0]&&u.append("preview_image",L.current.files[0]);const Fa={width:parseInt((W=me.current)==null?void 0:W.value)||1e3,height:parseInt((He=ue.current)==null?void 0:He.value)||1e3,dpi:parseInt((We=fe.current)==null?void 0:We.value)||300,background_color:((Qe=pe.current)==null?void 0:Qe.value)||"#ffffff",format:"JPEG",quality:90};u.append("canvas_config",JSON.stringify(Fa));const Da={x:parseInt((Xe=he.current)==null?void 0:Xe.value)||0,y:parseInt((Ye=ge.current)==null?void 0:Ye.value)||0,width:parseInt((Ke=xe.current)==null?void 0:Ke.value)||1e3,height:parseInt((Ze=ve.current)==null?void 0:Ze.value)||1e3,rotation:parseFloat((ea=be.current)==null?void 0:ea.value)||0,opacity:parseFloat((aa=je.current)==null?void 0:aa.value)||1,blend_mode:"normal",fit_mode:((ra=Ne.current)==null?void 0:ra.value)||"cover",allow_upload:!0,max_file_size:10,allowed_formats:["jpg","jpeg","png","gif"]};u.append("content_layer_config",JSON.stringify(Da)),Z&&((ta=S.current)!=null&&ta.value)?await F.updateForItem(n,S.current.value,u):await F.saveForItem(n,u),ee(!0);const sa=await F.getByItem(n);l(sa.data||[]),Ge(sa.data||[]),ee(!1),$("#presetModal").modal("hide"),y.fire({title:"¡Éxito!",text:`Preset ${Z?"actualizado":"creado"} correctamente`,icon:"success",timer:2e3})}catch(u){y.fire({title:"Error",text:u.message||"Error al guardar el preset",icon:"error"})}finally{ze(!1)}},Sa=async({id:a,value:r})=>{const t=i||c.current;if(!t||!t.id){y.fire({title:"Error",text:"No hay item seleccionado. Por favor, selecciona un item válido.",icon:"error"});return}try{console.log("Cambiando estado del preset:",a,"del item:",t.id,"a:",r),await F.toggleStatusForItem(t.id,a);const n=await F.getByItem(t.id);l(n.data||[]),Ge(n.data||[]),y.fire({title:"¡Éxito!",text:`Preset ${r?"activado":"desactivado"} correctamente`,icon:"success",timer:2e3,showConfirmButton:!1})}catch(n){console.error("Error al cambiar estado del preset:",n),y.fire({title:"Error",text:"Error al cambiar el estado del preset: "+n.message,icon:"error"})}},Ea=async a=>{const r=i||c.current;if(!r||!r.id){y.fire({title:"Error",text:"No hay item seleccionado. Por favor, selecciona un item válido.",icon:"error"});return}if((await y.fire({title:"¿Estás seguro?",text:"Esta acción eliminará permanentemente el preset",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{console.log("Eliminando preset:",a,"del item:",r.id),await F.deleteForItem(r.id,a);const n=await F.getByItem(r.id);l(n.data||[]),Ge(n.data||[]),y.fire({title:"¡Eliminado!",text:"El preset ha sido eliminado correctamente",icon:"success",timer:2e3})}catch(n){console.error("Error al eliminar preset:",n),y.fire({title:"Error",text:"Error al eliminar el preset: "+n.message,icon:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Aa,{gridRef:j,title:"Items",rest:ne,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(j.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>qe()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>onModalImportOpen()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(a,{data:r})=>{var t,n,o;a.html(Me.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block fst-italic text-muted",children:(t=r.collection)==null?void 0:t.name}),e.jsx("b",{className:"d-block",children:(n=r.category)==null?void 0:n.name}),e.jsx("small",{className:"text-muted",children:(o=r.subcategory)==null?void 0:o.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(a,{data:r})=>{a.html(Me.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{children:r.name}),e.jsx("br",{}),e.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(a,{data:r})=>{a.html(Me.renderToString(e.jsxs(e.Fragment,{children:[r.discount>0&&e.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",X(r.price)]}),e.jsxs("span",{children:["S/.",X(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(a,{data:r})=>{M(a,e.jsx("img",{src:`/storage/images/item/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:t=>t.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(Q,{checked:r.is_new,onChange:t=>te({id:r.id,field:"is_new",value:t.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(Q,{checked:r.offering,onChange:t=>te({id:r.id,field:"offering",value:t.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(Q,{checked:r.recommended,onChange:t=>te({id:r.id,field:"recommended",value:t.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(Q,{checked:r.featured,onChange:t=>te({id:r.id,field:"featured",value:t.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(Q,{checked:r.visible,onChange:t=>Pa({id:r.id,value:t.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(a,{data:r})=>{a.css("text-overflow","unset"),a.append(Be({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>qe(r)})),a.append(Be({className:"btn btn-xs btn-soft-info",title:"Gestionar Presets",icon:"fa fa-layer-group",onClick:()=>ja(r)})),a.append(Be({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(Ae,{modalRef:_,title:ma?"Editar Item":"Agregar Item",onSubmit:Ca,size:"xl",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",id:"principal-container",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Información Básica"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("input",{ref:ye,type:"hidden"}),e.jsx(la,{eRef:Re,label:"Colección",dropdownParent:"#principal-container",onChange:a=>ga(a.target.value),children:v.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(ia,{onChange:a=>pa(a.target.value),eRef:we,label:"Categoría",searchAPI:"/api/admin/categories/paginate",searchBy:"name",filter:["collection_id","=",ha],dropdownParent:"#principal-container"}),e.jsx(ia,{eRef:Ce,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",fa],dropdownParent:"#principal-container"}),e.jsx(la,{eRef:Pe,label:"Marca",required:!0,dropdownParent:"#principal-container",children:d.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(p,{eRef:_e,label:"Nombre",required:!0}),e.jsx(p,{eRef:Ie,label:"Color",required:!0}),e.jsx(na,{eRef:Se,label:"Resumen",rows:3,required:!0})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Precios y Stock"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(p,{eRef:Ee,label:"Precio",type:"number",step:"0.01",required:!0}),e.jsx(p,{eRef:Fe,label:"Descuento",type:"number",step:"0.01"}),e.jsx(p,{label:"Stock",eRef:$e,type:"number"})]})]})]})}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Especificaciones"})}),e.jsx("div",{className:"card-body",children:e.jsx(Va,{onChange:Ve,label:"Especificaciones",structure:{type:"",title:"",description:""},typeOptions:["General","Principal"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Imágenes"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:ae,label:"Imagen Principal",aspect:1})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:De,label:"Textura",aspect:1})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Galería de Imágenes"}),e.jsx("input",{id:"input-item-gallery",ref:Le,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Na}),e.jsx("div",{className:"gallery-upload-area",onClick:()=>Le.current.click(),onDrop:ya,onDragOver:wa,children:e.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})}),e.jsx("div",{className:"gallery-preview mt-2",children:re.map((a,r)=>e.jsxs("div",{className:"gallery-thumbnail",children:[e.jsx("img",{src:`${a.url}`,alt:"preview"}),e.jsx("button",{className:"btn btn-xs btn-danger gallery-remove-btn",onClick:t=>Ra(t,r),children:"×"})]},r))})]})]})]})]})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Descripción Completa"})}),e.jsx("div",{className:"card-body",children:e.jsx(Ba,{eRef:ke,label:""})})]})]}),e.jsx(Ae,{modalRef:Je,title:"Importar Datos",size:"sm",children:e.jsx(qa,{gridRef:j,modalRef:Je})}),e.jsxs(Ae,{modalRef:C,title:`Gestión de Presets - ${(i==null?void 0:i.name)||""}`,size:"xl",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:["Presets de ",i==null?void 0:i.name]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>{const a=i||c.current;console.log("Nuevo Preset button clicked - currentItem:",a),Ue(null,a)},children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Nuevo Preset"]})]})})}),e.jsx("div",{className:"table-responsive",children:da?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fa fa-spinner fa-spin fa-2x"}),e.jsx("p",{className:"mt-2",children:"Cargando presets..."})]}):e.jsx("div",{ref:w,style:{height:"400px"}})})]}),e.jsx("div",{className:"modal fade",id:"presetModal",tabIndex:"-1","aria-labelledby":"presetModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"presetModalLabel",children:Z?"Editar Preset":"Nuevo Preset"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("form",{onSubmit:Ia,children:[e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{ref:S,type:"hidden",name:"id"}),e.jsx("input",{ref:ie,type:"hidden",name:"item_id"}),e.jsxs("ul",{className:"nav nav-tabs mb-3",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="basic"?"active":""}`,onClick:()=>V("basic"),href:"#",children:"Información Básica"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="design"?"active":""}`,onClick:()=>V("design"),href:"#",children:"Capas de Diseño"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="canvas"?"active":""}`,onClick:()=>V("canvas"),href:"#",children:"Configuración Canvas"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="content"?"active":""}`,onClick:()=>V("content"),href:"#",children:"Área de Contenido"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:`tab-pane fade ${R==="basic"?"show active":""}`,style:{display:R==="basic"?"block":"none"},children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(p,{eRef:Y,name:"name",label:"Nombre del Preset",placeholder:"Ej: Álbum Premium 30x30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:G,name:"price",label:"Precio",type:"number",step:"0.01",min:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:oe,name:"discount",label:"Descuento (%)",type:"number",step:"0.01",min:"0",max:"100"})})]}),e.jsx(na,{eRef:le,name:"description",label:"Descripción",placeholder:"Descripción del preset...",rows:3}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:K,name:"image",label:"Imagen Principal del Preset"})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:L,name:"preview_image",label:"Imagen de Vista Previa"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ce,name:"sort_order",label:"Orden",type:"number",min:"0",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{ref:de,className:"form-check-input",type:"checkbox",defaultChecked:!0}),e.jsx("label",{className:"form-check-label",children:"Activo"})]})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Configuración Adicional (JSON)"}),e.jsx("textarea",{ref:A,className:"form-control",rows:"4",placeholder:'{"pages": 50, "size": "30x30", "cover": "hardcover"}'}),e.jsx("small",{className:"form-text text-muted",children:"Configuración técnica en formato JSON (opcional)"})]})]}),e.jsx("div",{className:`tab-pane fade ${R==="design"?"show active":""}`,style:{display:R==="design"?"block":"none"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Portada (Cover)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:B,name:"cover_image",label:"Imagen de Portada"}),e.jsx("small",{className:"text-muted",children:"Esta es la imagen de fondo que aparecerá en el editor"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Contenido"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:O,name:"content_layer_image",label:"Imagen de Contenido"}),e.jsx("small",{className:"text-muted",children:"Capa intermedia donde el usuario subirá su imagen"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa Final (Tapa)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:z,name:"final_layer_image",label:"Imagen de Tapa Final"}),e.jsx("small",{className:"text-muted",children:"Esta es la capa superior que se superpone al contenido"})]})]})})]})}),e.jsxs("div",{className:`tab-pane fade ${R==="canvas"?"show active":""}`,style:{display:R==="canvas"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Canvas"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:me,name:"canvas_width",label:"Ancho (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ue,name:"canvas_height",label:"Alto (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:fe,name:"canvas_dpi",label:"DPI (puntos por pulgada)",type:"number",min:"72",defaultValue:"300"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Color de Fondo"}),e.jsx("input",{ref:pe,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})})]}),e.jsx("div",{className:"mb-2",children:e.jsx("small",{className:"form-text text-muted",children:"El tamaño del canvas se ingresa en centímetros. El valor DPI recomendado para impresión es 300."})})]}),e.jsxs("div",{className:`tab-pane fade ${R==="content"?"show active":""}`,style:{display:R==="content"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Área de Contenido del Usuario"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:he,name:"content_x",label:"Posición X",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ge,name:"content_y",label:"Posición Y",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:xe,name:"content_width",label:"Ancho",type:"number",min:"1",defaultValue:"1000"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ve,name:"content_height",label:"Alto",type:"number",min:"1",defaultValue:"1000"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:be,name:"content_rotation",label:"Rotación (grados)",type:"number",min:"-360",max:"360",step:"0.1",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:je,name:"content_opacity",label:"Opacidad",type:"number",min:"0",max:"1",step:"0.1",defaultValue:"1"})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Modo de Ajuste"}),e.jsxs("select",{ref:Ne,className:"form-control",children:[e.jsx("option",{value:"cover",children:"Cover (cubrir área)"}),e.jsx("option",{value:"contain",children:"Contain (ajustar manteniendo aspecto)"}),e.jsx("option",{value:"fill",children:"Fill (estirar para llenar)"}),e.jsx("option",{value:"none",children:"None (tamaño original)"})]})]})})]})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:Oe,children:Oe?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-spinner fa-spin me-2"}),"Guardando..."]}):`${Z?"Actualizar":"Crear"} Preset`})]})]})]})})}),e.jsx("style",{jsx:!0,children:`
                .gallery-upload-area {
                    border: 2px dashed #ccc;
                    padding: 0px;
                    text-align: center;
                    cursor: pointer;
                    border-radius: 4px;
                    box-shadow: 2.5px 2.5px 5px rgba(0, 0, 0, 0.125);

                    height: 100px;
                    width: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f8f9fa;
                    transition: all 0.3s ease;
                }

                .gallery-upload-area:hover {
                    border-color: #0d6efd;
                    background-color: #e9f0ff;
                }

                .gallery-preview {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                }

                .gallery-thumbnail {
                    position: relative;
                    width: 80px;
                    height: 80px;
                    border-radius: 4px;
                    overflow: hidden;
                }

                .gallery-thumbnail img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .gallery-remove-btn {
                    position: absolute;
                    top: 0;
                    right: 0;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                }
            `})]})};Oa((N,d)=>{Ta.createRoot(N).render(e.jsx(Ga,{...d,title:"Items",children:e.jsx(Ua,{...d})}))});
