import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as l}from"./index-BOnQTV8N.js";import{N as P}from"./Number2Currency-e57Tgsuk.js";import{m as z}from"./main-Bp3JhiuO.js";import{G as D}from"./Global-BM4Id4Pw.js";import{B as de,a as ye,D as He}from"./DeliveryPricesRest-CepPhj8K.js";import{C as Ue}from"./CardItem-CdbVCrTF.js";import{u as le,S as ce}from"./SelectForm-CoB1IHa7.js";import{t as ee}from"./MercadoPagoCheckoutModal-BWpu80nR.js";import{I as J}from"./InputForm-BW2Lnisr.js";import{X as Ne}from"./x-fof_H3Vv.js";import{C as Y}from"./circle-check-big-CYWUGR3Z.js";import{c as re}from"./createLucideIcon-DfjclApS.js";import{C as ae}from"./chevron-right-Cug7tVUE.js";import{U as se}from"./upload-GO9GDST_.js";import{C as fe}from"./chevron-left-JcR9Fe4w.js";import{C as te,L as Je}from"./lock--IIEOUL2.js";import{B as ve}from"./building-2-DSFvhCB-.js";import{S as we}from"./smartphone-BHF2PZKl.js";import{d as Ye}from"./CheckoutSteps-Ca-1hlEy.js";import{C as Ge}from"./check-D5vaIe6v.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./book-C1IPlXSj.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./index-DE3dzT5W.js";import"./index-fNjTmf9T.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=re("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=re("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=re("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=re("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function We({cart:x,setCart:r,onContinue:i,subTotal:d,envio:u,igv:j,totalFinal:o}){console.log("üõí CartStep: Cart received:",x);const y=m=>{typeof m=="function"?r(n=>{const N=m(n);return z.Local.set(`${D.APP_CORRELATIVE}_cart`,N),console.log("üõí CartStep: Carrito actualizado en localStorage:",N.length,"items"),N}):(r(m),z.Local.set(`${D.APP_CORRELATIVE}_cart`,m),console.log("üõí CartStep: Carrito actualizado en localStorage:",m.length,"items"))},p=x.reduce((m,n)=>{const N=n.price||0,v=n.final_price||n.price||0,s=n.quantity||1;return N>v?m+(N-v)*s:m},0);return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"space-y-6",children:x.map((m,n)=>e.jsx(Ue,{...m,setCart:y},n))})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsxs("div",{className:"space-y-4",children:[p>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",P(p)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(d)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(j)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(u)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",P(o)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(de,{onClick:i,children:"  Continuar"}),e.jsx(ye,{href:"/",children:" Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]})]})}function Xe(){let x="";for(let r=0;r<12;r++){const i=Math.floor(Math.random()*10);x+=i}return x}const Ze=x=>new Promise((r,i)=>{try{console.log(x);const d=Xe(x.email);console.log(d),window.Culqi.publicKey="pk_test_f4d42a7b5073e8df",window.Culqi.settings({title:"Sala Fabulosa",email:x.email,currency:"PEN",amount:x.amount*100,order:`${d}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:"/assets/resources/logo.png",bannerColor:"#311609",buttonBackground:"#311609"}}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){i("No se obtuvo un token de Culqi");return}const u=window.Culqi.token.id;console.log("‚úÖ Token generado:",u),x={...x,token:u,orderNumber:d},console.log("_request actualizado",x);const{status:j,result:o}=await z.Fetch("./api/pago",{method:"POST",body:JSON.stringify(x)});j||console.log((o==null?void 0:o.message)||"Error en el pago"),window.Culqi.close(),z.Notify.add({icon:"/assets/img/icon.svg",title:"Pago Exitoso",body:"El pago se proces√≥ correctamente.",type:"success"}),r(o)}catch(u){z.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:u.message,type:"danger"}),i(u.message||"Error en el pago")}},document.addEventListener("culqi.error",function(u){var j,o;z.Notify.add({icon:"/assets/img/icon.svg",title:"Error en Culqi",body:((j=u.detail)==null?void 0:j.message)||"Error desconocido",type:"danger"}),i(((o=u.detail)==null?void 0:o.message)||"Error desconocido")})}catch(d){z.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:d.message,type:"danger"}),i("Error en la integraci√≥n con Culqi")}});class De{constructor(){this.baseURL="/api/payments"}async getPaymentMethods(){try{const r=await fetch(`${this.baseURL}/methods`),i=await r.json();if(!r.ok)throw new Error((i==null?void 0:i.message)??"Error obteniendo m√©todos de pago");return i}catch(r){throw console.error("Error fetching payment methods:",r),r}}async processPayment(r,i=null){var d;try{this.validatePaymentData(r);const u=new FormData;Object.keys(r).forEach(y=>{r[y]!==null&&r[y]!==void 0&&(typeof r[y]=="object"&&y!=="cart"||y==="cart"&&Array.isArray(r[y])?u.append(y,JSON.stringify(r[y])):u.append(y,r[y]))}),i&&u.append("payment_proof",i);const j=await fetch(`${this.baseURL}/process`,{method:"POST",headers:{"X-CSRF-TOKEN":(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content")},body:u}),o=await j.json();if(!j.ok)throw new Error((o==null?void 0:o.message)??"Error procesando el pago");return o}catch(u){throw console.error("Error processing payment:",u),u}}validatePaymentData(r){const d=["user_id","amount","cart","email","name","lastname","department","province","district","address","reference","payment_method"].filter(j=>!r[j]);if(d.length>0)throw new Error(`Campos requeridos faltantes: ${d.join(", ")}`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email))throw new Error("Email no v√°lido");if(isNaN(r.amount)||r.amount<=0)throw new Error("Monto no v√°lido");if(!Array.isArray(r.cart)||r.cart.length===0)throw new Error("Carrito vac√≠o o no v√°lido");return!0}calculateFee(r,i=0,d=0){const j=r*i/100+d;return Math.round(j*100)/100}formatAmountWithFees(r,i){if(!i)return{total:r,fee:0};const d=this.calculateFee(r,i.fee_percentage,i.fee_fixed),u=r+d;return{original:r,fee:d,total:u}}showSuccessNotification(r="Pago procesado exitosamente"){ee.success("Pago Exitoso",{description:r,duration:4e3})}showErrorNotification(r="Error procesando el pago"){ee.error("Error en el Pago",{description:r,duration:5e3})}}const G=new De,je=({title:x,description:r,selected:i,onSelect:d,disabled:u})=>e.jsxs("div",{className:`flex w-full items-center gap-3 p-4 border rounded-xl cursor-pointer transition-all duration-300 customtext-neutral-dark 
                }`,onClick:d,children:[e.jsx("div",{className:`w-5 h-5 border-2 rounded-full flex items-center justify-center ${i?"border-primary":""}`,children:i&&e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"})}),e.jsxs("div",{className:"customtext-neutral-light",children:[e.jsx("h4",{className:"text-sm ",children:x}),e.jsx("p",{className:"text-xs",children:r})]})]});function es({isOpen:x,onClose:r,paymentMethod:i,amount:d,onPaymentSuccess:u,onFileUpload:j,paymentProof:o,checkoutData:y}){const[p,m]=l.useState(1),[n,N]=l.useState([]),[v,s]=l.useState(!1),[k,B]=l.useState(!1);if(!x||!i)return null;const q=C=>{switch(C){case"gateway":return e.jsx(I,{size:24,className:"text-blue-600"});case"qr":return e.jsx(we,{size:24,className:"text-purple-600"});case"manual":return e.jsx(ve,{size:24,className:"text-green-600"});default:return e.jsx(I,{size:24,className:"text-gray-600"})}},f=(C=>{switch(C){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}})(i.type),h=i.configuration||{},R=i.instructions||{},S=C=>{if(!C)return"";const c={phone_number:h.phone_number||h.phone||"",amount:`S/ ${P(d)}`,bank_name:h.bank_name||"",account_number:h.account_number||"",cci:h.cci||"",holder_name:h.holder_name||""};let g=C;return Object.entries(c).forEach(([E,M])=>{const A=new RegExp(`{{\\s*${E}\\s*}}`,"g");g=g.replace(A,M)}),g},_=async()=>{var C;try{B(!0),console.log("Iniciando proceso de pago MercadoPago...");const c=await fetch("http://localhost:8000/api/mercadopago/preference",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((C=document.querySelector('meta[name="csrf-token"]'))==null?void 0:C.getAttribute("content"))||""},body:JSON.stringify({amount:d,title:"Compra BananaLab",description:"Productos BananaLab",checkout_data:y})});if(!c.ok)throw new Error(`Error ${c.status}: ${c.statusText}`);const g=await c.json();if(console.log("Preferencia creada:",g),g.status&&(g.init_point||g.sandbox_init_point)){const E=g.sandbox_init_point||g.init_point,M=!!g.sandbox_init_point;console.log(`Redirigiendo a MercadoPago (${M?"SANDBOX":"PRODUCCI√ìN"}):`,E),window.location.href=E}else throw new Error(g.message||"Error al crear la preferencia de pago")}catch(c){console.error("Error en pago MercadoPago:",c),B(!1),alert("Error al procesar el pago: "+c.message)}},T=C=>{navigator.clipboard.writeText(C)},K=C=>{const c=C.target.files[0];c&&j&&j(c)},Q=()=>{N([...n,p]),m(p+1)},V=()=>{s(!0),setTimeout(()=>{u(),r()},2e3)},W=()=>{const C=p;if(i.slug==="mercadopago"&&i.type==="gateway"&&C===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${f}-100 rounded-full mb-4`,children:q(i.type)}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Pago con ",i.name]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Ser√°s redirigido a MercadoPago para completar tu pago de forma segura"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",P(d)]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Y,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Pago 100% seguro con encriptaci√≥n SSL"})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Y,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Acepta tarjetas de cr√©dito, d√©bito y otros m√©todos"})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Y,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Confirmaci√≥n inmediata del pago"})]})]}),e.jsx("button",{onClick:_,disabled:k,className:`w-full bg-${f}-600 hover:bg-${f}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:20}),e.jsx("span",{children:"Pagar con MercadoPago"}),e.jsx(ae,{size:20})]})})]});if(i.type==="qr"){if(C===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${f}-100 rounded-full mb-4`,children:q(i.type)}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Pago con ",i.name]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Escanea el c√≥digo QR con tu aplicaci√≥n m√≥vil"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",P(d)]})]})}),h.qr_image&&e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"inline-block p-4 bg-white border-2 border-gray-200 rounded-lg",children:e.jsx("img",{src:h.qr_image,alt:"C√≥digo QR",className:"w-48 h-48 mx-auto"})})}),R.step1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Qe,{size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Instrucciones:"}),e.jsx("p",{className:"text-sm text-blue-800",children:S(R.step1)})]})]})}),e.jsxs("button",{onClick:Q,className:`w-full bg-${f}-600 hover:bg-${f}-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:[e.jsx("span",{children:"He realizado el pago"}),e.jsx(ae,{size:20})]})]});if(C===2)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${f}-100 rounded-full mb-4`,children:e.jsx(se,{size:24,className:`text-${f}-600`})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Comprobante de pago"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube tu comprobante para confirmar el pago"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"payment-proof",className:"hidden",accept:"image/*,.pdf",onChange:K}),e.jsxs("label",{htmlFor:"payment-proof",className:"cursor-pointer",children:[e.jsx(se,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para subir tu comprobante"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG o PDF (m√°x. 10MB)"})]})]}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{size:20,className:"text-green-600"}),e.jsxs("span",{className:"text-green-800",children:["Comprobante subido: ",o.name]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>m(1),className:"flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",children:[e.jsx(fe,{size:20}),e.jsx("span",{children:"Volver"})]}),e.jsx("button",{onClick:V,disabled:!o||v,className:`flex-1 bg-${f}-600 hover:bg-${f}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Confirmar Pago"}),e.jsx(Y,{size:20})]})})]})]})}if(i.type==="manual"){if(C===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${f}-100 rounded-full mb-4`,children:q(i.type)}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:i.name}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Realiza tu transferencia con los siguientes datos"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",P(d)]})]})}),e.jsxs("div",{className:"space-y-4",children:[h.bank_name&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Banco"}),e.jsx("p",{className:"font-medium text-gray-900",children:h.bank_name})]}),e.jsx("button",{onClick:()=>T(h.bank_name),className:"text-blue-600 hover:text-blue-700",children:e.jsx(te,{size:20})})]})}),h.account_number&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"N√∫mero de cuenta"}),e.jsx("p",{className:"font-medium text-gray-900",children:h.account_number})]}),e.jsx("button",{onClick:()=>T(h.account_number),className:"text-blue-600 hover:text-blue-700",children:e.jsx(te,{size:20})})]})}),h.cci&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"CCI"}),e.jsx("p",{className:"font-medium text-gray-900",children:h.cci})]}),e.jsx("button",{onClick:()=>T(h.cci),className:"text-blue-600 hover:text-blue-700",children:e.jsx(te,{size:20})})]})}),h.holder_name&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Titular"}),e.jsx("p",{className:"font-medium text-gray-900",children:h.holder_name})]}),e.jsx("button",{onClick:()=>T(h.holder_name),className:"text-blue-600 hover:text-blue-700",children:e.jsx(te,{size:20})})]})})]}),R.step1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ke,{size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Instrucciones importantes:"}),e.jsx("p",{className:"text-sm text-blue-800",children:S(R.step1)})]})]})}),e.jsxs("button",{onClick:Q,className:`w-full bg-${f}-600 hover:bg-${f}-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:[e.jsx("span",{children:"He realizado la transferencia"}),e.jsx(ae,{size:20})]})]});if(C===2)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${f}-100 rounded-full mb-4`,children:e.jsx(se,{size:24,className:`text-${f}-600`})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Comprobante de transferencia"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube tu voucher para confirmar la transferencia"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"payment-proof",className:"hidden",accept:"image/*,.pdf",onChange:K}),e.jsxs("label",{htmlFor:"payment-proof",className:"cursor-pointer",children:[e.jsx(se,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para subir tu voucher"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG o PDF (m√°x. 10MB)"})]})]}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{size:20,className:"text-green-600"}),e.jsxs("span",{className:"text-green-800",children:["Voucher subido: ",o.name]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>m(1),className:"flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",children:[e.jsx(fe,{size:20}),e.jsx("span",{children:"Volver"})]}),e.jsx("button",{onClick:V,disabled:!o||v,className:`flex-1 bg-${f}-600 hover:bg-${f}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Confirmar Pago"}),e.jsx(Y,{size:20})]})})]})]})}return null};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Proceso de Pago"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ne,{size:24})})]}),e.jsx("div",{className:"p-6",children:W()})]})})}const ss=({isOpen:x,onClose:r,amount:i,baseRequest:d,onPaymentSuccess:u,mercadoPagoConfig:j})=>{const[o,y]=l.useState({cardNumber:"",cardHolder:"",expirationMonth:"",expirationYear:"",securityCode:"",identificationType:"DNI",identificationNumber:"",installments:1}),[p,m]=l.useState({}),[n,N]=l.useState(!1),[v,s]=l.useState(null),[k,B]=l.useState([]),q=l.useRef(null),w=l.useRef(null),f=l.useRef(null),h=l.useRef(null),R=l.useRef(null),S=l.useRef(null);l.useEffect(()=>{x&&j&&_()},[x,j]);const _=async()=>{try{if(!window.MercadoPago){console.error("MercadoPago SDK no est√° cargado");return}window.MercadoPago.setPublishableKey(j.public_key),console.log("MercadoPago inicializado correctamente")}catch(c){console.error("Error inicializando formulario MP:",c)}},T=c=>{const{name:g,value:E}=c.target;y(M=>({...M,[g]:E})),p[g]&&m(M=>({...M,[g]:null})),g==="cardNumber"&&K(E)},K=c=>{const g=c.replace(/\s/g,"");g.startsWith("4")?s("visa"):g.startsWith("5")||g.startsWith("2")?s("master"):g.startsWith("3")?s("amex"):s(null)},Q=c=>c.replace(/\s/g,"").replace(/(.{4})/g,"$1 ").trim(),V=()=>{const c={};return(!o.cardNumber.replace(/\s/g,"")||o.cardNumber.replace(/\s/g,"").length<13)&&(c.cardNumber="N√∫mero de tarjeta inv√°lido"),o.cardHolder.trim()||(c.cardHolder="Nombre del titular requerido"),(!o.expirationMonth||!o.expirationYear)&&(c.expiration="Fecha de vencimiento requerida"),(!o.securityCode||o.securityCode.length<3)&&(c.securityCode="C√≥digo de seguridad inv√°lido"),o.identificationNumber.trim()||(c.identificationNumber="N√∫mero de documento requerido"),m(c),Object.keys(c).length===0},W=async c=>{var g;if(c.preventDefault(),!V()){ee.error("Por favor, complete todos los campos correctamente");return}N(!0);try{const E={cardNumber:o.cardNumber.replace(/\s/g,""),cardholderName:o.cardHolder,cardExpirationMonth:o.expirationMonth,cardExpirationYear:o.expirationYear,securityCode:o.securityCode,identificationType:o.identificationType,identificationNumber:o.identificationNumber},M=await C(E),A={...d,token:M.id,payment_method_id:M.payment_method_id,issuer_id:M.issuer_id,installments:o.installments,identification_type:o.identificationType,identification_number:o.identificationNumber},L=await(await fetch("/api/mercadopago/checkout-api",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(g=document.querySelector('meta[name="csrf-token"]'))==null?void 0:g.getAttribute("content")},body:JSON.stringify(A)})).json();if(L.status)ee.success("¬°Pago procesado exitosamente!"),u(L),r();else throw new Error(L.message||"Error procesando el pago")}catch(E){console.error("Error procesando pago MP:",E),ee.error(E.message||"Error procesando el pago")}finally{N(!1)}},C=async c=>new Promise((g,E)=>{if(!window.MercadoPago){E(new Error("MercadoPago SDK no est√° disponible"));return}window.MercadoPago.createToken({cardNumber:c.cardNumber,cardholderName:c.cardholderName,cardExpirationMonth:c.cardExpirationMonth,cardExpirationYear:c.cardExpirationYear,securityCode:c.securityCode,identificationType:c.identificationType,identificationNumber:c.identificationNumber},(M,A)=>{var X,L;M===200||M===201?g(A):(console.error("Error creando token MP:",A),E(new Error(((L=(X=A.cause)==null?void 0:X[0])==null?void 0:L.description)||"Error creando token de tarjeta")))})});return x?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full max-h-screen overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Pago con Tarjeta"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{ref:q,onSubmit:W,className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Total a pagar"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-800",children:["S/ ",i==null?void 0:i.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de tarjeta"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:w,type:"text",name:"cardNumber",value:Q(o.cardNumber),onChange:T,placeholder:"1234 5678 9012 3456",maxLength:"19",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.cardNumber?"border-red-500":"border-gray-300"}`}),v&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:v})})]}),p.cardNumber&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.cardNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del titular"}),e.jsx("input",{ref:f,type:"text",name:"cardHolder",value:o.cardHolder,onChange:T,placeholder:"Como aparece en la tarjeta",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.cardHolder?"border-red-500":"border-gray-300"}`}),p.cardHolder&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.cardHolder})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mes"}),e.jsxs("select",{ref:h,name:"expirationMonth",value:o.expirationMonth,onChange:T,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.expiration?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"MM"}),Array.from({length:12},(c,g)=>g+1).map(c=>e.jsx("option",{value:c.toString().padStart(2,"0"),children:c.toString().padStart(2,"0")},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"A√±o"}),e.jsxs("select",{ref:R,name:"expirationYear",value:o.expirationYear,onChange:T,className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.expiration?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"AA"}),Array.from({length:10},(c,g)=>new Date().getFullYear()+g).map(c=>e.jsx("option",{value:c.toString().slice(-2),children:c},c))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CVV"}),e.jsx("input",{ref:S,type:"text",name:"securityCode",value:o.securityCode,onChange:T,placeholder:"123",maxLength:"4",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.securityCode?"border-red-500":"border-gray-300"}`})]})]}),p.expiration&&e.jsx("p",{className:"text-red-500 text-sm",children:p.expiration}),p.securityCode&&e.jsx("p",{className:"text-red-500 text-sm",children:p.securityCode}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo"}),e.jsxs("select",{name:"identificationType",value:o.identificationType,onChange:T,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"DNI",children:"DNI"}),e.jsx("option",{value:"CE",children:"CE"}),e.jsx("option",{value:"PASSPORT",children:"Pasaporte"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N√∫mero de documento"}),e.jsx("input",{type:"text",name:"identificationNumber",value:o.identificationNumber,onChange:T,placeholder:"12345678",className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${p.identificationNumber?"border-red-500":"border-gray-300"}`}),p.identificationNumber&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p.identificationNumber})]})]}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-green-600"}),e.jsx("p",{className:"text-sm text-green-700",children:"Tus datos est√°n protegidos con encriptaci√≥n SSL"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:n,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 transition-colors flex items-center justify-center gap-2",children:n?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5"}),"Pagar S/ ",i==null?void 0:i.toFixed(2)]})})]})]})]})}):null};function ts({cart:x,setSale:r,setCode:i,setDelivery:d,setCart:u,onContinue:j,noContinue:o,subTotal:y,igv:p,totalFinal:m,user:n,setEnvio:N,envio:v}){var he;const[s,k]=l.useState({name:(n==null?void 0:n.name)||"",lastname:(n==null?void 0:n.lastname)||"",email:(n==null?void 0:n.email)||"",department:(n==null?void 0:n.department)||"",province:(n==null?void 0:n.province)||"",district:(n==null?void 0:n.district)||"",address:(n==null?void 0:n.address)||"",number:(n==null?void 0:n.number)||"",comment:(n==null?void 0:n.comment)||"",reference:(n==null?void 0:n.reference)||"",shippingOption:"delivery",paymentMethod:"culqi"}),[B,q]=l.useState(null),[w,f]=l.useState(null),[h,R]=l.useState(0),[S,_]=l.useState([]),[T,K]=l.useState(!0),[Q,V]=l.useState(!1),[W,C]=l.useState(null),[c,g]=l.useState(null),[E,M]=l.useState(null),[A,X]=l.useState(!1),[L,ne]=l.useState(!1),H=t=>{const{name:a,value:b}=t.target;k($=>({...$,[a]:b}))},Ce=t=>{k(b=>({...b,paymentMethod:t}));const a=S.find(b=>b.slug===t);a&&!a.requires_proof&&(q(null),f(null))},Pe=()=>({user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",country:"Per√∫",department:F||"",province:O||"",district:U||"",ubigeo:null,address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",reference:(s==null?void 0:s.reference)||"",amount:m||0,delivery:v,cart:x,payment_method:s.paymentMethod,invoiceType:s.invoiceType,documentType:s.documentType,document:s.document,businessName:s.businessName}),Se=()=>{const t=S.find(a=>a.slug===s.paymentMethod);t&&(C(t),V(!0))},ke=async t=>{try{if(!A)throw new Error("MercadoPago SDK no est√° inicializado");return ne(!0),new Promise((a,b)=>{window.mercadoPagoPaymentResolver={resolve:a,reject:b,baseRequest:t}})}catch(a){throw console.error("Error en MercadoPago Checkout API:",a),a}},Ee=t=>{window.mercadoPagoPaymentResolver&&(window.mercadoPagoPaymentResolver.resolve(t),window.mercadoPagoPaymentResolver=null),ne(!1)},Me=()=>{window.mercadoPagoPaymentResolver&&(window.mercadoPagoPaymentResolver.reject(new Error("Pago cancelado por el usuario")),window.mercadoPagoPaymentResolver=null),ne(!1)},_e=async()=>{const t={user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",country:"Per√∫",department:F||"",province:O||"",district:U||"",ubigeo:null,address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",reference:(s==null?void 0:s.reference)||"",amount:m||0,delivery:v,cart:x,payment_method:s.paymentMethod,invoiceType:s.invoiceType,documentType:s.documentType,document:s.document,businessName:s.businessName};try{const a=S.find($=>$.slug===s.paymentMethod);if(!a)throw new Error("M√©todo de pago no v√°lido");let b;if(a.type==="gateway")if(a.slug==="culqi"){if(!window.Culqi)throw new Error("Culqi a√∫n no se ha cargado.");b=await Ze(t)}else a.slug==="mercadopago"?b=await ke(t):b=await G.processPayment(t);else b=await G.processPayment(t,B);if(b&&b.status){r(b.sale),d(b.delivery),i(b.code),u([]),q(null),f(null);const $=a.type==="gateway"?"Pago procesado exitosamente":"Pedido creado. Te notificaremos cuando el pago sea verificado.";G.showSuccessNotification($),j()}else throw new Error((b==null?void 0:b.message)||"Error procesando el pago")}catch(a){throw console.error("Error en el pago:",a),G.showErrorNotification(a.message||"Error procesando el pago"),a}},[F,Te]=l.useState(""),[O,me]=l.useState(""),[U,oe]=l.useState(""),[$e,ze]=l.useState([]),[qe,Re]=l.useState([]),[Fe,xe]=l.useState([]),[rs,ns]=l.useState(0);l.useEffect(()=>{Ie()},[]),l.useEffect(()=>{Ae()},[]);const Ae=async()=>{try{const a=await(await fetch("/api/mercadopago/config")).json();a.status&&a.config&&(g(a.config),await Ye.initMercadoPago(a.config.public_key,{locale:"es-PE"}),X(!0),console.log("‚úÖ MercadoPago SDK inicializado correctamente"))}catch(t){console.error("‚ùå Error inicializando MercadoPago:",t)}},Ie=async()=>{try{const t=await G.getPaymentMethods();t.status&&t.methods?(_(t.methods),t.methods.length>0&&k(a=>({...a,paymentMethod:t.methods[0].slug}))):(console.error("Error en respuesta de m√©todos de pago:",t),G.showErrorNotification("Error al cargar m√©todos de pago"))}catch(t){console.error("Error fetching payment methods:",t),G.showErrorNotification("No se pudieron cargar los m√©todos de pago")}finally{K(!1)}};l.useEffect(()=>{const t=[...new Set(le.map(a=>a.departamento))];ze(t)},[]),l.useEffect(()=>{if(F){const t=[...new Set(le.filter(a=>a.departamento===F).map(a=>a.provincia))];Re(t),me(""),oe(""),xe([]),k(a=>({...a,department:F,province:"",district:""}))}},[F]),l.useEffect(()=>{if(O){const t=le.filter(a=>a.departamento===F&&a.provincia===O).map(a=>a.distrito);xe(t),oe(""),k(a=>({...a,province:O,district:""}))}},[O]),l.useEffect(()=>{U&&(k(a=>({...a,district:U})),(async()=>{try{const a=await He.getShippingCost({department:F,district:U});N(a.data.price),P(a.data.price)>0?pe("express"):pe("free")}catch(a){console.error("Error fetching shipping cost:",a),alert("No se pudo obtener el costo de env√≠o.")}})())},[U]);const Le=async t=>{if(t.preventDefault(),!n){z.Notify.add({icon:"/assets/img/icon.svg",title:"Iniciar Sesi√≥n",body:"Se requiere que inicie sesi√≥n para realizar la compra",type:"danger"});return}if(!s.department||!s.province||!s.district||!s.name||!s.lastname||!s.email||!s.address||!s.reference){z.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Formulario",body:"Completar los datos de env√≠o",type:"danger"});return}Se()},[ue,pe]=l.useState("free"),ge=(t,a)=>{switch(t){case"gateway":return e.jsx(I,{size:20});case"qr":return e.jsx(we,{size:20});case"manual":return e.jsx(ve,{size:20});default:return e.jsx(I,{size:20})}},Oe=t=>{switch(t){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("form",{className:"space-y-6",onSubmit:t=>t.preventDefault(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{type:"text",label:"Nombres",name:"name",value:s.name,onChange:H,placeholder:"Nombres"}),e.jsx(J,{label:"Apellidos",type:"text",name:"lastname",value:s.lastname,onChange:H,placeholder:"Apellidos"})]}),e.jsx(J,{label:"Correo electr√≥nico",type:"email",name:"email",value:s.email,onChange:H,placeholder:"Ej. hola@gmail.com"}),e.jsx(ce,{label:"Departamento",options:$e,placeholder:"Selecciona un Departamento",onChange:t=>{Te(t),k(a=>({...a,department:F}))}}),e.jsx(ce,{disabled:!F,label:"Provincia",options:qe,placeholder:"Selecciona una Provincia",onChange:t=>{me(t),k(a=>({...a,province:O}))}}),e.jsx(ce,{disabled:!O,label:"Distrito",options:Fe,placeholder:"Selecciona un Distrito",onChange:t=>{oe(t),k(a=>({...a,district:U}))}}),e.jsx(J,{label:"Avenida / Calle / Jir√≥n",type:"text",name:"address",value:s.address,onChange:H,placeholder:"Ingresa el nombre de la calle"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{label:"N√∫mero",type:"text",name:"number",value:s.number,onChange:H,placeholder:"Ingresa el n√∫mero de la calle"}),e.jsx(J,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque (opcional)",type:"text",name:"comment",value:s.comment,onChange:H,placeholder:"Ej. Casa 3, Dpto 101"})]}),e.jsx(J,{label:"Referencia",type:"text",name:"reference",value:s.reference,onChange:H,placeholder:"Ejem. Altura de la avenida..."}),"                    ",e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(I,{size:20,className:"text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"M√©todo de Pago"})]}),T?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Cargando m√©todos de pago..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-xl",children:[e.jsx(I,{size:48,className:"mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No hay m√©todos de pago disponibles"})]}):e.jsx("div",{className:"space-y-3",children:S.map(t=>e.jsxs("div",{className:`group relative border-2 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:shadow-lg ${s.paymentMethod===t.slug?"border-primary bg-primary/5 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>Ce(t.slug),children:[s.paymentMethod===t.slug&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(Ge,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-200 ${s.paymentMethod===t.slug?"bg-primary text-white shadow-lg":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.icon?e.jsx("img",{src:t.icon,alt:t.name,className:"w-8 h-8 object-contain"}):ge(t.type,t.slug)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.type==="gateway"?"bg-blue-100 text-blue-800":t.type==="qr"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:t.type==="gateway"?"Online":t.type==="qr"?"QR":"Manual"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),e.jsx("div",{className:"flex items-center gap-2 text-xs mt-1",children:t.fee_percentage>0||t.fee_fixed>0?e.jsxs("span",{className:"text-orange-600 font-medium",children:[t.fee_percentage>0&&`+${t.fee_percentage}%`,t.fee_percentage>0&&t.fee_fixed>0&&" ",t.fee_fixed>0&&`+S/ ${P(t.fee_fixed)}`]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Sin comisi√≥n"})})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 transition-all duration-200 ${s.paymentMethod===t.slug?"border-primary bg-primary":"border-gray-300 group-hover:border-gray-400"}`,children:s.paymentMethod===t.slug&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]})]},t.slug))}),(()=>{const t=S.find(Ve=>Ve.slug===s.paymentMethod);if(!t)return null;const a=Oe(t.type),b=()=>a==="blue"?"bg-blue-50 border-blue-200":a==="purple"?"bg-purple-50 border-purple-200":a==="green"?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200",$=()=>a==="blue"?"bg-blue-100":a==="purple"?"bg-purple-100":a==="green"?"bg-green-100":"bg-gray-100",Z=()=>a==="blue"?"text-blue-800":a==="purple"?"text-purple-800":a==="green"?"text-green-800":"text-gray-800",ie=()=>a==="blue"?"text-blue-700":a==="purple"?"text-purple-700":a==="green"?"text-green-700":"text-gray-700",Be=()=>a==="blue"?"text-blue-600":a==="purple"?"text-purple-600":a==="green"?"text-green-600":"text-gray-600";return e.jsxs("div",{className:`border rounded-xl p-4 ${b()}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${$()}`,children:ge(t.type,t.slug)}),e.jsxs("h4",{className:`font-semibold ${Z()}`,children:[t.name," - ",t.type==="gateway"?"Pago Online":"Proceso Paso a Paso"]})]}),e.jsx("p",{className:`text-sm mb-3 ${ie()}`,children:t.type==="gateway"?"Te redirigiremos al gateway de pago seguro para procesar tu transacci√≥n.":"Te guiaremos paso a paso para completar tu pago de forma f√°cil y segura."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:16,className:Be()}),e.jsxs("span",{className:`text-sm font-medium ${Z()}`,children:["Monto total: S/ ",P(m)]})]})]})})()]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(je,{title:"Env√≠o gratis",description:"Entrega entre 3 a 10 d√≠as h√°biles",selected:ue==="free"}),e.jsx(je,{title:"Delivery",description:"Delivery 24 horas",selected:ue==="express"})]}),e.jsxs("div",{className:"flex gap-4 mt-6 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(be,{className:"customtext-primary",width:"20px"})}),e.jsxs("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:[e.jsx("p",{children:"Solo Lima Metropolitana: Dentro de las 24 horas despu√©s de efectuado el pago, solo algunos distritos de Lima Metropolitana."}),e.jsxs("p",{children:[" ","Distritos No incluidos: Santa Mar√≠a del Mar, Pucusana, San Bartolo, Punta Hermosa, Lur√≠n, Pachacamac, Chorrillos, Villa el Salvador, Villa Mar√≠a del Triunfo, San Juan de Miraflores, Cieneguilla, Ate, Chosica, Huaycan, San Juan de Lurigancho (hasta el Metro), Anc√≥n, Santa Rosa, Carabayllo, Puente Piedra."]}),e.jsxs("p",{children:[" ","Same Day: Solo para compras efectuadas hasta las 1pm del d√≠a."]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(be,{className:"customtext-primary",width:"20px"})}),e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:e.jsx("p",{children:"Lima: 3 a 4 dias h√°biles | Provincia: de 4 a 10 dias h√°biles"})})]})]}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:x.map((t,a)=>{var b,$;return e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl",children:e.jsx("img",{src:t.type==="custom_album"?`/storage/images/item_preset/${t.image}`:`/storage/images/item/${t.image}`,alt:t.name,className:"w-20 h-20 object-cover rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:t.name}),t.type==="custom_album"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Tipo:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:"√Ålbum Personalizado"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["P√°ginas:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:((b=t.album_data)==null?void 0:b.pages_count)||"N/A"})]})]}):e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:(($=t.brand)==null?void 0:$.name)||"Sin marca"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:t.quantity||1})]})]})]})},t.id)})}),e.jsxs("div",{className:"space-y-4 mt-6",children:[(()=>{const t=x.reduce((a,b)=>{const $=b.price||0,Z=b.final_price||b.price||0,ie=b.quantity||1;return $>Z?a+($-Z)*ie:a},0);return t>0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",P(t)]})]}):null})(),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(y)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(p)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(v)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",P(m)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(de,{onClick:Le,children:(()=>{const t=S.find(a=>a.slug===s.paymentMethod);if(!t)return"Continuar";switch(t.type){case"gateway":return`Pagar con ${t.name}`;case"qr":case"manual":return`Confirmar ${t.name}`;default:return"Continuar"}})()}),e.jsx(ye,{onClick:o,children:"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",e.jsx("a",{className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",e.jsx("a",{className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]}),e.jsx(es,{isOpen:Q,onClose:()=>V(!1),paymentMethod:W,amount:m,onPaymentSuccess:_e,checkoutData:Pe()}),e.jsx(ss,{isOpen:L,onClose:Me,amount:m,baseRequest:((he=window.mercadoPagoPaymentResolver)==null?void 0:he.baseRequest)||{},onPaymentSuccess:Ee,mercadoPagoConfig:c})]})}function as({cart:x,code:r,delivery:i,sale:d}){console.log("üéâ ConfirmationStep: Mostrando confirmaci√≥n",{cart:x,code:r,delivery:i,sale:d});let u=x,j=0,o=i||0;d&&d.details&&d.details.length>0?(u=d.details.map(m=>{var n,N,v;return{id:m.item_id,name:m.name,image:((n=m.item)==null?void 0:n.image)||"default.jpg",price:m.price,final_price:m.price,quantity:m.quantity,brand:((N=m.item)==null?void 0:N.brand)||{name:"N/A"},sku:((v=m.item)==null?void 0:v.sku)||"N/A"}}),j=parseFloat(d.amount||0),o=parseFloat(d.delivery||0)):j=x.reduce((n,N)=>{const v=N.final_price;return n+v*N.quantity},0)+parseFloat(i||0);const y=((j-o)/1.18).toFixed(2),p=(y*.18).toFixed(2);return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h2",{className:"text-[20px] customtext-neutral-light",children:"Gracias por tu compra üéâ"}),e.jsx("p",{className:"customtext-neutral-dark text-5xl font-semibold",children:"Tu orden ha sido recibida"}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:" customtext-neutral-light",children:"C√≥digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-lg font-semibold",children:`#${r}`})]}),e.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:u.map((m,n)=>{var N;return e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl w-max",children:e.jsx("img",{src:m.image?`/storage/images/item/${m.image}`:"/assets/img/default-product.jpg",alt:m.name,className:"w-20 h-20 object-cover rounded",onError:v=>{v.target.src="/assets/img/default-product.jpg"}})}),e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:m.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:((N=m.brand)==null?void 0:N.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark",children:m.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:m.sku||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Precio: ",e.jsxs("span",{className:"customtext-neutral-dark",children:["S/ ",P(m.price||m.final_price)]})]})]})]})},n)})}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(y)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(p)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",P(o)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",P(j)]})]})})]}),e.jsx("div",{className:"pt-3",children:e.jsx(de,{href:"/catalogo",children:"  Seguir Comprando"})})]})]})})})}function Is({cart:x,setCart:r,user:i}){const[d,u]=l.useState(1);l.useEffect(()=>{const w=new URLSearchParams(window.location.search),f=w.get("step"),h=w.get("status"),R=w.get("payment_type"),S=w.get("order");console.log("üîç CheckoutSteps: Par√°metros URL detectados:",{step:f,status:h,paymentType:R,orderNumber:S}),f==="3"&&h==="success"&&R==="mercadopago"&&(console.log("‚úÖ CheckoutSteps: Pago exitoso de MercadoPago detectado, navegando al paso 3"),u(3),S&&(k(S),fetch(`/api/sales/by-code/${S}`).then(_=>_.json()).then(_=>{_.status&&_.sale?(console.log("‚úÖ Venta encontrada:",_.sale),v(_.sale),window.Notify&&window.Notify.add({icon:"/assets/img/icon.svg",title:"¬°Pago exitoso!",body:`Tu pago con MercadoPago ha sido procesado correctamente. Operaci√≥n: ${S}`,type:"success"}),r([]),z.Local.remove(`${D.APP_CORRELATIVE}_cart`)):console.warn("‚ö†Ô∏è Venta no encontrada para:",S)}).catch(_=>{console.error("‚ùå Error buscando venta:",_)})),window.history.replaceState({},document.title,window.location.pathname))},[]);const o=(x.reduce((w,f)=>{const h=f.final_price;return w+h*f.quantity},0)/1.18).toFixed(2),y=(o*.18).toFixed(2),[p,m]=l.useState(0),n=parseFloat(o)+parseFloat(y)+parseFloat(p),[N,v]=l.useState([]),[s,k]=l.useState([]),[B,q]=l.useState([]);return l.useEffect(()=>{console.log("üîÑ CheckoutSteps: Sincronizando carrito con localStorage...");const w=z.Local.get(`${D.APP_CORRELATIVE}_cart`)||[];console.log("üì¶ CheckoutSteps: Carrito desde localStorage:",w),w.length>0&&JSON.stringify(w)!==JSON.stringify(x)&&(console.log("‚úÖ CheckoutSteps: Actualizando carrito desde localStorage"),r(w))},[]),l.useEffect(()=>{const w=f=>{console.log("üì¢ CheckoutSteps: Carrito actualizado:",f.detail);const h=z.Local.get(`${D.APP_CORRELATIVE}_cart`)||[];console.log("üîÑ CheckoutSteps: Cargando carrito actualizado:",h),r(h)};return window.addEventListener("cartUpdated",w),()=>{window.removeEventListener("cartUpdated",w)}},[r]),l.useEffect(()=>{const w=document.createElement("script");return w.src="https://checkout.culqi.com/js/v4",w.async=!0,w.onload=()=>{console.log("‚úÖ Culqi cargado correctamente."),window.culqi=function(){window.Culqi.token?console.log("‚úÖ Token recibido:",window.Culqi.token.id):window.Culqi.order?console.log("‚úÖ Orden recibida:",window.Culqi.order):console.error("‚ùå Error en Culqi:",window.Culqi.error)}},document.body.appendChild(w),()=>{document.body.removeChild(w)}},[]),e.jsx("div",{className:"min-h-screen  py-12 px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white   p-8 rounded-xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:`text-sm ${d===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"1. Carrito de compra"}),e.jsx("div",{className:`text-sm ${d===2?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"2. Detalles de env√≠o"}),e.jsx("div",{className:`text-sm ${d===3?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"3. Orden confirmada"})]}),e.jsx("div",{className:"mt-4 h-1 max-w-3xl mx-auto bg-gray-200",children:e.jsx("div",{className:"h-1 bg-primary transition-all duration-500",style:{width:`${(d-1)/2*100}%`}})})]}),d===1&&e.jsx(We,{cart:x,setCart:r,onContinue:()=>u(2),subTotal:o,envio:p,igv:y,totalFinal:n}),d===2&&e.jsx(ts,{setCode:k,setDelivery:q,cart:x,setSale:v,setCart:r,onContinue:()=>u(3),noContinue:()=>u(1),subTotal:o,envio:p,setEnvio:m,igv:y,totalFinal:n,user:i}),d===3&&e.jsx(as,{code:s,delivery:B,cart:x,sale:N,subTotal:o,envio:p,igv:y,totalFinal:n})]})})}export{Is as default};
