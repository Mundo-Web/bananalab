var ka=Object.defineProperty;var $a=(N,m,v)=>m in N?ka(N,m,{enumerable:!0,configurable:!0,writable:!0,value:v}):N[m]=v;var ae=(N,m,v)=>$a(N,typeof m!="symbol"?m+"":m,v);import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ga}from"./Base-iD3WjR8i.js";import{S as U}from"./SwitchFormGroup-zwNBvRf7.js";import{T as na}from"./TextareaFormGroup-CdwdsTk2.js";import{r as s}from"./index-BH53Isel.js";import{c as Ta}from"./ReactAppend-DTVVXReZ.js";import{s as $e}from"./DxBox-CTFD8z_X.js";import{S as y}from"./ProductCard-Bvp3XiVT.js";import"./main-BvVILmTO.js";import{B as Ma}from"./ModalImportItem-edN7nyz1.js";import{M as Ge}from"./Modal-BJ3DTV_x.js";import{T as Aa}from"./Table-cP0w99G1.js";import{I as k}from"./ImageFormGroup-Dx5myhwn.js";import{I as p}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ba}from"./QuillFormGroup-D8zDHSfJ.js";import{S as ia}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as la}from"./SelectFormGroup-BPkIDnvX.js";import{D as Te}from"./DxButton-CsjWvhyj.js";import{C as Oa}from"./CreateReactScript-DSwc0KqF.js";import{N as H}from"./Number2Currency-e57Tgsuk.js";import{R as M}from"./ReactAppend-D7S498fx.js";import{S as za}from"./SetSelectValue-UxyCmHse.js";import{I as La}from"./ItemPresetsRest-Dmbx2fkO.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./General-BmbBKdsB.js";const Va=({label:N,structure:m,onChange:v,typeOptions:b=[]})=>{const[f,j]=s.useState([]),I=()=>{j(typeof m=="object"?[...f,{...m}]:[...f,""])},D=i=>{const x=f.filter((h,l)=>l!==i);j(x),v(x)},S=(i,x,h)=>{const l=[...f];typeof l[i]=="object"?l[i][x]=h:l[i]=h,j(l),v(l)};return e.jsxs("div",{className:"dynamic-field-container",children:[e.jsx("label",{className:"form-label",children:N}),e.jsx("div",{className:"fields-list",children:f.map((i,x)=>e.jsxs("div",{className:"field-row",children:[typeof i=="object"?Object.keys(m).map(h=>e.jsx("div",{className:"field-input",children:h==="type"?e.jsxs("select",{className:"form-select select-type",value:i[h],onChange:l=>S(x,h,l.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar..."}),b.map(l=>e.jsx("option",{value:l,children:l},l))]}):e.jsx("input",{type:"text",className:"form-control ",value:i[h],onChange:l=>S(x,h,l.target.value),placeholder:h.charAt(0).toUpperCase()+h.slice(1)})},h)):e.jsx("div",{className:"field-input",children:e.jsx("input",{type:"text",className:"form-control ",value:i,onChange:h=>S(x,null,h.target.value),placeholder:"Nueva característica"})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger remove-btn",onClick:()=>D(x),children:e.jsx("i",{className:"fas fa-times"})})]},x))}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary add-btn",onClick:I,children:[e.jsx("i",{className:"fas fa-plus me-1"})," Agregar"]}),e.jsx("style",{jsx:!0,children:`
                .dynamic-field-container {
                    margin-bottom: 1rem;
                }

                .fields-list {
                    margin-bottom: 0.5rem;
                }

                .field-row {
                    display: flex;
                    gap: 0.5rem;
                    margin-bottom: 0.5rem;
                    align-items: center;
                }

                .field-input {
                    flex: 1;
                }

                .remove-btn {
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 0;
                }

                .add-btn {
                    width: 100%;
                }
            `})]})};class oa extends Ma{constructor(){super(...arguments);ae(this,"path","admin/items");ae(this,"hasFiles",!0);ae(this,"importData",async v=>{console.log("FormData recibido en importData:",[...v.entries()]);try{const b=await fetch("/api/import-items",{method:"POST",body:v}),f=await b.json();if(console.log("Respuesta del servidor:",f),!b.ok)throw new Error((f==null?void 0:f.error)??(f==null?void 0:f.message)??"Error en la importación");return f}catch(b){throw console.error("Error en importData:",b.message),b}})}}const Ja=new oa,qa=({gridRef:N,modalRef:m})=>{const[v,b]=s.useState(null),[f,j]=s.useState(!1),[I,D]=s.useState(""),[S,i]=s.useState(!1),x=l=>{b(l.target.files[0])},h=async()=>{var P,w;if(!v){D("Por favor, selecciona un archivo."),i(!0);return}const l=new FormData;l.append("file",v),j(!0);try{const d=await Ja.importData(l);if(console.log(d),d.error){const C=Array.isArray(d.error)?d.error.join(`
`):d.error;D(`Error en la importación:
${C}`),i(!0)}else D(d.message),i(!1),$(N.current).dxDataGrid("instance").refresh(),m.current&&m.current.close()}catch(d){D("Error al importar: "+(((w=(P=d.response)==null?void 0:P.data)==null?void 0:w.error)||d.message)),i(!0)}j(!1)};return e.jsx("div",{className:"bg-white",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{children:e.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:x})}),e.jsx("button",{onClick:h,disabled:f,className:"btn btn-primary mt-2",type:"button",children:f?"Subiendo...":"Subir Archivo"}),I&&e.jsx("div",{className:`alert ${S?"alert-danger":"alert-success"} mt-2`,role:"alert",children:e.jsx("div",{className:"alert-message",children:I})})]})})},re=new oa,F=new La,Ua=({categories:N,brands:m,collections:v})=>{const[b,f]=s.useState([]),j=s.useRef(),I=s.useRef(),[D,S]=s.useState(!1),[i,x]=s.useState(null),[h,l]=s.useState([]),P=s.useRef(),w=s.useRef(),d=s.useRef(null),C=s.useRef(),te=s.useRef(),W=s.useRef(),se=s.useRef(),G=s.useRef(),ne=s.useRef(),Q=s.useRef(),ie=s.useRef(),A=s.useRef(),le=s.useRef(),B=s.useRef(),O=s.useRef(),z=s.useRef(),L=s.useRef(),oe=s.useRef(),ce=s.useRef(),de=s.useRef(),me=s.useRef(),ue=s.useRef(),fe=s.useRef(),pe=s.useRef(),he=s.useRef(),ge=s.useRef(),xe=s.useRef(),ve=s.useRef(),[X,ca]=s.useState(!1),[R,V]=s.useState("basic"),[da,Y]=s.useState(!1),[Me,Ae]=s.useState(!1),be=s.useRef(),je=s.useRef(),Ne=s.useRef(),ye=s.useRef(),we=s.useRef(),Re=s.useRef(),Ce=s.useRef(),Pe=s.useRef(),_e=s.useRef(),Ie=s.useRef(),K=s.useRef(),Se=s.useRef(),Ee=s.useRef(),Fe=s.useRef();s.useRef([]);const[ma,ua]=s.useState(!1),[fa,pa]=s.useState(null),[ha,ga]=s.useState(null),[Z,T]=s.useState([]),Be=s.useRef(),[xa,va]=s.useState([]),[ba,Oe]=s.useState([]),[Ha,Wa]=s.useState(!1),ze=s.useRef(),ja=async a=>{if(console.log("openPresetsModal called with item:",a),!a||!a.id){y.fire({title:"Error",text:"No se ha seleccionado un item válido para gestionar presets.",icon:"error"});return}console.log("Setting selectedItemForPresets:",a),x(a),d.current=a,S(!0),$(P.current).modal("show"),$(P.current).on("shown.bs.modal",async function(){console.log("Modal shown, loading presets for item:",a.id),await _a(a.id),$(P.current).off("shown.bs.modal")})};s.useEffect(()=>{if(P.current){const a=P.current,r=()=>{if(w.current)try{const t=$(w.current).dxDataGrid("instance");t&&t.dispose()}catch(t){console.warn("Error disposing DataGrid:",t)}S(!1),x(null),d.current=null,l([])};return $(a).on("hidden.bs.modal",r),()=>{$(a).off("hidden.bs.modal",r)}}},[]),s.useEffect(()=>{const a=()=>{console.log("presetModal is opening - currentItemForPresetsRef:",d.current),console.log("presetModal is opening - selectedItemForPresets:",i)},r=()=>{console.log("presetModal is closing")};return $("#presetModal").on("shown.bs.modal",a),$("#presetModal").on("hidden.bs.modal",r),()=>{$("#presetModal").off("shown.bs.modal",a),$("#presetModal").off("hidden.bs.modal",r)}},[i]);const Na=a=>{const t=Array.from(a.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},ya=a=>{a.preventDefault();const t=Array.from(a.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));T(n=>[...n,...t])},wa=a=>a.preventDefault(),Ra=(a,r)=>{a.preventDefault(),Z[r].id?T(n=>n.map((o,u)=>u===r?{...o,toDelete:!0}:o)):T(n=>n.filter((o,u)=>u!==r))};s.useEffect(()=>{if(b&&b.images){const a=b.images.map(r=>({id:r.id,url:`/storage/images/item_image/${r.url}`}));T(a)}},[b]);const Le=a=>{var r,t;f(a||null),ua(!!(a!=null&&a.id)),be.current.value=(a==null?void 0:a.id)||"",$(je.current).val((a==null?void 0:a.category_id)||null).trigger("change"),$(Ne.current).val((a==null?void 0:a.collection_id)||null).trigger("change"),za(ye.current,(r=a==null?void 0:a.subcategory)==null?void 0:r.id,(t=a==null?void 0:a.subcategory)==null?void 0:t.name),$(we.current).val((a==null?void 0:a.brand_id)||null).trigger("change"),Re.current.value=(a==null?void 0:a.name)||"",Ce.current.value=(a==null?void 0:a.color)||"",Pe.current.value=(a==null?void 0:a.summary)||"",_e.current.value=(a==null?void 0:a.price)||0,Ie.current.value=(a==null?void 0:a.discount)||0,Fe.current.value=(a==null?void 0:a.stock)||0,K.current.value=null,K.image.src=`/storage/images/item/${(a==null?void 0:a.image)??"undefined"}`,Se.image.src=`/storage/images/item/${(a==null?void 0:a.texture)??"undefined"}`,Ee.editor.root.innerHTML=(a==null?void 0:a.description)??"",va((a==null?void 0:a.features)||[]),Oe((a==null?void 0:a.specifications)||[]),$(I.current).modal("show")},Ca=async a=>{a.preventDefault();const r={id:be.current.value||void 0,category_id:je.current.value,collection_id:Ne.current.value||null,subcategory_id:ye.current.value,brand_id:we.current.value,name:Re.current.value,color:Ce.current.value,summary:Pe.current.value,price:_e.current.value,discount:Ie.current.value,description:Ee.current.value,stock:Fe.current.value},t=new FormData;for(const g in r)t.append(g,r[g]);t.append("features",JSON.stringify(xa)),t.append("specifications",JSON.stringify(ba));const n=K.current.files[0];n&&t.append("image",n);const o=Se.current.files[0];o&&t.append("texture",o),Z.forEach((g,E)=>{g.toDelete||(g.file?t.append(`gallery[${E}]`,g.file):t.append(`gallery_ids[${E}]`,g.id))});const u=Z.filter(g=>g.toDelete).map(g=>parseInt(g.id,10));u.length>0&&t.append("deleted_images",JSON.stringify(u)),await re.save(t)&&($(j.current).dxDataGrid("instance").refresh(),$(I.current).modal("hide"),T([]))},Pa=async({id:a,value:r})=>{await re.boolean({id:a,field:"visible",value:r})&&$(j.current).dxDataGrid("instance").refresh()},ee=async({id:a,field:r,value:t})=>{await re.boolean({id:a,field:r,value:t})&&$(j.current).dxDataGrid("instance").refresh()};function _a(a){if(!a){console.warn("loadPresets called without itemId");return}console.log("loadPresets called with itemId:",a),Y(!0),l([]),F.getByItem(a).then(r=>{console.log("loadPresets result:",r);const t=r.data||[];l(t),setTimeout(()=>{console.log("Attempting to initialize presets grid with data:",t),ke(t)},300)}).catch(r=>{console.error("Error loading presets:",r),l([]),y.fire({title:"Error",text:"No se pudieron cargar los presets. Por favor, intenta nuevamente.",icon:"error"})}).finally(()=>{Y(!1)})}const Ve=(a=null,r=null)=>{var o,u,_,g,E,J,q;const t=r||i||d.current;if(!t||!t.id){y.fire({title:"Error",text:"No hay item seleccionado para gestionar presets. Por favor, selecciona un item válido.",icon:"error"});return}x(t),d.current=t,ca(!!(a!=null&&a.id)),V("basic"),C.current.value=(a==null?void 0:a.id)||"",te.current.value=(t==null?void 0:t.id)||"",W.current.value=(a==null?void 0:a.name)||"",se.current.value=(a==null?void 0:a.description)||"",G.current.value=(a==null?void 0:a.price)||"",ne.current.value=(a==null?void 0:a.discount)||0,ie.current.value=(a==null?void 0:a.sort_order)||0,A.current.value=a!=null&&a.configuration?JSON.stringify(a.configuration,null,2):"",le.current.checked=(a==null?void 0:a.is_active)!==!1,Q.image.src=`/storage/images/item_preset/${(a==null?void 0:a.image)??"undefined"}`,B.current&&(B.image.src=`/storage/images/item_preset/${(a==null?void 0:a.cover_image)??"undefined"}`),O.current&&(O.image.src=`/storage/images/item_preset/${(a==null?void 0:a.content_layer_image)??"undefined"}`),z.current&&(z.image.src=`/storage/images/item_preset/${(a==null?void 0:a.final_layer_image)??"undefined"}`),L.current&&(L.image.src=`/storage/images/item_preset/${(a==null?void 0:a.preview_image)??"undefined"}`);let n={};a!=null&&a.canvas_config&&(n=typeof a.canvas_config=="string"?JSON.parse(a.canvas_config):a.canvas_config),oe.current.value=n.width||1e3,ce.current.value=n.height||1e3,de.current.value=n.dpi||300,me.current.value=n.background_color||"#ffffff",ue.current.value=((o=a==null?void 0:a.content_layer_config)==null?void 0:o.x)||0,fe.current.value=((u=a==null?void 0:a.content_layer_config)==null?void 0:u.y)||0,pe.current.value=((_=a==null?void 0:a.content_layer_config)==null?void 0:_.width)||1e3,he.current.value=((g=a==null?void 0:a.content_layer_config)==null?void 0:g.height)||1e3,ge.current.value=((E=a==null?void 0:a.content_layer_config)==null?void 0:E.rotation)||0,xe.current.value=((J=a==null?void 0:a.content_layer_config)==null?void 0:J.opacity)||1,ve.current.value=((q=a==null?void 0:a.content_layer_config)==null?void 0:q.fit_mode)||"cover",console.log("onPresetModalOpen - antes de mostrar modal, selectedItemForPresets:",i,"targetItem:",t),$("#presetModal").modal("show")},De=a=>{if(console.log("updatePresetsGrid called with data:",a),!w.current){console.warn("presetsGridRef.current is null in updatePresetsGrid");return}try{const r=$(w.current).dxDataGrid("instance");r?(console.log("Updating existing DataGrid instance"),r.option("dataSource",a)):(console.log("No DataGrid instance found, initializing new one"),ke(a))}catch(r){console.warn("DataGrid instance not available, will initialize on next load",r)}},ke=a=>{if(console.log("initializePresetsGrid called with data:",a),!w.current){console.warn("presetsGridRef.current is null in initializePresetsGrid");return}if(!$(w.current).is(":visible")){console.warn("Grid element is not visible, retrying in 500ms"),setTimeout(()=>ke(a),500);return}try{const r=$(w.current).dxDataGrid("instance");if(r){console.log("DataGrid already initialized, updating data"),r.option("dataSource",a);return}}catch{console.log("No existing DataGrid instance found, creating new one")}console.log("Creating new DataGrid instance"),$(w.current).dxDataGrid({dataSource:a,keyExpr:"id",showBorders:!0,columnAutoWidth:!0,searchPanel:{visible:!0,placeholder:"Buscar presets..."},filterRow:{visible:!0},headerFilter:{visible:!0},paging:{enabled:!1},onContentReady:function(){console.log("DataGrid content ready with",a.length,"items")},columns:[{dataField:"name",caption:"Nombre",width:"200px"},{dataField:"description",caption:"Descripción",width:"250px"},{dataField:"price",caption:"Precio",width:"80px",cellTemplate:(r,t)=>{r.text(`S/. ${H(t.value)}`)}},{dataField:"discount",caption:"Descuento",width:"80px",cellTemplate:(r,t)=>{t.value>0?r.text(`S/. ${H(t.value)}`):r.text("-")}},{caption:"Precio Final",width:"100px",cellTemplate:(r,t)=>{const n=t.data.discount>0?t.data.price-t.data.discount:t.data.price;r.html(`<span class="fw-bold text-success">S/. ${H(n)}</span>`)}},{dataField:"sort_order",caption:"Orden",width:"70px"},{dataField:"is_active",caption:"Estado",width:"100px",cellTemplate:(r,t)=>{const n=document.createElement("div");n.className="form-check form-switch";const o=document.createElement("input");o.className="form-check-input",o.type="checkbox",o.checked=t.value,o.onchange=u=>Sa({id:t.data.id,value:u.target.checked}),n.appendChild(o),r.append(n)}},{caption:"Acciones",width:"120px",allowFiltering:!1,allowSorting:!1,cellTemplate:(r,t)=>{const n=document.createElement("div");n.className="d-flex gap-1";const o=document.createElement("button");o.className="btn btn-sm btn-outline-primary",o.innerHTML='<i class="fas fa-edit"></i>',o.title="Editar preset",o.onclick=()=>{const _=i||d.current;console.log("Edit preset clicked - item:",_,"preset:",t.data),Ve(t.data,_)};const u=document.createElement("button");u.className="btn btn-sm btn-outline-danger",u.innerHTML='<i class="fas fa-trash"></i>',u.title="Eliminar preset",u.onclick=()=>Ea(t.data.id),n.appendChild(o),n.appendChild(u),r.append(n)}}]})},Ia=async a=>{var o,u,_,g,E,J,q,Je,qe,Ue,He,We,Qe,Xe,Ye,Ke,Ze,ea,aa,ra,ta;a.preventDefault();const r=i||d.current,t=(o=te.current)==null?void 0:o.value;console.log("onPresetSubmit - selectedItemForPresets:",i),console.log("onPresetSubmit - currentItemForPresetsRef.current:",d.current),console.log("onPresetSubmit - targetItem:",r),console.log("onPresetSubmit - itemIdFromForm:",t);const n=(r==null?void 0:r.id)||t;if(!n){y.fire({title:"Error",text:"No hay item seleccionado para asociar el preset. Por favor, cierra este modal y vuelve a abrir desde el botón 'Gestionar Presets' del item deseado.",icon:"error"});return}Ae(!0);try{if(!((_=(u=W.current)==null?void 0:u.value)!=null&&_.trim()))throw new Error("El nombre es obligatorio");if(!((g=G.current)!=null&&g.value)||isNaN(parseFloat(G.current.value)))throw new Error("El precio debe ser un número válido");if(parseFloat(G.current.value)<0)throw new Error("El precio no puede ser negativo");const c=new FormData;if((E=C.current)!=null&&E.value&&c.append("id",C.current.value),c.append("item_id",n),c.append("name",W.current.value.trim()),c.append("description",se.current.value||""),c.append("price",G.current.value),c.append("discount",ne.current.value||0),c.append("sort_order",ie.current.value||0),c.append("is_active",le.current.checked?1:0),A.current.value.trim())try{JSON.parse(A.current.value),c.append("configuration",A.current.value)}catch{throw new Error("La configuración debe ser un JSON válido")}Q.current.files[0]&&c.append("image",Q.current.files[0]),(J=B.current)!=null&&J.files[0]&&c.append("cover_image",B.current.files[0]),(q=O.current)!=null&&q.files[0]&&c.append("content_layer_image",O.current.files[0]),(Je=z.current)!=null&&Je.files[0]&&c.append("final_layer_image",z.current.files[0]),(qe=L.current)!=null&&qe.files[0]&&c.append("preview_image",L.current.files[0]);const Fa={width:parseInt((Ue=oe.current)==null?void 0:Ue.value)||1e3,height:parseInt((He=ce.current)==null?void 0:He.value)||1e3,dpi:parseInt((We=de.current)==null?void 0:We.value)||300,background_color:((Qe=me.current)==null?void 0:Qe.value)||"#ffffff",format:"JPEG",quality:90};c.append("canvas_config",JSON.stringify(Fa));const Da={x:parseInt((Xe=ue.current)==null?void 0:Xe.value)||0,y:parseInt((Ye=fe.current)==null?void 0:Ye.value)||0,width:parseInt((Ke=pe.current)==null?void 0:Ke.value)||1e3,height:parseInt((Ze=he.current)==null?void 0:Ze.value)||1e3,rotation:parseFloat((ea=ge.current)==null?void 0:ea.value)||0,opacity:parseFloat((aa=xe.current)==null?void 0:aa.value)||1,blend_mode:"normal",fit_mode:((ra=ve.current)==null?void 0:ra.value)||"cover",allow_upload:!0,max_file_size:10,allowed_formats:["jpg","jpeg","png","gif"]};c.append("content_layer_config",JSON.stringify(Da)),X&&((ta=C.current)!=null&&ta.value)?(c.has("id")?c.set("id",C.current.value):c.append("id",C.current.value),await F.updateForItem(n,C.current.value,c)):await F.saveForItem(n,c),Y(!0);const sa=await F.getByItem(n);l(sa.data||[]),De(sa.data||[]),Y(!1),$("#presetModal").modal("hide"),y.fire({title:"¡Éxito!",text:`Preset ${X?"actualizado":"creado"} correctamente`,icon:"success",timer:2e3})}catch(c){y.fire({title:"Error",text:c.message||"Error al guardar el preset",icon:"error"})}finally{Ae(!1)}},Sa=async({id:a,value:r})=>{const t=i||d.current;if(!t||!t.id){y.fire({title:"Error",text:"No hay item seleccionado. Por favor, selecciona un item válido.",icon:"error"});return}try{console.log("Cambiando estado del preset:",a,"del item:",t.id,"a:",r),await F.toggleStatusForItem(t.id,a);const n=await F.getByItem(t.id);l(n.data||[]),De(n.data||[]),y.fire({title:"¡Éxito!",text:`Preset ${r?"activado":"desactivado"} correctamente`,icon:"success",timer:2e3,showConfirmButton:!1})}catch(n){console.error("Error al cambiar estado del preset:",n),y.fire({title:"Error",text:"Error al cambiar el estado del preset: "+n.message,icon:"error"})}},Ea=async a=>{const r=i||d.current;if(!r||!r.id){y.fire({title:"Error",text:"No hay item seleccionado. Por favor, selecciona un item válido.",icon:"error"});return}if((await y.fire({title:"¿Estás seguro?",text:"Esta acción eliminará permanentemente el preset",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{console.log("Eliminando preset:",a,"del item:",r.id),await F.deleteForItem(r.id,a);const n=await F.getByItem(r.id);l(n.data||[]),De(n.data||[]),y.fire({title:"¡Eliminado!",text:"El preset ha sido eliminado correctamente",icon:"success",timer:2e3})}catch(n){console.error("Error al eliminar preset:",n),y.fire({title:"Error",text:"Error al eliminar el preset: "+n.message,icon:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Aa,{gridRef:j,title:"Items",rest:re,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(j.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>Le()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>onModalImportOpen()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(a,{data:r})=>{var t,n,o;a.html($e.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block fst-italic text-muted",children:(t=r.collection)==null?void 0:t.name}),e.jsx("b",{className:"d-block",children:(n=r.category)==null?void 0:n.name}),e.jsx("small",{className:"text-muted",children:(o=r.subcategory)==null?void 0:o.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(a,{data:r})=>{a.html($e.renderToString(e.jsxs(e.Fragment,{children:[e.jsx("b",{children:r.name}),e.jsx("br",{}),e.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(a,{data:r})=>{a.html($e.renderToString(e.jsxs(e.Fragment,{children:[r.discount>0&&e.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",H(r.price)]}),e.jsxs("span",{children:["S/.",H(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(a,{data:r})=>{M(a,e.jsx("img",{src:`/storage/images/item/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:t=>t.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(U,{checked:r.is_new,onChange:t=>ee({id:r.id,field:"is_new",value:t.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(U,{checked:r.offering,onChange:t=>ee({id:r.id,field:"offering",value:t.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(U,{checked:r.recommended,onChange:t=>ee({id:r.id,field:"recommended",value:t.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(U,{checked:r.featured,onChange:t=>ee({id:r.id,field:"featured",value:t.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(a,{data:r})=>{M(a,e.jsx(U,{checked:r.visible,onChange:t=>Pa({id:r.id,value:t.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(a,{data:r})=>{a.css("text-overflow","unset"),a.append(Te({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>Le(r)})),a.append(Te({className:"btn btn-xs btn-soft-info",title:"Gestionar Presets",icon:"fa fa-layer-group",onClick:()=>ja(r)})),a.append(Te({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>onDeleteClicked(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(Ge,{modalRef:I,title:ma?"Editar Item":"Agregar Item",onSubmit:Ca,size:"xl",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-4",id:"principal-container",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Información Básica"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("input",{ref:be,type:"hidden"}),e.jsx(la,{eRef:Ne,label:"Colección",dropdownParent:"#principal-container",onChange:a=>ga(a.target.value),children:v.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(ia,{onChange:a=>pa(a.target.value),eRef:je,label:"Categoría",searchAPI:"/api/admin/categories/paginate",searchBy:"name",filter:["collection_id","=",ha],dropdownParent:"#principal-container"}),e.jsx(ia,{eRef:ye,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",fa],dropdownParent:"#principal-container"}),e.jsx(la,{eRef:we,label:"Marca",required:!0,dropdownParent:"#principal-container",children:m.map((a,r)=>e.jsx("option",{value:a.id,children:a.name},r))}),e.jsx(p,{eRef:Re,label:"Nombre",required:!0}),e.jsx(p,{eRef:Ce,label:"Color",required:!0}),e.jsx(na,{eRef:Pe,label:"Resumen",rows:3,required:!0})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Precios y Stock"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(p,{eRef:_e,label:"Precio",type:"number",step:"0.01",required:!0}),e.jsx(p,{eRef:Ie,label:"Descuento",type:"number",step:"0.01"}),e.jsx(p,{label:"Stock",eRef:Fe,type:"number"})]})]})]})}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Especificaciones"})}),e.jsx("div",{className:"card-body",children:e.jsx(Va,{onChange:Oe,label:"Especificaciones",structure:{type:"",title:"",description:""},typeOptions:["General","Principal"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Imágenes"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:K,label:"Imagen Principal",aspect:1})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:Se,label:"Textura",aspect:1})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Galería de Imágenes"}),e.jsx("input",{id:"input-item-gallery",ref:Be,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Na}),e.jsx("div",{className:"gallery-upload-area",onClick:()=>Be.current.click(),onDrop:ya,onDragOver:wa,children:e.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})}),e.jsx("div",{className:"gallery-preview mt-2",children:Z.map((a,r)=>e.jsxs("div",{className:"gallery-thumbnail",children:[e.jsx("img",{src:`${a.url}`,alt:"preview"}),e.jsx("button",{className:"btn btn-xs btn-danger gallery-remove-btn",onClick:t=>Ra(t,r),children:"×"})]},r))})]})]})]})]})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"card-title mb-0",children:"Descripción Completa"})}),e.jsx("div",{className:"card-body",children:e.jsx(Ba,{eRef:Ee,label:""})})]})]}),e.jsx(Ge,{modalRef:ze,title:"Importar Datos",size:"sm",children:e.jsx(qa,{gridRef:j,modalRef:ze})}),e.jsxs(Ge,{modalRef:P,title:`Gestión de Presets - ${(i==null?void 0:i.name)||""}`,size:"xl",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:["Presets de ",i==null?void 0:i.name]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>{const a=i||d.current;console.log("Nuevo Preset button clicked - currentItem:",a),Ve(null,a)},children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Nuevo Preset"]})]})})}),e.jsx("div",{className:"table-responsive",children:da?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fa fa-spinner fa-spin fa-2x"}),e.jsx("p",{className:"mt-2",children:"Cargando presets..."})]}):e.jsx("div",{ref:w,style:{height:"400px"}})})]}),e.jsx("div",{className:"modal fade",id:"presetModal",tabIndex:"-1","aria-labelledby":"presetModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"presetModalLabel",children:X?"Editar Preset":"Nuevo Preset"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("form",{onSubmit:Ia,children:[e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{ref:C,type:"hidden",name:"id"}),e.jsx("input",{ref:te,type:"hidden",name:"item_id"}),e.jsxs("ul",{className:"nav nav-tabs mb-3",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="basic"?"active":""}`,onClick:()=>V("basic"),href:"#",children:"Información Básica"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="design"?"active":""}`,onClick:()=>V("design"),href:"#",children:"Capas de Diseño"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="canvas"?"active":""}`,onClick:()=>V("canvas"),href:"#",children:"Configuración Canvas"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("a",{className:`nav-link ${R==="content"?"active":""}`,onClick:()=>V("content"),href:"#",children:"Área de Contenido"})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:`tab-pane fade ${R==="basic"?"show active":""}`,style:{display:R==="basic"?"block":"none"},children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(p,{eRef:W,name:"name",label:"Nombre del Preset",placeholder:"Ej: Álbum Premium 30x30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:G,name:"price",label:"Precio",type:"number",step:"0.01",min:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ne,name:"discount",label:"Descuento (%)",type:"number",step:"0.01",min:"0",max:"100"})})]}),e.jsx(na,{eRef:se,name:"description",label:"Descripción",placeholder:"Descripción del preset...",rows:3}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:Q,name:"image",label:"Imagen Principal del Preset"})}),e.jsx("div",{className:"col-md-6",children:e.jsx(k,{eRef:L,name:"preview_image",label:"Imagen de Vista Previa"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ie,name:"sort_order",label:"Orden",type:"number",min:"0",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Estado"}),e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{ref:le,className:"form-check-input",type:"checkbox",defaultChecked:!0}),e.jsx("label",{className:"form-check-label",children:"Activo"})]})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Configuración Adicional (JSON)"}),e.jsx("textarea",{ref:A,className:"form-control",rows:"4",placeholder:'{"pages": 50, "size": "30x30", "cover": "hardcover"}'}),e.jsx("small",{className:"form-text text-muted",children:"Configuración técnica en formato JSON (opcional)"})]})]}),e.jsx("div",{className:`tab-pane fade ${R==="design"?"show active":""}`,style:{display:R==="design"?"block":"none"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Portada (Cover)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:B,name:"cover_image",label:"Imagen de Portada"}),e.jsx("small",{className:"text-muted",children:"Esta es la imagen de fondo que aparecerá en el editor"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa de Contenido"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:O,name:"content_layer_image",label:"Imagen de Contenido"}),e.jsx("small",{className:"text-muted",children:"Capa intermedia donde el usuario subirá su imagen"})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Capa Final (Tapa)"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(k,{eRef:z,name:"final_layer_image",label:"Imagen de Tapa Final"}),e.jsx("small",{className:"text-muted",children:"Esta es la capa superior que se superpone al contenido"})]})]})})]})}),e.jsxs("div",{className:`tab-pane fade ${R==="canvas"?"show active":""}`,style:{display:R==="canvas"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Canvas"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:oe,name:"canvas_width",label:"Ancho (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ce,name:"canvas_height",label:"Alto (cm)",type:"number",min:"1",step:"0.1",defaultValue:"30"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:de,name:"canvas_dpi",label:"DPI (puntos por pulgada)",type:"number",min:"72",defaultValue:"300"})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Color de Fondo"}),e.jsx("input",{ref:me,type:"color",className:"form-control form-control-color",defaultValue:"#ffffff"})]})})]}),e.jsx("div",{className:"mb-2",children:e.jsx("small",{className:"form-text text-muted",children:"El tamaño del canvas se ingresa en centímetros. El valor DPI recomendado para impresión es 300."})})]}),e.jsxs("div",{className:`tab-pane fade ${R==="content"?"show active":""}`,style:{display:R==="content"?"block":"none"},children:[e.jsx("h6",{className:"mb-3",children:"Configuración del Área de Contenido del Usuario"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ue,name:"content_x",label:"Posición X",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:fe,name:"content_y",label:"Posición Y",type:"number",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:pe,name:"content_width",label:"Ancho",type:"number",min:"1",defaultValue:"1000"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:he,name:"content_height",label:"Alto",type:"number",min:"1",defaultValue:"1000"})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:ge,name:"content_rotation",label:"Rotación (grados)",type:"number",min:"-360",max:"360",step:"0.1",defaultValue:"0"})}),e.jsx("div",{className:"col-md-3",children:e.jsx(p,{eRef:xe,name:"content_opacity",label:"Opacidad",type:"number",min:"0",max:"1",step:"0.1",defaultValue:"1"})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Modo de Ajuste"}),e.jsxs("select",{ref:ve,className:"form-control",children:[e.jsx("option",{value:"cover",children:"Cover (cubrir área)"}),e.jsx("option",{value:"contain",children:"Contain (ajustar manteniendo aspecto)"}),e.jsx("option",{value:"fill",children:"Fill (estirar para llenar)"}),e.jsx("option",{value:"none",children:"None (tamaño original)"})]})]})})]})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:Me,children:Me?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa fa-spinner fa-spin me-2"}),"Guardando..."]}):`${X?"Actualizar":"Crear"} Preset`})]})]})]})})}),e.jsx("style",{jsx:!0,children:`
                .gallery-upload-area {
                    border: 2px dashed #ccc;
                    padding: 0px;
                    text-align: center;
                    cursor: pointer;
                    border-radius: 4px;
                    box-shadow: 2.5px 2.5px 5px rgba(0, 0, 0, 0.125);

                    height: 100px;
                    width: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #f8f9fa;
                    transition: all 0.3s ease;
                }

                .gallery-upload-area:hover {
                    border-color: #0d6efd;
                    background-color: #e9f0ff;
                }

                .gallery-preview {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                }

                .gallery-thumbnail {
                    position: relative;
                    width: 80px;
                    height: 80px;
                    border-radius: 4px;
                    overflow: hidden;
                }

                .gallery-thumbnail img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .gallery-remove-btn {
                    position: absolute;
                    top: 0;
                    right: 0;
                    padding: 0;
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                }
            `})]})};Oa((N,m)=>{Ta.createRoot(N).render(e.jsx(Ga,{...m,title:"Items",children:e.jsx(Ua,{...m})}))});
