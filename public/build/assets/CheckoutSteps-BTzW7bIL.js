import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as u}from"./index-BOnQTV8N.js";import{N as j}from"./Number2Currency-e57Tgsuk.js";import{m as k}from"./main-Bp3JhiuO.js";import{G as Q}from"./Global-BM4Id4Pw.js";import{B as re,a as ge,D as Te}from"./DeliveryPricesRest-CepPhj8K.js";import{C as _e}from"./CardItem-CdbVCrTF.js";import{u as te,S as se}from"./SelectForm-CoB1IHa7.js";import{I as B}from"./InputForm-BW2Lnisr.js";import{X as qe}from"./x-fof_H3Vv.js";import{C as he}from"./circle-check-big-CYWUGR3Z.js";import{C as $e}from"./chevron-left-JcR9Fe4w.js";import{C as be}from"./clock-BLXQcN-l.js";import{C as fe}from"./chevron-right-Cug7tVUE.js";import{c as X}from"./createLucideIcon-DfjclApS.js";import{B as ne}from"./building-2-DSFvhCB-.js";import{S as ye}from"./smartphone-BHF2PZKl.js";import{C as ae}from"./copy-BnGV3h9k.js";import{U as de}from"./upload-GO9GDST_.js";import{C as ze}from"./check-D5vaIe6v.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./book-C1IPlXSj.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=X("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=X("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=X("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=X("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function Ie({cart:o,setCart:l,onContinue:r,subTotal:i,envio:x,igv:c,totalFinal:g}){console.log("🛒 CartStep: Cart received:",o);const f=h=>{typeof h=="function"?l(n=>{const N=h(n);return k.Local.set(`${Q.APP_CORRELATIVE}_cart`,N),console.log("🛒 CartStep: Carrito actualizado en localStorage:",N.length,"items"),N}):(l(h),k.Local.set(`${Q.APP_CORRELATIVE}_cart`,h),console.log("🛒 CartStep: Carrito actualizado en localStorage:",h.length,"items"))},d=o.reduce((h,n)=>{const N=n.price||0,C=n.final_price||n.price||0,t=n.quantity||1;return N>C?h+(N-C)*t:h},0);return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"space-y-6",children:o.map((h,n)=>e.jsx(_e,{...h,setCart:f},n))})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsxs("div",{className:"space-y-4",children:[d>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",j(d)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(i)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(c)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(x)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(g)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(re,{onClick:r,children:"  Continuar"}),e.jsx(ge,{href:"/",children:" Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los ",e.jsx("a",{className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra ",e.jsx("a",{className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]})]})}function Le(){let o="";for(let l=0;l<12;l++){const r=Math.floor(Math.random()*10);o+=r}return o}const Re=o=>new Promise((l,r)=>{try{console.log(o);const i=Le(o.email);console.log(i),window.Culqi.publicKey="pk_test_f4d42a7b5073e8df",window.Culqi.settings({title:"Sala Fabulosa",email:o.email,currency:"PEN",amount:o.amount*100,order:`${i}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:"/assets/resources/logo.png",bannerColor:"#311609",buttonBackground:"#311609"}}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){r("No se obtuvo un token de Culqi");return}const x=window.Culqi.token.id;console.log("✅ Token generado:",x),o={...o,token:x,orderNumber:i},console.log("_request actualizado",o);const{status:c,result:g}=await k.Fetch("./api/pago",{method:"POST",body:JSON.stringify(o)});c||console.log((g==null?void 0:g.message)||"Error en el pago"),window.Culqi.close(),k.Notify.add({icon:"/assets/img/icon.svg",title:"Pago Exitoso",body:"El pago se procesó correctamente.",type:"success"}),l(g)}catch(x){k.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:x.message,type:"danger"}),r(x.message||"Error en el pago")}},document.addEventListener("culqi.error",function(x){var c,g;k.Notify.add({icon:"/assets/img/icon.svg",title:"Error en Culqi",body:((c=x.detail)==null?void 0:c.message)||"Error desconocido",type:"danger"}),r(((g=x.detail)==null?void 0:g.message)||"Error desconocido")})}catch(i){k.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),r("Error en la integración con Culqi")}}),Be=async o=>{var l;try{const r=await fetch("/api/mercadopago/preference",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content")},body:JSON.stringify(o)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();return i.status&&i.redirect_url&&(window.Notify&&window.Notify.add({icon:"/assets/img/icon.svg",title:"Redirigiendo a MercadoPago",body:"Te estamos redirigiendo al checkout seguro de MercadoPago...",type:"info"}),setTimeout(()=>{window.location.href=i.redirect_url},1500)),i}catch(r){throw console.error("Error processing MercadoPago payment:",r),r}},Oe=async o=>{var l;try{const r=await fetch("/api/payments/manual",{method:"POST",headers:{"X-CSRF-TOKEN":(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content")},body:o});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error processing manual payment:",r),r}},ue=({title:o,description:l,selected:r,onSelect:i,disabled:x})=>e.jsxs("div",{className:`flex w-full items-center gap-3 p-4 border rounded-xl cursor-pointer transition-all duration-300 customtext-neutral-dark 
                }`,onClick:i,children:[e.jsx("div",{className:`w-5 h-5 border-2 rounded-full flex items-center justify-center ${r?"border-primary":""}`,children:r&&e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"})}),e.jsxs("div",{className:"customtext-neutral-light",children:[e.jsx("h4",{className:"text-sm ",children:o}),e.jsx("p",{className:"text-xs",children:l})]})]});function He({isOpen:o,onClose:l,paymentMethod:r,amount:i,onPaymentSuccess:x,onFileUpload:c,paymentProof:g,checkoutData:f}){const[d,h]=u.useState(1),[n,N]=u.useState([]),[C,t]=u.useState(!1);if(!o||!r)return null;const E=p=>{switch(p){case"gateway":return e.jsx(V,{size:24,className:"text-blue-600"});case"qr":return e.jsx(ye,{size:24,className:"text-purple-600"});case"manual":return e.jsx(ne,{size:24,className:"text-green-600"});default:return e.jsx(V,{size:24,className:"text-gray-600"})}},_=(p=>{switch(p){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}})(r.type),m=r.configuration||{},M=r.instructions||{},$=p=>{if(!p)return"";const b={phone_number:m.phone_number||m.phone||"",amount:`S/ ${j(i)}`,bank_name:m.bank_name||"",account_number:m.account_number||"",account_type:m.account_type||"",cci:m.cci||"",account_holder:m.account_holder||"",document_number:m.document_number||"",account_name:m.account_name||"",order_id:Math.random().toString(36).substr(2,9).toUpperCase(),current_date:new Date().toLocaleDateString("es-PE"),current_time:new Date().toLocaleTimeString("es-PE",{hour:"2-digit",minute:"2-digit"})};let w=p;return Object.keys(b).forEach(I=>{const z=new RegExp(`\\{${I}\\}`,"g");w=w.replace(z,b[I])}),w},S=r.type==="gateway"?[{id:1,title:"Procesar Pago",description:"Serás redirigido al gateway de pago seguro",component:e.jsx(Ve,{paymentMethod:r,amount:i}),action:r.slug==="mercadopago"?"Pagar con MercadoPago":"Procesar Pago",canProceed:!0}]:r.type==="qr"?[{id:1,title:"Datos de Transferencia",description:`Información para enviar dinero por ${r.name}`,component:e.jsx(Ge,{paymentMethod:r,amount:i,config:m,instructions:M,replaceVariables:$,colorClass:_}),action:"Ya Envié el Dinero",canProceed:!0},{id:2,title:"Subir Comprobante",description:"Sube tu comprobante de pago para validación",component:e.jsx(pe,{onFileUpload:c,paymentProof:g}),action:"Enviar Comprobante",canProceed:!!g},{id:3,title:"Validación",description:"Tu comprobante está siendo validado",component:e.jsx(xe,{paymentMethod:r}),action:"Finalizar",canProceed:!0}]:[{id:1,title:"Datos Bancarios",description:"Información para realizar la transferencia",component:e.jsx(Ue,{paymentMethod:r,amount:i,config:m,instructions:M,replaceVariables:$,colorClass:_}),action:"Ya Transferí",canProceed:!0},{id:2,title:"Subir Comprobante",description:"Sube tu comprobante de transferencia",component:e.jsx(pe,{onFileUpload:c,paymentProof:g}),action:"Enviar Comprobante",canProceed:!!g},{id:3,title:"Validación",description:"Tu transferencia está siendo validada",component:e.jsx(xe,{paymentMethod:r}),action:"Finalizar",canProceed:!0}],v=S.find(p=>p.id===d),W=async()=>{if(d===S.length){t(!0);try{r.slug==="mercadopago"?await J():await x(),l()}catch(p){console.error("Error processing payment:",p)}finally{t(!1)}}else if(r.slug==="mercadopago"&&d===1){t(!0);try{await J()}catch(p){console.error("Error processing MercadoPago payment:",p)}finally{t(!1)}}else N([...n,d]),h(d+1)},J=async()=>{var p;try{t(!0),console.log("🚀 Iniciando proceso de pago con MercadoPago"),console.log("📋 Obteniendo configuración de MercadoPago...");const b=await fetch("/api/mercadopago/config");if(!b.ok)throw new Error(`Error HTTP: ${b.status}`);const w=await b.json();if(console.log("✅ Respuesta de configuración:",w),!w.status)throw new Error(w.message||"Error al obtener configuración de MercadoPago");console.log(`🔑 Public Key obtenida: ${w.public_key.substring(0,20)}...`),console.log("📦 Cargando SDK de MercadoPago..."),await Y(),console.log("✅ SDK de MercadoPago cargado");const I=K();console.log("📊 Datos del checkout:",I),console.log("🏗️ Creando preferencia de pago...");const z=await fetch("/api/mercadopago/preference",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(p=document.querySelector('meta[name="csrf-token"]'))==null?void 0:p.getAttribute("content")},body:JSON.stringify(I)});if(console.log(`📡 Respuesta HTTP: ${z.status}`),!z.ok){const G=await z.text();throw console.error("❌ Error en respuesta:",G),new Error(`Error HTTP ${z.status}: ${G}`)}const H=await z.json();if(console.log("✅ Preferencia creada:",H),!H.status)throw new Error(H.message||"Error al crear preferencia de pago");const L=document.querySelector(".mercadopago-button");L&&(L.style.display="flex",L.innerHTML='<p class="text-blue-600">🔄 Inicializando MercadoPago...</p>',console.log("👁️ Contenedor de MercadoPago mostrado")),console.log("🚀 Inicializando MercadoPago con public key...");const q=new window.MercadoPago(w.public_key,{locale:"es-PE"});console.log("✅ MercadoPago inicializado"),console.log("🎯 Creando Wallet Brick...");const Z=q.bricks();L&&(L.innerHTML="");const A=await Z.create("wallet",".mercadopago-button",{initialization:{preferenceId:H.preference_id},customization:{texts:{valueProp:"smart_option"}}});console.log("🎉 Checkout de MercadoPago creado exitosamente")}catch(b){console.error("💥 Error en MercadoPago:",b);const w=document.querySelector(".mercadopago-button");throw w&&(w.innerHTML=`
                    <div class="text-red-600 p-4 text-center">
                        <p class="font-medium">❌ Error al cargar MercadoPago</p>
                        <p class="text-sm mt-1">${b.message}</p>
                        <button class="mt-2 bg-red-600 text-white px-4 py-2 rounded text-sm" onclick="location.reload()">
                            Reintentar
                        </button>
                    </div>
                `,w.style.display="flex"),window.Notify?window.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el pago",body:b.message,type:"error"}):alert("Error al procesar el pago: "+b.message),b}finally{t(!1)}},Y=()=>new Promise((p,b)=>{if(window.MercadoPago){p();return}const w=document.createElement("script");w.src="https://sdk.mercadopago.com/js/v2",w.onload=()=>{p()},w.onerror=()=>{b(new Error("Error al cargar el SDK de MercadoPago"))},document.head.appendChild(w)}),K=()=>{if(f)return{...f,amount:i};const p=JSON.parse(localStorage.getItem("bananalab_cart")||"[]");return{...JSON.parse(localStorage.getItem("bananalab_checkout_data")||"{}"),cart:p,amount:i}},D=()=>{d>1&&(h(d-1),N(n.filter(p=>p!==d-1)))};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:["                ",e.jsxs("div",{className:`bg-gradient-to-r text-white p-6 ${_==="blue"?"from-blue-600 to-blue-700":_==="purple"?"from-purple-600 to-purple-700":_==="green"?"from-green-600 to-green-700":"from-gray-600 to-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[E(r.type),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:r.name}),e.jsxs("p",{className:"text-sm opacity-90",children:["Monto: S/ ",j(i)]})]})]}),e.jsx("button",{onClick:l,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors",children:e.jsx(qe,{size:24})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:S.map((p,b)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-colors ${n.includes(p.id)?"bg-green-500 text-white":d===p.id?"bg-white text-gray-800":"bg-white bg-opacity-30 text-white"}`,children:n.includes(p.id)?e.jsx(he,{size:16}):p.id}),b<S.length-1&&e.jsx("div",{className:`w-12 h-1 mx-2 rounded ${n.includes(p.id)?"bg-green-500":"bg-white bg-opacity-30"}`})]},p.id))}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:v==null?void 0:v.title}),e.jsx("p",{className:"text-xs opacity-75",children:v==null?void 0:v.description})]})]})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-96",children:v==null?void 0:v.component}),e.jsxs("div",{className:"border-t p-4 bg-gray-50 flex items-center justify-between",children:[e.jsxs("button",{onClick:D,disabled:d===1,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${d===1?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:bg-gray-200"}`,children:[e.jsx($e,{size:16}),"Anterior"]}),e.jsx("button",{onClick:W,disabled:!(v!=null&&v.canProceed)||C,className:`flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-colors ${!(v!=null&&v.canProceed)||C?"bg-gray-300 text-gray-500 cursor-not-allowed":_==="blue"?"bg-blue-600 text-white hover:bg-blue-700":_==="purple"?"bg-purple-600 text-white hover:bg-purple-700":_==="green"?"bg-green-600 text-white hover:bg-green-700":"bg-gray-600 text-white hover:bg-gray-700"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx(be,{size:16,className:"animate-spin"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[v==null?void 0:v.action,d<S.length&&e.jsx(fe,{size:16})]})})]})]})})}function Ve({paymentMethod:o,amount:l}){const i=o.slug==="mercadopago"?{icon:"💙",title:"MercadoPago",description:"Te redirigiremos al checkout seguro de MercadoPago",features:["• 💳 Acepta tarjetas de crédito y débito","• 🏦 Transferencias bancarias","• 💰 Cuotas sin interés disponibles","• 🔒 Transacciones 100% seguras","• ⚡ Aprobación instantánea"]}:o.slug==="culqi"?{icon:"🟢",title:"Culqi",description:"Te redirigiremos al checkout seguro de Culqi",features:["• ✅ Transacción protegida con cifrado SSL","• 💳 Acepta tarjetas Visa, Mastercard y más","• ⚡ Confirmación inmediata del pago","• 🔒 Datos protegidos según estándares PCI DSS"]}:{icon:"💳",title:o.name,description:`Te redirigiremos al checkout seguro de ${o.name}`,features:["• 🔒 Transacción 100% segura","• ⚡ Procesamiento inmediato","• 💳 Múltiples métodos de pago"]};return e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx("span",{className:"text-3xl",children:i.icon})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Pago Seguro con ",i.title]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:[i.description," para completar tu pago de S/ ",j(l)]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"🛡️ Procesamiento Seguro"}),e.jsx("ul",{className:"text-sm text-blue-800 space-y-1 text-left",children:i.features.map((x,c)=>e.jsx("li",{children:x},c))})]}),"            ",o.slug==="mercadopago"&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"💡 Con MercadoPago puedes pagar con:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-blue-800 mb-4",children:[e.jsx("div",{children:"• Visa, Mastercard"}),e.jsx("div",{children:"• American Express"}),e.jsx("div",{children:"• Transferencias"}),e.jsx("div",{children:"• Cuotas sin interés"})]}),e.jsx("div",{className:"mercadopago-button bg-white rounded-lg p-4 border-2 border-dashed border-blue-300 text-center min-h-[100px] flex items-center justify-center",style:{display:"none"},children:e.jsx("p",{className:"text-blue-600",children:"🔄 Cargando formulario de pago seguro..."})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"📝 ¿Qué sucede después?"}),o.slug==="mercadopago"?e.jsxs("ol",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:'1. Al hacer clic en "Pagar con MercadoPago" se cargará el formulario de pago'}),e.jsx("li",{children:"2. Completa tus datos de pago de forma segura"}),e.jsx("li",{children:"3. El pago se procesará instantáneamente"}),e.jsx("li",{children:"4. Recibirás la confirmación en pantalla y por email"})]}):e.jsxs("ol",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:'1. Al hacer clic en "Procesar Pago" serás redirigido al gateway de pago seguro'}),e.jsx("li",{children:"2. Completa tu pago de forma segura"}),e.jsx("li",{children:"3. Serás redirigido de vuelta a nuestra tienda"}),e.jsx("li",{children:"4. Recibirás la confirmación por email"})]})]})]})}function Ge({paymentMethod:o,amount:l,config:r,instructions:i,replaceVariables:x,colorClass:c}){const g=(N,C)=>{navigator.clipboard.writeText(N);const t=document.getElementById(C),E=t.innerHTML;t.innerHTML="✅ Copiado",setTimeout(()=>t.innerHTML=E,2e3)},f=()=>c==="purple"?"from-purple-100 to-purple-50 border-purple-200":c==="blue"?"from-blue-100 to-blue-50 border-blue-200":c==="green"?"from-green-100 to-green-50 border-green-200":"from-gray-100 to-gray-50 border-gray-200",d=()=>c==="purple"?"text-purple-700":c==="blue"?"text-blue-700":c==="green"?"text-green-700":"text-gray-700",h=()=>c==="purple"?"bg-purple-600 hover:bg-purple-700":c==="blue"?"bg-blue-600 hover:bg-blue-700":c==="green"?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700",n=()=>c==="purple"?"bg-purple-200 text-purple-800":c==="blue"?"bg-blue-200 text-blue-800":c==="green"?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800";return e.jsxs("div",{className:"space-y-4",children:[r.phone_number&&e.jsx("div",{className:`bg-gradient-to-r rounded-lg p-4 border-2 ${f()}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:`text-sm font-medium mb-1 ${d()}`,children:["📱 Número para ",o.name]}),e.jsx("p",{className:`text-3xl font-bold mb-2 ${d().replace("700","900")}`,children:r.phone_number}),r.account_name&&e.jsxs("p",{className:`text-sm mb-3 ${d().replace("700","600")}`,children:["A nombre de: ",e.jsx("span",{className:"font-medium",children:r.account_name})]}),e.jsxs("button",{id:"copy-phone",onClick:()=>g(r.phone_number,"copy-phone"),className:`${h()} text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 mx-auto`,children:[e.jsx(ae,{size:16}),"Copiar Número"]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-yellow-800 font-medium text-lg mb-2",children:"💰 Monto exacto a enviar"}),e.jsxs("p",{className:"text-4xl font-bold text-yellow-900",children:["S/ ",j(l)]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"⚠️ Debe ser exacto para procesar automáticamente"})]})}),r.qr_code&&e.jsxs("div",{className:"text-center bg-white rounded-lg p-4 border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-gray-100 px-3 py-1 rounded-full text-sm text-gray-600 mb-3",children:[e.jsx(Fe,{size:16}),"Código QR"]})}),e.jsx("img",{src:`/storage/images/payment_method/${r.qr_code}`,alt:"Código QR",className:"mx-auto max-w-48 h-auto rounded-lg border shadow-lg"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-3",children:["📱 Escanea con tu app de ",o.name]})]}),i.steps&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:"📋 Pasos a seguir:"}),e.jsx("ol",{className:"space-y-2",children:i.steps.slice(0,4).map((N,C)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 ${n()}`,children:C+1}),e.jsx("span",{className:"text-sm text-gray-700",dangerouslySetInnerHTML:{__html:x(N)}})]},C))})]})]})}function Ue({paymentMethod:o,amount:l,config:r,instructions:i,replaceVariables:x,colorClass:c}){const g=(h,n)=>{navigator.clipboard.writeText(h);const N=document.getElementById(n),C=N.innerHTML;N.innerHTML="✅ Copiado",setTimeout(()=>N.innerHTML=C,2e3)},f=()=>c==="green"?"from-green-100 to-green-50 border-green-200":c==="blue"?"from-blue-100 to-blue-50 border-blue-200":c==="purple"?"from-purple-100 to-purple-50 border-purple-200":"from-gray-100 to-gray-50 border-gray-200",d=()=>c==="green"?"text-green-800":c==="blue"?"text-blue-800":c==="purple"?"text-purple-800":"text-gray-800";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`bg-gradient-to-r rounded-lg p-4 border-2 ${f()}`,children:[e.jsxs("h4",{className:`font-semibold mb-3 flex items-center gap-2 ${d()}`,children:[e.jsx(ne,{size:20}),"Datos para Transferencia"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[r.bank_name&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Banco:"}),e.jsx("span",{className:"font-bold text-gray-900",children:r.bank_name})]})}),r.account_number&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"N° Cuenta:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-gray-900 font-mono",children:r.account_number}),e.jsx("button",{id:"copy-account",onClick:()=>g(r.account_number,"copy-account"),className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(ae,{size:14})})]})]})}),r.cci&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"CCI:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-gray-900 font-mono",children:r.cci}),e.jsx("button",{id:"copy-cci",onClick:()=>g(r.cci,"copy-cci"),className:"text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(ae,{size:14})})]})]})}),r.account_holder&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Titular:"}),e.jsx("span",{className:"font-bold text-gray-900",children:r.account_holder})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-blue-800 font-medium text-lg mb-2",children:"💸 Monto a transferir"}),e.jsxs("p",{className:"text-4xl font-bold text-blue-900",children:["S/ ",j(l)]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Incluye todos los cargos"})]})})]})}function pe({onFileUpload:o,paymentProof:l}){const r=i=>{i.target.files[0]&&o(i)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(de,{size:32,className:"text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Sube tu Comprobante"}),e.jsx("p",{className:"text-gray-600",children:"Sube una imagen clara de tu comprobante de pago para validar la transacción"})]}),e.jsx("div",{className:`border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 ${l?"border-green-300 bg-green-50":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"}`,children:l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(he,{className:"text-green-600",size:24}),e.jsxs("span",{className:"text-green-800 font-medium",children:["Archivo cargado: ",l.name]})]}),e.jsxs("p",{className:"text-xs text-green-600",children:[(l.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{children:[e.jsx(de,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[e.jsx("span",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium inline-block",children:"Seleccionar Archivo"}),e.jsx("input",{id:"payment-proof-modal",type:"file",className:"hidden",accept:"image/*,.pdf",onChange:r})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG o PDF hasta 5MB"})]})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-medium text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(Ae,{size:16}),"Asegúrate que tu comprobante incluya:"]}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• ✅ Monto transferido claramente visible"}),e.jsx("li",{children:"• ✅ Fecha y hora de la transacción"}),e.jsx("li",{children:"• ✅ Número de operación (si está disponible)"}),e.jsx("li",{children:"• ✅ Datos del destinatario"})]})]})]})}function xe({paymentMethod:o}){return e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(be,{size:40,className:"text-yellow-600 animate-spin"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Validando tu Pago"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Tu comprobante está siendo revisado por nuestro equipo. Este proceso puede tomar algunos minutos."})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"⏱️ Tiempo de Validación"}),e.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[e.jsxs("li",{children:["• 🔄 ",o.name,": 5-15 minutos"]}),e.jsx("li",{children:"• 📧 Recibirás confirmación por email"}),e.jsx("li",{children:"• 📱 También te notificaremos por WhatsApp"}),e.jsx("li",{children:"• 🎯 Tu pedido se procesará automáticamente"})]})]})]})}function Je({cart:o,setSale:l,setCode:r,setDelivery:i,setCart:x,onContinue:c,noContinue:g,subTotal:f,igv:d,totalFinal:h,user:n,setEnvio:N,envio:C}){const[t,E]=u.useState({name:(n==null?void 0:n.name)||"",lastname:(n==null?void 0:n.lastname)||"",email:(n==null?void 0:n.email)||"",department:(n==null?void 0:n.department)||"",province:(n==null?void 0:n.province)||"",district:(n==null?void 0:n.district)||"",address:(n==null?void 0:n.address)||"",number:(n==null?void 0:n.number)||"",comment:(n==null?void 0:n.comment)||"",reference:(n==null?void 0:n.reference)||"",shippingOption:"delivery",paymentMethod:"culqi"}),[O,_]=u.useState(null),[m,M]=u.useState(null),[$,U]=u.useState(0),[S,v]=u.useState([]),[W,J]=u.useState(!0),[Y,K]=u.useState(!1),[D,p]=u.useState(null),b=s=>{const{name:a,value:y}=s.target;E(P=>({...P,[a]:y}))},w=s=>{E(y=>({...y,paymentMethod:s}));const a=S.find(y=>y.slug===s);a&&!a.requires_proof&&(_(null),M(null))},I=()=>({user_id:(n==null?void 0:n.id)||"",name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",fullname:`${t==null?void 0:t.name} ${t==null?void 0:t.lastname}`,email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",country:"Perú",department:q||"",province:A||"",district:R||"",ubigeo:null,address:(t==null?void 0:t.address)||"",number:(t==null?void 0:t.number)||"",comment:(t==null?void 0:t.comment)||"",reference:(t==null?void 0:t.reference)||"",amount:h||0,delivery:C,cart:o,payment_method:t.paymentMethod,invoiceType:t.invoiceType,documentType:t.documentType,document:t.document,businessName:t.businessName}),z=()=>{const s=S.find(a=>a.slug===t.paymentMethod);s&&(p(s),K(!0))},H=async()=>{const s={user_id:(n==null?void 0:n.id)||"",name:(t==null?void 0:t.name)||"",lastname:(t==null?void 0:t.lastname)||"",fullname:`${t==null?void 0:t.name} ${t==null?void 0:t.lastname}`,email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",country:"Perú",department:q||"",province:A||"",district:R||"",ubigeo:null,address:(t==null?void 0:t.address)||"",number:(t==null?void 0:t.number)||"",comment:(t==null?void 0:t.comment)||"",reference:(t==null?void 0:t.reference)||"",amount:h||0,delivery:C,cart:o,payment_method:t.paymentMethod,invoiceType:t.invoiceType,documentType:t.documentType,document:t.document,businessName:t.businessName};try{let a;const y=S.find(T=>T.slug===t.paymentMethod);if(!y)throw new Error("Método de pago no válido");switch(y.type){case"gateway":if(y.slug==="culqi"){if(!window.Culqi){console.error("❌ Culqi aún no se ha cargado.");return}a=await Re(s)}else if(y.slug==="mercadopago")a=await Be(s);else throw new Error("Gateway no implementado");break;case"qr":case"manual":const T=new FormData;Object.keys(s).forEach(F=>{Array.isArray(s[F])?T.append(F,JSON.stringify(s[F])):T.append(F,s[F])}),O&&T.append("payment_proof",O),a=await Oe(T);break;default:throw new Error("Tipo de método de pago no válido")}const P=a;P.status?(l(P.sale),i(P.delivery),r(P.code),x([]),k.Notify.add({icon:"/assets/img/icon.svg",title:"¡Pedido procesado!",body:y.type==="gateway"?"Su pago ha sido procesado exitosamente":"Su pedido está pendiente de validación del comprobante",type:"success"}),c()):k.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:P.message||"El pago ha sido rechazado",type:"danger"})}catch(a){throw console.log(a),k.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:"No se pudo procesar el pago",type:"danger"}),a}},L=s=>{const a=s.target.files[0];if(a){if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(a.type)){k.Notify.add({icon:"/assets/img/icon.svg",title:"Archivo no válido",body:"Solo se permiten imágenes (JPG, PNG) o archivos PDF",type:"danger"});return}if(a.size>5*1024*1024){k.Notify.add({icon:"/assets/img/icon.svg",title:"Archivo muy grande",body:"El archivo no debe superar los 5MB",type:"danger"});return}if(_(a),a.type.startsWith("image/")){const P=new FileReader;P.onload=T=>M(T.target.result),P.readAsDataURL(a)}else M(null)}},[q,Z]=u.useState(""),[A,G]=u.useState(""),[R,ee]=u.useState(""),[je,Ne]=u.useState([]),[ve,we]=u.useState([]),[Ce,oe]=u.useState([]),[Qe,Xe]=u.useState(0);u.useEffect(()=>{Pe()},[]);const Pe=async()=>{try{const a=await(await fetch("/api/payments/methods")).json();a.status&&a.methods?(v(a.methods),a.methods.length>0&&E(y=>({...y,paymentMethod:a.methods[0].slug}))):console.error("Error en respuesta de métodos de pago:",a)}catch(s){console.error("Error fetching payment methods:",s),k.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:"No se pudieron cargar los métodos de pago",type:"danger"})}finally{J(!1)}};u.useEffect(()=>{const s=[...new Set(te.map(a=>a.departamento))];Ne(s)},[]),u.useEffect(()=>{if(q){const s=[...new Set(te.filter(a=>a.departamento===q).map(a=>a.provincia))];we(s),G(""),ee(""),oe([]),E(a=>({...a,department:q,province:"",district:""}))}},[q]),u.useEffect(()=>{if(A){const s=te.filter(a=>a.departamento===q&&a.provincia===A).map(a=>a.distrito);oe(s),ee(""),E(a=>({...a,province:A,district:""}))}},[A]),u.useEffect(()=>{R&&(E(a=>({...a,district:R})),(async()=>{try{const a=await Te.getShippingCost({department:q,district:R});N(a.data.price),j(a.data.price)>0?le("express"):le("free")}catch(a){console.error("Error fetching shipping cost:",a),alert("No se pudo obtener el costo de envío.")}})())},[R]);const Se=async s=>{if(s.preventDefault(),!n){k.Notify.add({icon:"/assets/img/icon.svg",title:"Iniciar Sesión",body:"Se requiere que inicie sesión para realizar la compra",type:"danger"});return}if(!t.department||!t.province||!t.district||!t.name||!t.lastname||!t.email||!t.address||!t.reference){k.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Formulario",body:"Completar los datos de envío",type:"danger"});return}z()},[ie,le]=u.useState("free"),ce=(s,a)=>{switch(s){case"gateway":return e.jsx(V,{size:20});case"qr":return e.jsx(ye,{size:20});case"manual":return e.jsx(ne,{size:20});default:return e.jsx(V,{size:20})}},ke=s=>{switch(s){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("form",{className:"space-y-6",onSubmit:s=>s.preventDefault(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(B,{type:"text",label:"Nombres",name:"name",value:t.name,onChange:b,placeholder:"Nombres"}),e.jsx(B,{label:"Apellidos",type:"text",name:"lastname",value:t.lastname,onChange:b,placeholder:"Apellidos"})]}),e.jsx(B,{label:"Correo electrónico",type:"email",name:"email",value:t.email,onChange:b,placeholder:"Ej. hola@gmail.com"}),e.jsx(se,{label:"Departamento",options:je,placeholder:"Selecciona un Departamento",onChange:s=>{Z(s),E(a=>({...a,department:q}))}}),e.jsx(se,{disabled:!q,label:"Provincia",options:ve,placeholder:"Selecciona una Provincia",onChange:s=>{G(s),E(a=>({...a,province:A}))}}),e.jsx(se,{disabled:!A,label:"Distrito",options:Ce,placeholder:"Selecciona un Distrito",onChange:s=>{ee(s),E(a=>({...a,district:R}))}}),e.jsx(B,{label:"Avenida / Calle / Jirón",type:"text",name:"address",value:t.address,onChange:b,placeholder:"Ingresa el nombre de la calle"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(B,{label:"Número",type:"text",name:"number",value:t.number,onChange:b,placeholder:"Ingresa el número de la calle"}),e.jsx(B,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque (opcional)",type:"text",name:"comment",value:t.comment,onChange:b,placeholder:"Ej. Casa 3, Dpto 101"})]}),e.jsx(B,{label:"Referencia",type:"text",name:"reference",value:t.reference,onChange:b,placeholder:"Ejem. Altura de la avenida..."}),"                    ",e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(V,{size:20,className:"text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Método de Pago"})]}),W?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Cargando métodos de pago..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-xl",children:[e.jsx(V,{size:48,className:"mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No hay métodos de pago disponibles"})]}):e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsxs("div",{className:`group relative border-2 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:shadow-lg ${t.paymentMethod===s.slug?"border-primary bg-primary/5 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>w(s.slug),children:[t.paymentMethod===s.slug&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(ze,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-200 ${t.paymentMethod===s.slug?"bg-primary text-white shadow-lg":"bg-gray-100 group-hover:bg-gray-200"}`,children:s.icon?e.jsx("img",{src:s.icon,alt:s.name,className:"w-8 h-8 object-contain"}):ce(s.type,s.slug)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s.type==="gateway"?"bg-blue-100 text-blue-800":s.type==="qr"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:s.type==="gateway"?"Online":s.type==="qr"?"QR":"Manual"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 text-xs mt-1",children:s.fee_percentage>0||s.fee_fixed>0?e.jsxs("span",{className:"text-orange-600 font-medium",children:[s.fee_percentage>0&&`+${s.fee_percentage}%`,s.fee_percentage>0&&s.fee_fixed>0&&" ",s.fee_fixed>0&&`+S/ ${j(s.fee_fixed)}`]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Sin comisión"})})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 transition-all duration-200 ${t.paymentMethod===s.slug?"border-primary bg-primary":"border-gray-300 group-hover:border-gray-400"}`,children:t.paymentMethod===s.slug&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]})]},s.slug))}),(()=>{const s=S.find(Me=>Me.slug===t.paymentMethod);if(!s)return null;const a=ke(s.type),y=()=>a==="blue"?"bg-blue-50 border-blue-200":a==="purple"?"bg-purple-50 border-purple-200":a==="green"?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200",P=()=>a==="blue"?"bg-blue-100":a==="purple"?"bg-purple-100":a==="green"?"bg-green-100":"bg-gray-100",T=()=>a==="blue"?"text-blue-800":a==="purple"?"text-purple-800":a==="green"?"text-green-800":"text-gray-800",F=()=>a==="blue"?"text-blue-700":a==="purple"?"text-purple-700":a==="green"?"text-green-700":"text-gray-700",Ee=()=>a==="blue"?"text-blue-600":a==="purple"?"text-purple-600":a==="green"?"text-green-600":"text-gray-600";return e.jsxs("div",{className:`border rounded-xl p-4 ${y()}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${P()}`,children:ce(s.type,s.slug)}),e.jsxs("h4",{className:`font-semibold ${T()}`,children:[s.name," - ",s.type==="gateway"?"Pago Online":"Proceso Paso a Paso"]})]}),e.jsx("p",{className:`text-sm mb-3 ${F()}`,children:s.type==="gateway"?"Te redirigiremos al gateway de pago seguro para procesar tu transacción.":"Te guiaremos paso a paso para completar tu pago de forma fácil y segura."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:16,className:Ee()}),e.jsxs("span",{className:`text-sm font-medium ${T()}`,children:["Monto total: S/ ",j(h)]})]})]})})()]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(ue,{title:"Envío gratis",description:"Entrega entre 3 a 10 días hábiles",selected:ie==="free"}),e.jsx(ue,{title:"Delivery",description:"Delivery 24 horas",selected:ie==="express"})]}),e.jsxs("div",{className:"flex gap-4 mt-6 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(me,{className:"customtext-primary",width:"20px"})}),e.jsxs("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:[e.jsx("p",{children:"Solo Lima Metropolitana: Dentro de las 24 horas después de efectuado el pago, solo algunos distritos de Lima Metropolitana."}),e.jsxs("p",{children:[" ","Distritos No incluidos: Santa María del Mar, Pucusana, San Bartolo, Punta Hermosa, Lurín, Pachacamac, Chorrillos, Villa el Salvador, Villa María del Triunfo, San Juan de Miraflores, Cieneguilla, Ate, Chosica, Huaycan, San Juan de Lurigancho (hasta el Metro), Ancón, Santa Rosa, Carabayllo, Puente Piedra."]}),e.jsxs("p",{children:[" ","Same Day: Solo para compras efectuadas hasta las 1pm del día."]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(me,{className:"customtext-primary",width:"20px"})}),e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:e.jsx("p",{children:"Lima: 3 a 4 dias hábiles | Provincia: de 4 a 10 dias hábiles"})})]})]}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:o.map((s,a)=>{var y,P;return e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl",children:e.jsx("img",{src:s.type==="custom_album"?`/storage/images/item_preset/${s.image}`:`/storage/images/item/${s.image}`,alt:s.name,className:"w-20 h-20 object-cover rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:s.name}),s.type==="custom_album"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Tipo:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:"Álbum Personalizado"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Páginas:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:((y=s.album_data)==null?void 0:y.pages_count)||"N/A"})]})]}):e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:((P=s.brand)==null?void 0:P.name)||"Sin marca"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:s.quantity||1})]})]})]})},s.id)})}),e.jsxs("div",{className:"space-y-4 mt-6",children:[(()=>{const s=o.reduce((a,y)=>{const P=y.price||0,T=y.final_price||y.price||0,F=y.quantity||1;return P>T?a+(P-T)*F:a},0);return s>0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",j(s)]})]}):null})(),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(f)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(d)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(C)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(h)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(re,{onClick:Se,children:(()=>{const s=S.find(a=>a.slug===t.paymentMethod);if(!s)return"Continuar";switch(s.type){case"gateway":return`Pagar con ${s.name}`;case"qr":case"manual":return`Confirmar ${s.name}`;default:return"Continuar"}})()}),e.jsx(ge,{onClick:g,children:"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",e.jsx("a",{className:"customtext-primary font-bold",children:"Términos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",e.jsx("a",{className:"customtext-primary font-bold",children:"Política de Privacidad"}),"."]})})]})]}),e.jsx(He,{isOpen:Y,onClose:()=>K(!1),paymentMethod:D,amount:h,onPaymentSuccess:H,onFileUpload:L,paymentProof:O,checkoutData:I()})]})}function Ke({cart:o,code:l,delivery:r}){const x=(o.reduce((f,d)=>{const h=d.final_price;return f+h*d.quantity},0)/1.18).toFixed(2),c=(x*.18).toFixed(2),g=parseFloat(x)+parseFloat(c)+parseFloat(r);return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h2",{className:"text-[20px] customtext-neutral-light",children:"Gracias por tu compra 🎉"}),e.jsx("p",{className:"customtext-neutral-dark text-5xl font-semibold",children:"Tu orden ha sido recibida"}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:" customtext-neutral-light",children:"Código de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-lg font-semibold",children:`#${l}`})]}),e.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:o.map((f,d)=>e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex   gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl w-max",children:e.jsx("img",{src:`/storage/images/item/${f.image}`,alt:f.name,className:"w-20 h-20 object-cover rounded  "})}),e.jsxs("div",{className:" text-start",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:f.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:f.brand.name})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsxs("span",{className:"customtext-neutral-dark",children:[f.quantity," "]})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:f.sku})]})]})]})},d))}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(x)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(c)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Envío"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",j(r)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",j(g)]})]})})]}),e.jsx("div",{className:"pt-3",children:e.jsx(re,{href:"/catalogo",children:"  Seguir Comprando"})})]})]})})})}function Pt({cart:o,setCart:l,user:r}){const[i,x]=u.useState(1);u.useEffect(()=>{const m=new URLSearchParams(window.location.search),M=m.get("step"),$=m.get("status"),U=m.get("payment_type"),S=m.get("order");console.log("🔍 CheckoutSteps: Parámetros URL detectados:",{step:M,status:$,paymentType:U,orderNumber:S}),M==="3"&&$==="success"&&U==="mercadopago"&&(console.log("✅ CheckoutSteps: Pago exitoso de MercadoPago detectado, navegando al paso 3"),x(3),S&&(E(S),window.Notify&&window.Notify.add({icon:"/assets/img/icon.svg",title:"¡Pago exitoso!",body:"Tu pago con MercadoPago ha sido procesado correctamente.",type:"success"})),window.history.replaceState({},document.title,window.location.pathname))},[]);const g=(o.reduce((m,M)=>{const $=M.final_price;return m+$*M.quantity},0)/1.18).toFixed(2),f=(g*.18).toFixed(2),[d,h]=u.useState(0),n=parseFloat(g)+parseFloat(f)+parseFloat(d),[N,C]=u.useState([]),[t,E]=u.useState([]),[O,_]=u.useState([]);return u.useEffect(()=>{console.log("🔄 CheckoutSteps: Sincronizando carrito con localStorage...");const m=k.Local.get(`${Q.APP_CORRELATIVE}_cart`)||[];console.log("📦 CheckoutSteps: Carrito desde localStorage:",m),m.length>0&&JSON.stringify(m)!==JSON.stringify(o)&&(console.log("✅ CheckoutSteps: Actualizando carrito desde localStorage"),l(m))},[]),u.useEffect(()=>{const m=M=>{console.log("📢 CheckoutSteps: Carrito actualizado:",M.detail);const $=k.Local.get(`${Q.APP_CORRELATIVE}_cart`)||[];console.log("🔄 CheckoutSteps: Cargando carrito actualizado:",$),l($)};return window.addEventListener("cartUpdated",m),()=>{window.removeEventListener("cartUpdated",m)}},[l]),u.useEffect(()=>{const m=document.createElement("script");return m.src="https://checkout.culqi.com/js/v4",m.async=!0,m.onload=()=>{console.log("✅ Culqi cargado correctamente."),window.culqi=function(){window.Culqi.token?console.log("✅ Token recibido:",window.Culqi.token.id):window.Culqi.order?console.log("✅ Orden recibida:",window.Culqi.order):console.error("❌ Error en Culqi:",window.Culqi.error)}},document.body.appendChild(m),()=>{document.body.removeChild(m)}},[]),e.jsx("div",{className:"min-h-screen  py-12 px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white   p-8 rounded-xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:`text-sm ${i===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"1. Carrito de compra"}),e.jsx("div",{className:`text-sm ${i===2?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"2. Detalles de envío"}),e.jsx("div",{className:`text-sm ${i===3?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"3. Orden confirmada"})]}),e.jsx("div",{className:"mt-4 h-1 max-w-3xl mx-auto bg-gray-200",children:e.jsx("div",{className:"h-1 bg-primary transition-all duration-500",style:{width:`${(i-1)/2*100}%`}})})]}),i===1&&e.jsx(Ie,{cart:o,setCart:l,onContinue:()=>x(2),subTotal:g,envio:d,igv:f,totalFinal:n}),i===2&&e.jsx(Je,{setCode:E,setDelivery:_,cart:o,setSale:C,setCart:l,onContinue:()=>x(3),noContinue:()=>x(1),subTotal:g,envio:d,setEnvio:h,igv:f,totalFinal:n,user:r}),i===3&&e.jsx(Ke,{code:t,delivery:O,cart:N,subTotal:g,envio:d,igv:f,totalFinal:n})]})})}export{Pt as default};
