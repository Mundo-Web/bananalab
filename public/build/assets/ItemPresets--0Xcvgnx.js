import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as $}from"./Base-iD3WjR8i.js";import{S as _}from"./SwitchFormGroup-zwNBvRf7.js";import{T as D}from"./TextareaFormGroup-CdwdsTk2.js";import{r as i}from"./index-BH53Isel.js";import{c as L}from"./ReactAppend-DTVVXReZ.js";import"./DxBox-CTFD8z_X.js";import{S as u}from"./ProductCard-Bvp3XiVT.js";import{I as V}from"./ItemPresetsRest-Dmbx2fkO.js";import{M as H}from"./Modal-BJ3DTV_x.js";import{T as K}from"./Table-cP0w99G1.js";import{I as Q}from"./ImageFormGroup-Dx5myhwn.js";import{I as N}from"./InputFormGroup-D5I6zpZc.js";import"./main-BvVILmTO.js";import{S as W}from"./SelectFormGroup-BPkIDnvX.js";import{D as B}from"./DxButton-CsjWvhyj.js";import{C as X}from"./CreateReactScript-DSwc0KqF.js";import{N as O}from"./Number2Currency-e57Tgsuk.js";import{R as p}from"./ReactAppend-D7S498fx.js";import{S as k}from"./SetSelectValue-UxyCmHse.js";import"./index-yBjzXJbu.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-LH3dzJpV.js";import"./MenuItemContainer-BwGvRAHs.js";import"./index.esm-CveLAcri.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./ModalImportItem-edN7nyz1.js";/* empty css               */import"./General-BmbBKdsB.js";const R=new V,Y=({items:h})=>{var C;const[E,M]=i.useState([]),o=i.useRef(),S=i.useRef(),f=i.useRef(),c=i.useRef(),x=i.useRef(),v=i.useRef(),l=i.useRef(),a=i.useRef(),P=i.useRef(),g=i.useRef(),m=i.useRef(),w=i.useRef(),[y,G]=i.useState(!1),[Z,ee]=i.useState(null),[d,A]=i.useState(()=>new URLSearchParams(window.location.search).get("item_id"));i.useEffect(()=>{o.current&&o.current.instance.refresh()},[E]),i.useEffect(()=>{d&&c.current&&k(c.current,d)},[d]);const F=e=>{G(!!(e!=null&&e.id)),f.current&&(f.current.value=(e==null?void 0:e.id)||""),x.current&&(x.current.value=(e==null?void 0:e.name)||""),v.current&&(v.current.value=(e==null?void 0:e.description)||""),l.current&&(l.current.value=(e==null?void 0:e.price)||""),a.current&&(a.current.value=(e==null?void 0:e.discount)||0),g.current&&(g.current.value=(e==null?void 0:e.sort_order)||0),m.current&&(m.current.value=e!=null&&e.configuration?JSON.stringify(e.configuration,null,2):"");const t=(e==null?void 0:e.item_id)||d;c.current&&t&&k(c.current,t),w.current&&(w.current.checked=(e==null?void 0:e.is_active)!==!1),S.current.show()},J=async e=>{var t,s,j,b,I,T;e.preventDefault();try{if(!((t=c.current)!=null&&t.value))throw new Error("Debe seleccionar un producto");if(!((j=(s=x.current)==null?void 0:s.value)!=null&&j.trim()))throw new Error("El nombre es obligatorio");if(!((b=l.current)!=null&&b.value)||isNaN(parseFloat(l.current.value)))throw new Error("El precio debe ser un número válido");if(parseFloat(l.current.value)<0)throw new Error("El precio no puede ser negativo");if((I=a.current)!=null&&I.value&&(isNaN(parseFloat(a.current.value))||parseFloat(a.current.value)<0))throw new Error("El descuento debe ser un número válido mayor o igual a 0");const n=new FormData;if((T=f.current)!=null&&T.value&&n.append("id",f.current.value),n.append("item_id",c.current.value),n.append("name",x.current.value.trim()),n.append("description",v.current.value||""),n.append("price",l.current.value),n.append("discount",a.current.value||0),n.append("sort_order",g.current.value||0),n.append("is_active",w.current.checked?1:0),m.current.value.trim())try{JSON.parse(m.current.value),n.append("configuration",m.current.value)}catch{throw new Error("La configuración debe ser un JSON válido")}P.current.files[0]&&n.append("image",P.current.files[0]),await R.save(n),S.current.hide(),o.current.instance.refresh(),u.fire({title:"¡Éxito!",text:`Preset ${y?"actualizado":"creado"} correctamente`,icon:"success",timer:2e3})}catch(n){u.fire({title:"Error",text:n.message||"Error al guardar el preset",icon:"error"})}},z=async({id:e,value:t})=>{try{await R.toggleStatus(e),o.current.instance.refresh(),u.fire({title:"¡Éxito!",text:`Preset ${t?"activado":"desactivado"} correctamente`,icon:"success",timer:2e3})}catch{u.fire({title:"Error",text:"Error al cambiar el estado del preset",icon:"error"})}},q=async e=>{if((await u.fire({title:"¿Estás seguro?",text:"Esta acción eliminará permanentemente el preset",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{await R.delete(e),o.current.instance.refresh(),u.fire({title:"¡Eliminado!",text:"El preset ha sido eliminado correctamente",icon:"success",timer:2e3})}catch{u.fire({title:"Error",text:"Error al eliminar el preset",icon:"error"})}},U=[{dataField:"image",caption:"Imagen",width:80,allowFiltering:!1,allowSorting:!1,cellTemplate:(e,t)=>{const s=t.value?`/storage/${t.value}`:"/lte/assets/images/placeholder.png";p(e,r.jsx("img",{src:s,alt:"Preset",style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px"}}))}},{dataField:"name",caption:"Nombre"},{dataField:"item.name",caption:"Producto"},{dataField:"price",caption:"Precio",cellTemplate:(e,t)=>{p(e,O(t.value))}},{dataField:"discount",caption:"Descuento (%)",cellTemplate:(e,t)=>{const s=t.value||0;p(e,r.jsxs("span",{className:s>0?"text-warning fw-bold":"text-muted",children:[s,"%"]}))}},{dataField:"final_price",caption:"Precio Final",cellTemplate:(e,t)=>{const s=t.data.price||0,j=t.data.discount||0,b=s-s*(j/100);p(e,r.jsx("span",{className:"fw-bold text-success",children:O(b)}))}},{dataField:"sort_order",caption:"Orden",width:80},{dataField:"is_active",caption:"Estado",width:100,cellTemplate:(e,t)=>{p(e,r.jsx(_,{value:t.value,onChange:s=>z({id:t.data.id,value:s})}))}},{caption:"Acciones",width:120,allowFiltering:!1,allowSorting:!1,cellTemplate:(e,t)=>{p(e,r.jsxs("div",{className:"d-flex gap-1",children:[r.jsx(B,{text:"",icon:"edit",type:"default",stylingMode:"text",onClick:()=>F(t.data),hint:"Editar"}),r.jsx(B,{text:"",icon:"trash",type:"danger",stylingMode:"text",onClick:()=>q(t.data.id),hint:"Eliminar"})]}))}}];return r.jsxs($,{title:"Gestión de Presets",breadcrumbs:[{text:"Panel",href:"/admin"},{text:"Presets de Álbumes",active:!0}],children:[r.jsx("div",{className:"row",children:r.jsx("div",{className:"col-12",children:r.jsx("div",{className:"card",children:r.jsxs("div",{className:"card-body",children:[d&&r.jsxs("div",{className:"alert alert-info",role:"alert",children:[r.jsx("i",{className:"mdi mdi-information me-2"}),"Mostrando presets para el producto: ",r.jsx("strong",{children:((C=h.find(e=>e.id===d))==null?void 0:C.name)||"Producto seleccionado"}),r.jsx("button",{type:"button",className:"btn-close float-end",onClick:()=>{var e;A(null),window.history.replaceState(null,"","/admin/item-presets"),(e=o.current)==null||e.instance.refresh()}})]}),r.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[r.jsx("h4",{className:"header-title",children:"Presets de Álbumes"}),r.jsxs("button",{className:"btn btn-primary",onClick:()=>F(),children:[r.jsx("i",{className:"mdi mdi-plus me-2"}),"Nuevo Preset"]})]}),r.jsx(K,{ref:o,rest:R,columns:U,exports:["pdf","xlsx"],allowColumnReordering:!0,allowColumnResizing:!0,showBorders:!0,rowAlternationEnabled:!0})]})})})}),r.jsxs(H,{ref:S,title:y?"Editar Preset":"Nuevo Preset",size:"lg",onSubmit:J,children:[r.jsx("input",{ref:f,type:"hidden",name:"id"}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-6",children:r.jsx(W,{ref:c,name:"item_id",label:"Producto",required:!0,options:h.map(e=>({value:e.id,text:e.name}))})}),r.jsx("div",{className:"col-md-6",children:r.jsx(N,{ref:x,name:"name",label:"Nombre del Preset",placeholder:"Ej: Álbum Premium 30x30",required:!0})})]}),r.jsx(D,{ref:v,name:"description",label:"Descripción",placeholder:"Descripción del preset...",rows:3}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-md-4",children:r.jsx(N,{ref:l,name:"price",label:"Precio",type:"number",step:"0.01",min:"0",required:!0})}),r.jsx("div",{className:"col-md-4",children:r.jsx(N,{ref:a,name:"discount",label:"Descuento (%)",type:"number",step:"0.01",min:"0",max:"100"})}),r.jsx("div",{className:"col-md-4",children:r.jsx(N,{ref:g,name:"sort_order",label:"Orden",type:"number",min:"0"})})]}),r.jsx(Q,{ref:P,name:"image",label:"Imagen del Preset",accept:"image/*"}),r.jsx(D,{ref:m,name:"configuration",label:"Configuración (JSON)",placeholder:'{"pages": 20, "cover_type": "hard", "size": "30x30"}',rows:4,help:"Configuración adicional en formato JSON (opcional)"}),r.jsx(_,{ref:w,name:"is_active",label:"Preset Activo",defaultChecked:!0})]})]})};X((h,E)=>{L.createRoot(h).render(r.jsx(Y,{...E}))});
