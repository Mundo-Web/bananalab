var C=Object.defineProperty;var y=(n,i,l)=>i in n?C(n,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[i]=l;var h=(n,i,l)=>y(n,typeof i!="symbol"?i+"":i,l);import{j as t}from"./AboutSimple-Cf8x2fCZ.js";import{r as s}from"./index-BH53Isel.js";import{c as N}from"./ReactAppend-DTVVXReZ.js";import{B}from"./Base-DTCj5N6s.js";import{C as M}from"./CreateReactScript-C53VDHBb.js";import{M as A}from"./Modal-BJ3DTV_x.js";import{T as I}from"./Table-CP679pea.js";import{I as c}from"./InputFormGroup-D5I6zpZc.js";import{R as g}from"./ReactAppend-D7S498fx.js";import{D as T}from"./DxButton-CsjWvhyj.js";import{S as G}from"./SwitchFormGroup-DUGhyqoj.js";import{I as H}from"./ImageFormGroup-Dx5myhwn.js";import{S}from"./ProductCard-C2H10lUi.js";import{B as L}from"./ModalImportItem-Cjgn8e-W.js";import{s as b}from"./DxBox-CTFD8z_X.js";import{T as V}from"./TextareaFormGroup-CdwdsTk2.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./Global-BM4Id4Pw.js";import"./tippy-react.esm-BWiGTO87.js";import"./index-rimy3MAc.js";/* empty css              */import"./Logout-CGCqvje3.js";import"./main-BSEyQEJW.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./MenuItemContainer-BkmzVQNY.js";import"./index.esm-BE8-iLxT.js";/* empty css               */import"./General-BmbBKdsB.js";class q extends L{constructor(){super(...arguments);h(this,"path","admin/ads");h(this,"hasFiles",!0)}}const m=new q,O=()=>{const n=s.useRef(),i=s.useRef(),l=s.useRef(),u=s.useRef(),d=s.useRef(),a=s.useRef(),p=s.useRef(),f=s.useRef(),x=s.useRef(),[D,R]=s.useState(!1),[P,W]=s.useState(null),[z,J]=s.useState(!1),v=e=>{e!=null&&e.id?R(!0):R(!1),l.current.value=(e==null?void 0:e.id)??"",u.current.value=(e==null?void 0:e.name)??"",d.current.value=(e==null?void 0:e.alt_text)??"",a.image.src=`/storage/images/ad/${e==null?void 0:e.image}`,a.current.value=null,p.current.value=e!=null&&e.start_date?e.start_date.split("T")[0]:"",f.current.value=e!=null&&e.end_date?e.end_date.split("T")[0]:"",x.current.value=(e==null?void 0:e.target_url)??"",$(i.current).modal("show")},F=async e=>{e.preventDefault();try{const r={id:l.current.value||void 0,name:u.current.value,alt_text:d.current.value,start_date:p.current.value,end_date:f.current.value,target_url:x.current.value},o=new FormData;for(const _ in r)o.append(_,r[_]);const j=a.current.files[0];j&&o.append("image",j);const w=await m.save(o);if(console.log(w),!w)return;console.log("Refrescando tabla..."),$(n.current).dxDataGrid("instance").refresh(),console.log("Cerrando modal..."),$(i.current).modal("hide")}catch(r){console.error("Error al enviar el formulario:",r),S.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, inténtalo de nuevo."})}},k=async({id:e,value:r})=>{await m.boolean({id:e,field:"visible",value:r})&&$(n.current).dxDataGrid("instance").refresh()},E=async e=>{const{isConfirmed:r}=await S.fire({title:"Eliminar anuncio",text:"¿Estás seguro de eliminar este anuncio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await m.delete(e)||$(n.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(I,{gridRef:n,title:"Anuncios",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Nuevo anuncio",hint:"Nuevo anuncio",onClick:()=>v()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"image",caption:"Imagen",width:"60px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{g(e,t.jsx("img",{src:`/storage/images/ad/${r.image}`,style:{width:"50px",aspectRatio:1,objectFit:"contain",objectPosition:"center",borderRadius:"4px"},onError:o=>o.target.src="/api/cover/thumbnail/null"}))}},{dataField:"name",caption:"Contenido",width:"50%",cellTemplate:(e,{data:r})=>{g(e,r.name||r.description?t.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[t.jsx("b",{className:"d-block",children:r.name}),t.jsx("small",{className:"text-wrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:r.description})]}):t.jsx("i",{className:"text-muted",children:"- Sin contenido textual -"}))}},{dataField:"start_date",caption:"Mostrar",cellTemplate:(e,{data:r})=>{e.html(b.renderToString(t.jsx(t.Fragment,{children:r.start_date&&r.end_date?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"mb-0",children:[t.jsx("b",{children:"Desde:"})," ",moment(r.start_date).format("DD [de] MMMM")]}),t.jsxs("p",{className:"mb-0",children:[t.jsx("b",{children:"Hasta:"})," ",moment(r.end_date).format("DD [de] MMMM")]})]}):t.jsxs("p",{className:"mb-0",children:[t.jsx("b",{children:"Visible:"})," Siempre"]})})))}},{dataField:"target_url",caption:"Link",cellTemplate:(e,{data:r})=>{r.target_url?e.html(b.renderToString(t.jsx("a",{href:r.target_url,children:r.target_url}))):e.html(b.renderToString(t.jsx("i",{className:"text-muted",children:"- Sin link -"})))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"120px",cellTemplate:(e,{data:r})=>{g(e,t.jsx(G,{checked:r.visible,onChange:o=>k({id:r.id,value:o.target.checked})}))}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(T({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>v(r)})),e.append(T({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>E(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(A,{modalRef:i,title:D?"Editar anuncio":"Agregar anuncio",onSubmit:F,size:"lg",children:t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:l,type:"hidden"}),t.jsx(H,{eRef:a,label:"Imagen",col:"col-md-5",aspect:1,fit:"contain",required:!0}),t.jsxs("div",{className:"col-md-7",children:[t.jsx(c,{eRef:u,label:"Título",rows:1}),t.jsx(V,{eRef:d,label:"Texto Alternativo",placeholder:"Descripción de la imagen",rows:2}),t.jsx(c,{eRef:p,label:"Desde",type:"date",col:"col-md-12"}),t.jsx(c,{eRef:f,label:"Hasta",type:"date",col:"col-md-12"}),t.jsx(c,{eRef:x,label:"Link"})]})]})})]})};M((n,i)=>{N.createRoot(n).render(t.jsx(B,{...i,title:"Anuncios",children:t.jsx(O,{...i})}))});
