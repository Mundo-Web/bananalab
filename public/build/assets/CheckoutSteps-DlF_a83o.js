import{j as e}from"./AboutSimple-Cf8x2fCZ.js";import{r as m}from"./index-BOnQTV8N.js";import{N as b}from"./Number2Currency-e57Tgsuk.js";import{m as M}from"./main-Bp3JhiuO.js";import{G as H}from"./Global-BM4Id4Pw.js";import{B as oe,a as he,D as _e}from"./DeliveryPricesRest-CepPhj8K.js";import{C as Me}from"./CardItem-CdbVCrTF.js";import{u as ae,S as re}from"./SelectForm-CoB1IHa7.js";import{t as ne}from"./CheckoutSteps-U9TA5fNk.js";import{I as A}from"./InputForm-BW2Lnisr.js";import{X as $e}from"./x-fof_H3Vv.js";import{C as R}from"./circle-check-big-CYWUGR3Z.js";import{c as Z}from"./createLucideIcon-DfjclApS.js";import{C as Y}from"./chevron-right-Cug7tVUE.js";import{U as X}from"./upload-GO9GDST_.js";import{C as xe}from"./chevron-left-JcR9Fe4w.js";import{C as W}from"./copy-BnGV3h9k.js";import{B as ge}from"./building-2-DSFvhCB-.js";import{S as fe}from"./smartphone-BHF2PZKl.js";import{C as qe}from"./check-D5vaIe6v.js";import"./index-yBjzXJbu.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./___vite-browser-external_commonjs-proxy-DDYoOVPM.js";import"./book-C1IPlXSj.js";import"./minus-Db6MFKEO.js";import"./plus-CTIomuuF.js";import"./trash-2-DU7LB6-f.js";import"./chevron-down-uIVDLcM-.js";import"./search-BQ59Robe.js";import"./index-DE3dzT5W.js";import"./index-fNjTmf9T.js";/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Z("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=Z("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=Z("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=Z("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function Fe({cart:c,setCart:r,onContinue:o,subTotal:i,envio:d,igv:f,totalFinal:x}){console.log("üõí CartStep: Cart received:",c);const g=l=>{typeof l=="function"?r(n=>{const y=l(n);return M.Local.set(`${H.APP_CORRELATIVE}_cart`,y),console.log("üõí CartStep: Carrito actualizado en localStorage:",y.length,"items"),y}):(r(l),M.Local.set(`${H.APP_CORRELATIVE}_cart`,l),console.log("üõí CartStep: Carrito actualizado en localStorage:",l.length,"items"))},S=c.reduce((l,n)=>{const y=n.price||0,N=n.final_price||n.price||0,s=n.quantity||1;return y>N?l+(y-N)*s:l},0);return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"space-y-6",children:c.map((l,n)=>e.jsx(Me,{...l,setCart:g},n))})}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsxs("div",{className:"space-y-4",children:[S>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",b(S)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(i)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(f)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(d)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",b(x)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(oe,{onClick:o,children:"  Continuar"}),e.jsx(he,{href:"/",children:" Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los¬†",e.jsx("a",{className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra¬†",e.jsx("a",{className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]})]})}function Ae(){let c="";for(let r=0;r<12;r++){const o=Math.floor(Math.random()*10);c+=o}return c}const Re=c=>new Promise((r,o)=>{try{console.log(c);const i=Ae(c.email);console.log(i),window.Culqi.publicKey="pk_test_f4d42a7b5073e8df",window.Culqi.settings({title:"Sala Fabulosa",email:c.email,currency:"PEN",amount:c.amount*100,order:`${i}`}),console.log(window.Culqi.settings),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!0,bancaMovil:!0,agente:!0,billetera:!0,cuotealo:!0},style:{logo:"/assets/resources/logo.png",bannerColor:"#311609",buttonBackground:"#311609"}}),window.Culqi.open(),window.culqi=async function(){try{if(!window.Culqi.token){o("No se obtuvo un token de Culqi");return}const d=window.Culqi.token.id;console.log("‚úÖ Token generado:",d),c={...c,token:d,orderNumber:i},console.log("_request actualizado",c);const{status:f,result:x}=await M.Fetch("./api/pago",{method:"POST",body:JSON.stringify(c)});f||console.log((x==null?void 0:x.message)||"Error en el pago"),window.Culqi.close(),M.Notify.add({icon:"/assets/img/icon.svg",title:"Pago Exitoso",body:"El pago se proces√≥ correctamente.",type:"success"}),r(x)}catch(d){M.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Pago",body:d.message,type:"danger"}),o(d.message||"Error en el pago")}},document.addEventListener("culqi.error",function(d){var f,x;M.Notify.add({icon:"/assets/img/icon.svg",title:"Error en Culqi",body:((f=d.detail)==null?void 0:f.message)||"Error desconocido",type:"danger"}),o(((x=d.detail)==null?void 0:x.message)||"Error desconocido")})}catch(i){M.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"}),o("Error en la integraci√≥n con Culqi")}});class Le{constructor(){this.baseURL="/api/payments"}async getPaymentMethods(){try{const r=await fetch(`${this.baseURL}/methods`),o=await r.json();if(!r.ok)throw new Error((o==null?void 0:o.message)??"Error obteniendo m√©todos de pago");return o}catch(r){throw console.error("Error fetching payment methods:",r),r}}async processPayment(r,o=null){var i;try{this.validatePaymentData(r);const d=new FormData;Object.keys(r).forEach(g=>{r[g]!==null&&r[g]!==void 0&&(typeof r[g]=="object"&&g!=="cart"||g==="cart"&&Array.isArray(r[g])?d.append(g,JSON.stringify(r[g])):d.append(g,r[g]))}),o&&d.append("payment_proof",o);const f=await fetch(`${this.baseURL}/process`,{method:"POST",headers:{"X-CSRF-TOKEN":(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content")},body:d}),x=await f.json();if(!f.ok)throw new Error((x==null?void 0:x.message)??"Error procesando el pago");return x}catch(d){throw console.error("Error processing payment:",d),d}}validatePaymentData(r){const i=["user_id","amount","cart","email","name","lastname","department","province","district","address","reference","payment_method"].filter(f=>!r[f]);if(i.length>0)throw new Error(`Campos requeridos faltantes: ${i.join(", ")}`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email))throw new Error("Email no v√°lido");if(isNaN(r.amount)||r.amount<=0)throw new Error("Monto no v√°lido");if(!Array.isArray(r.cart)||r.cart.length===0)throw new Error("Carrito vac√≠o o no v√°lido");return!0}calculateFee(r,o=0,i=0){const f=r*o/100+i;return Math.round(f*100)/100}formatAmountWithFees(r,o){if(!o)return{total:r,fee:0};const i=this.calculateFee(r,o.fee_percentage,o.fee_fixed),d=r+i;return{original:r,fee:i,total:d}}showSuccessNotification(r="Pago procesado exitosamente"){ne.success("Pago Exitoso",{description:r,duration:4e3})}showErrorNotification(r="Error procesando el pago"){ne.error("Error en el Pago",{description:r,duration:5e3})}}const L=new Le,Oe=async c=>{var r;try{const o=await fetch("/api/mercadopago/preference",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content")},body:JSON.stringify(c)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const i=await o.json();return i.status&&i.redirect_url&&(ne.info("Redirigiendo a MercadoPago",{description:"Te estamos redirigiendo al checkout seguro de MercadoPago...",duration:1500}),setTimeout(()=>{window.location.href=i.redirect_url},1500)),i}catch(o){throw console.error("Error processing MercadoPago payment:",o),o}},ue=({title:c,description:r,selected:o,onSelect:i,disabled:d})=>e.jsxs("div",{className:`flex w-full items-center gap-3 p-4 border rounded-xl cursor-pointer transition-all duration-300 customtext-neutral-dark 
                }`,onClick:i,children:[e.jsx("div",{className:`w-5 h-5 border-2 rounded-full flex items-center justify-center ${o?"border-primary":""}`,children:o&&e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"})}),e.jsxs("div",{className:"customtext-neutral-light",children:[e.jsx("h4",{className:"text-sm ",children:c}),e.jsx("p",{className:"text-xs",children:r})]})]});function Ie({isOpen:c,onClose:r,paymentMethod:o,amount:i,onPaymentSuccess:d,onFileUpload:f,paymentProof:x,checkoutData:g}){const[S,l]=m.useState(1),[n,y]=m.useState([]),[N,s]=m.useState(!1),[P,I]=m.useState(!1);if(!c||!o)return null;const q=v=>{switch(v){case"gateway":return e.jsx(O,{size:24,className:"text-blue-600"});case"qr":return e.jsx(fe,{size:24,className:"text-purple-600"});case"manual":return e.jsx(ge,{size:24,className:"text-green-600"});default:return e.jsx(O,{size:24,className:"text-gray-600"})}},u=(v=>{switch(v){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}})(o.type),p=o.configuration||{},z=o.instructions||{},C=v=>{if(!v)return"";const w={phone_number:p.phone_number||p.phone||"",amount:`S/ ${b(i)}`,bank_name:p.bank_name||"",account_number:p.account_number||"",cci:p.cci||"",holder_name:p.holder_name||""};let k=v;return Object.entries(w).forEach(([V,J])=>{const ee=new RegExp(`{{\\s*${V}\\s*}}`,"g");k=k.replace(ee,J)}),k},_=async()=>{var v;try{I(!0),console.log("Iniciando proceso de pago MercadoPago...");const w=await fetch("http://localhost:8000/api/mercadopago/preference",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content"))||""},body:JSON.stringify({amount:i,title:"Compra BananaLab",description:"Productos BananaLab",checkout_data:g})});if(!w.ok)throw new Error(`Error ${w.status}: ${w.statusText}`);const k=await w.json();if(console.log("Preferencia creada:",k),k.status&&(k.init_point||k.sandbox_init_point)){const V=k.sandbox_init_point||k.init_point,J=!!k.sandbox_init_point;console.log(`Redirigiendo a MercadoPago (${J?"SANDBOX":"PRODUCCI√ìN"}):`,V),window.location.href=V}else throw new Error(k.message||"Error al crear la preferencia de pago")}catch(w){console.error("Error en pago MercadoPago:",w),I(!1),alert("Error al procesar el pago: "+w.message)}},B=v=>{navigator.clipboard.writeText(v)},K=v=>{const w=v.target.files[0];w&&f&&f(w)},Q=()=>{y([...n,S]),l(S+1)},U=()=>{s(!0),setTimeout(()=>{d(),r()},2e3)},D=()=>{const v=S;if(o.slug==="mercadopago"&&o.type==="gateway"&&v===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${u}-100 rounded-full mb-4`,children:q(o.type)}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Pago con ",o.name]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Ser√°s redirigido a MercadoPago para completar tu pago de forma segura"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",b(i)]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Pago 100% seguro con encriptaci√≥n SSL"})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Acepta tarjetas de cr√©dito, d√©bito y otros m√©todos"})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{size:20,className:"text-green-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Confirmaci√≥n inmediata del pago"})]})]}),e.jsx("button",{onClick:_,disabled:P,className:`w-full bg-${u}-600 hover:bg-${u}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:20}),e.jsx("span",{children:"Pagar con MercadoPago"}),e.jsx(Y,{size:20})]})})]});if(o.type==="qr"){if(v===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${u}-100 rounded-full mb-4`,children:q(o.type)}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Pago con ",o.name]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Escanea el c√≥digo QR con tu aplicaci√≥n m√≥vil"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",b(i)]})]})}),p.qr_image&&e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"inline-block p-4 bg-white border-2 border-gray-200 rounded-lg",children:e.jsx("img",{src:p.qr_image,alt:"C√≥digo QR",className:"w-48 h-48 mx-auto"})})}),z.step1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Te,{size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Instrucciones:"}),e.jsx("p",{className:"text-sm text-blue-800",children:C(z.step1)})]})]})}),e.jsxs("button",{onClick:Q,className:`w-full bg-${u}-600 hover:bg-${u}-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:[e.jsx("span",{children:"He realizado el pago"}),e.jsx(Y,{size:20})]})]});if(v===2)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${u}-100 rounded-full mb-4`,children:e.jsx(X,{size:24,className:`text-${u}-600`})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Comprobante de pago"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube tu comprobante para confirmar el pago"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"payment-proof",className:"hidden",accept:"image/*,.pdf",onChange:K}),e.jsxs("label",{htmlFor:"payment-proof",className:"cursor-pointer",children:[e.jsx(X,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para subir tu comprobante"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG o PDF (m√°x. 10MB)"})]})]}),x&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{size:20,className:"text-green-600"}),e.jsxs("span",{className:"text-green-800",children:["Comprobante subido: ",x.name]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>l(1),className:"flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",children:[e.jsx(xe,{size:20}),e.jsx("span",{children:"Volver"})]}),e.jsx("button",{onClick:U,disabled:!x||N,className:`flex-1 bg-${u}-600 hover:bg-${u}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Confirmar Pago"}),e.jsx(R,{size:20})]})})]})]})}if(o.type==="manual"){if(v===1)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${u}-100 rounded-full mb-4`,children:q(o.type)}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:o.name}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Realiza tu transferencia con los siguientes datos"})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-600",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["S/ ",b(i)]})]})}),e.jsxs("div",{className:"space-y-4",children:[p.bank_name&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Banco"}),e.jsx("p",{className:"font-medium text-gray-900",children:p.bank_name})]}),e.jsx("button",{onClick:()=>B(p.bank_name),className:"text-blue-600 hover:text-blue-700",children:e.jsx(W,{size:20})})]})}),p.account_number&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"N√∫mero de cuenta"}),e.jsx("p",{className:"font-medium text-gray-900",children:p.account_number})]}),e.jsx("button",{onClick:()=>B(p.account_number),className:"text-blue-600 hover:text-blue-700",children:e.jsx(W,{size:20})})]})}),p.cci&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"CCI"}),e.jsx("p",{className:"font-medium text-gray-900",children:p.cci})]}),e.jsx("button",{onClick:()=>B(p.cci),className:"text-blue-600 hover:text-blue-700",children:e.jsx(W,{size:20})})]})}),p.holder_name&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Titular"}),e.jsx("p",{className:"font-medium text-gray-900",children:p.holder_name})]}),e.jsx("button",{onClick:()=>B(p.holder_name),className:"text-blue-600 hover:text-blue-700",children:e.jsx(W,{size:20})})]})})]}),z.step1&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ze,{size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Instrucciones importantes:"}),e.jsx("p",{className:"text-sm text-blue-800",children:C(z.step1)})]})]})}),e.jsxs("button",{onClick:Q,className:`w-full bg-${u}-600 hover:bg-${u}-700 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:[e.jsx("span",{children:"He realizado la transferencia"}),e.jsx(Y,{size:20})]})]});if(v===2)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 bg-${u}-100 rounded-full mb-4`,children:e.jsx(X,{size:24,className:`text-${u}-600`})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Comprobante de transferencia"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube tu voucher para confirmar la transferencia"})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("input",{type:"file",id:"payment-proof",className:"hidden",accept:"image/*,.pdf",onChange:K}),e.jsxs("label",{htmlFor:"payment-proof",className:"cursor-pointer",children:[e.jsx(X,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Haz clic para subir tu voucher"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG o PDF (m√°x. 10MB)"})]})]}),x&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{size:20,className:"text-green-600"}),e.jsxs("span",{className:"text-green-800",children:["Voucher subido: ",x.name]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>l(1),className:"flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2",children:[e.jsx(xe,{size:20}),e.jsx("span",{children:"Volver"})]}),e.jsx("button",{onClick:U,disabled:!x||N,className:`flex-1 bg-${u}-600 hover:bg-${u}-700 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2`,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Confirmar Pago"}),e.jsx(R,{size:20})]})})]})]})}return null};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Proceso de Pago"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx($e,{size:24})})]}),e.jsx("div",{className:"p-6",children:D()})]})})}function Be({cart:c,setSale:r,setCode:o,setDelivery:i,setCart:d,onContinue:f,noContinue:x,subTotal:g,igv:S,totalFinal:l,user:n,setEnvio:y,envio:N}){const[s,P]=m.useState({name:(n==null?void 0:n.name)||"",lastname:(n==null?void 0:n.lastname)||"",email:(n==null?void 0:n.email)||"",department:(n==null?void 0:n.department)||"",province:(n==null?void 0:n.province)||"",district:(n==null?void 0:n.district)||"",address:(n==null?void 0:n.address)||"",number:(n==null?void 0:n.number)||"",comment:(n==null?void 0:n.comment)||"",reference:(n==null?void 0:n.reference)||"",shippingOption:"delivery",paymentMethod:"culqi"}),[I,q]=m.useState(null),[j,u]=m.useState(null),[p,z]=m.useState(0),[C,_]=m.useState([]),[B,K]=m.useState(!0),[Q,U]=m.useState(!1),[D,v]=m.useState(null),w=t=>{const{name:a,value:h}=t.target;P(E=>({...E,[a]:h}))},k=t=>{P(h=>({...h,paymentMethod:t}));const a=C.find(h=>h.slug===t);a&&!a.requires_proof&&(q(null),u(null))},V=()=>({user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",country:"Per√∫",department:$||"",province:T||"",district:F||"",ubigeo:null,address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",reference:(s==null?void 0:s.reference)||"",amount:l||0,delivery:N,cart:c,payment_method:s.paymentMethod,invoiceType:s.invoiceType,documentType:s.documentType,document:s.document,businessName:s.businessName}),J=()=>{const t=C.find(a=>a.slug===s.paymentMethod);t&&(v(t),U(!0))},ee=async()=>{const t={user_id:(n==null?void 0:n.id)||"",name:(s==null?void 0:s.name)||"",lastname:(s==null?void 0:s.lastname)||"",fullname:`${s==null?void 0:s.name} ${s==null?void 0:s.lastname}`,email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",country:"Per√∫",department:$||"",province:T||"",district:F||"",ubigeo:null,address:(s==null?void 0:s.address)||"",number:(s==null?void 0:s.number)||"",comment:(s==null?void 0:s.comment)||"",reference:(s==null?void 0:s.reference)||"",amount:l||0,delivery:N,cart:c,payment_method:s.paymentMethod,invoiceType:s.invoiceType,documentType:s.documentType,document:s.document,businessName:s.businessName};try{const a=C.find(E=>E.slug===s.paymentMethod);if(!a)throw new Error("M√©todo de pago no v√°lido");let h;if(a.type==="gateway")if(a.slug==="culqi"){if(!window.Culqi)throw new Error("Culqi a√∫n no se ha cargado.");h=await Re(t)}else a.slug==="mercadopago"?h=await Oe(t):h=await L.processPayment(t);else h=await L.processPayment(t,I);if(h&&h.status){r(h.sale),i(h.delivery),o(h.code),d([]),q(null),u(null);const E=a.type==="gateway"?"Pago procesado exitosamente":"Pedido creado. Te notificaremos cuando el pago sea verificado.";L.showSuccessNotification(E),f()}else throw new Error((h==null?void 0:h.message)||"Error procesando el pago")}catch(a){throw console.error("Error en el pago:",a),L.showErrorNotification(a.message||"Error procesando el pago"),a}},[$,je]=m.useState(""),[T,ie]=m.useState(""),[F,se]=m.useState(""),[be,ye]=m.useState([]),[Ne,ve]=m.useState([]),[we,le]=m.useState([]),[Ue,Je]=m.useState(0);m.useEffect(()=>{Ce()},[]);const Ce=async()=>{try{const t=await L.getPaymentMethods();t.status&&t.methods?(_(t.methods),t.methods.length>0&&P(a=>({...a,paymentMethod:t.methods[0].slug}))):(console.error("Error en respuesta de m√©todos de pago:",t),L.showErrorNotification("Error al cargar m√©todos de pago"))}catch(t){console.error("Error fetching payment methods:",t),L.showErrorNotification("No se pudieron cargar los m√©todos de pago")}finally{K(!1)}};m.useEffect(()=>{const t=[...new Set(ae.map(a=>a.departamento))];ye(t)},[]),m.useEffect(()=>{if($){const t=[...new Set(ae.filter(a=>a.departamento===$).map(a=>a.provincia))];ve(t),ie(""),se(""),le([]),P(a=>({...a,department:$,province:"",district:""}))}},[$]),m.useEffect(()=>{if(T){const t=ae.filter(a=>a.departamento===$&&a.provincia===T).map(a=>a.distrito);le(t),se(""),P(a=>({...a,province:T,district:""}))}},[T]),m.useEffect(()=>{F&&(P(a=>({...a,district:F})),(async()=>{try{const a=await _e.getShippingCost({department:$,district:F});y(a.data.price),b(a.data.price)>0?de("express"):de("free")}catch(a){console.error("Error fetching shipping cost:",a),alert("No se pudo obtener el costo de env√≠o.")}})())},[F]);const Se=async t=>{if(t.preventDefault(),!n){M.Notify.add({icon:"/assets/img/icon.svg",title:"Iniciar Sesi√≥n",body:"Se requiere que inicie sesi√≥n para realizar la compra",type:"danger"});return}if(!s.department||!s.province||!s.district||!s.name||!s.lastname||!s.email||!s.address||!s.reference){M.Notify.add({icon:"/assets/img/icon.svg",title:"Error en el Formulario",body:"Completar los datos de env√≠o",type:"danger"});return}J()},[ce,de]=m.useState("free"),me=(t,a)=>{switch(t){case"gateway":return e.jsx(O,{size:20});case"qr":return e.jsx(fe,{size:20});case"manual":return e.jsx(ge,{size:20});default:return e.jsx(O,{size:20})}},Pe=t=>{switch(t){case"gateway":return"blue";case"qr":return"purple";case"manual":return"green";default:return"gray"}};return e.jsxs("div",{className:"grid lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("form",{className:"space-y-6",onSubmit:t=>t.preventDefault(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{type:"text",label:"Nombres",name:"name",value:s.name,onChange:w,placeholder:"Nombres"}),e.jsx(A,{label:"Apellidos",type:"text",name:"lastname",value:s.lastname,onChange:w,placeholder:"Apellidos"})]}),e.jsx(A,{label:"Correo electr√≥nico",type:"email",name:"email",value:s.email,onChange:w,placeholder:"Ej. hola@gmail.com"}),e.jsx(re,{label:"Departamento",options:be,placeholder:"Selecciona un Departamento",onChange:t=>{je(t),P(a=>({...a,department:$}))}}),e.jsx(re,{disabled:!$,label:"Provincia",options:Ne,placeholder:"Selecciona una Provincia",onChange:t=>{ie(t),P(a=>({...a,province:T}))}}),e.jsx(re,{disabled:!T,label:"Distrito",options:we,placeholder:"Selecciona un Distrito",onChange:t=>{se(t),P(a=>({...a,district:F}))}}),e.jsx(A,{label:"Avenida / Calle / Jir√≥n",type:"text",name:"address",value:s.address,onChange:w,placeholder:"Ingresa el nombre de la calle"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{label:"N√∫mero",type:"text",name:"number",value:s.number,onChange:w,placeholder:"Ingresa el n√∫mero de la calle"}),e.jsx(A,{label:"Dpto./ Interior/ Piso/ Lote/ Bloque (opcional)",type:"text",name:"comment",value:s.comment,onChange:w,placeholder:"Ej. Casa 3, Dpto 101"})]}),e.jsx(A,{label:"Referencia",type:"text",name:"reference",value:s.reference,onChange:w,placeholder:"Ejem. Altura de la avenida..."}),"                    ",e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(O,{size:20,className:"text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"M√©todo de Pago"})]}),B?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Cargando m√©todos de pago..."})]}):C.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-xl",children:[e.jsx(O,{size:48,className:"mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No hay m√©todos de pago disponibles"})]}):e.jsx("div",{className:"space-y-3",children:C.map(t=>e.jsxs("div",{className:`group relative border-2 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:shadow-lg ${s.paymentMethod===t.slug?"border-primary bg-primary/5 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>k(t.slug),children:[s.paymentMethod===t.slug&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(qe,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-200 ${s.paymentMethod===t.slug?"bg-primary text-white shadow-lg":"bg-gray-100 group-hover:bg-gray-200"}`,children:t.icon?e.jsx("img",{src:t.icon,alt:t.name,className:"w-8 h-8 object-contain"}):me(t.type,t.slug)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.type==="gateway"?"bg-blue-100 text-blue-800":t.type==="qr"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:t.type==="gateway"?"Online":t.type==="qr"?"QR":"Manual"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),e.jsx("div",{className:"flex items-center gap-2 text-xs mt-1",children:t.fee_percentage>0||t.fee_fixed>0?e.jsxs("span",{className:"text-orange-600 font-medium",children:[t.fee_percentage>0&&`+${t.fee_percentage}%`,t.fee_percentage>0&&t.fee_fixed>0&&" ",t.fee_fixed>0&&`+S/ ${b(t.fee_fixed)}`]}):e.jsx("span",{className:"text-green-600 font-medium",children:"Sin comisi√≥n"})})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 transition-all duration-200 ${s.paymentMethod===t.slug?"border-primary bg-primary":"border-gray-300 group-hover:border-gray-400"}`,children:s.paymentMethod===t.slug&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]})]},t.slug))}),(()=>{const t=C.find(Ee=>Ee.slug===s.paymentMethod);if(!t)return null;const a=Pe(t.type),h=()=>a==="blue"?"bg-blue-50 border-blue-200":a==="purple"?"bg-purple-50 border-purple-200":a==="green"?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200",E=()=>a==="blue"?"bg-blue-100":a==="purple"?"bg-purple-100":a==="green"?"bg-green-100":"bg-gray-100",G=()=>a==="blue"?"text-blue-800":a==="purple"?"text-purple-800":a==="green"?"text-green-800":"text-gray-800",te=()=>a==="blue"?"text-blue-700":a==="purple"?"text-purple-700":a==="green"?"text-green-700":"text-gray-700",ke=()=>a==="blue"?"text-blue-600":a==="purple"?"text-purple-600":a==="green"?"text-green-600":"text-gray-600";return e.jsxs("div",{className:`border rounded-xl p-4 ${h()}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${E()}`,children:me(t.type,t.slug)}),e.jsxs("h4",{className:`font-semibold ${G()}`,children:[t.name," - ",t.type==="gateway"?"Pago Online":"Proceso Paso a Paso"]})]}),e.jsx("p",{className:`text-sm mb-3 ${te()}`,children:t.type==="gateway"?"Te redirigiremos al gateway de pago seguro para procesar tu transacci√≥n.":"Te guiaremos paso a paso para completar tu pago de forma f√°cil y segura."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16,className:ke()}),e.jsxs("span",{className:`text-sm font-medium ${G()}`,children:["Monto total: S/ ",b(l)]})]})]})})()]})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx(ue,{title:"Env√≠o gratis",description:"Entrega entre 3 a 10 d√≠as h√°biles",selected:ce==="free"}),e.jsx(ue,{title:"Delivery",description:"Delivery 24 horas",selected:ce==="express"})]}),e.jsxs("div",{className:"flex gap-4 mt-6 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(pe,{className:"customtext-primary",width:"20px"})}),e.jsxs("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:[e.jsx("p",{children:"Solo Lima Metropolitana: Dentro de las 24 horas despu√©s de efectuado el pago, solo algunos distritos de Lima Metropolitana."}),e.jsxs("p",{children:[" ","Distritos No incluidos: Santa Mar√≠a del Mar, Pucusana, San Bartolo, Punta Hermosa, Lur√≠n, Pachacamac, Chorrillos, Villa el Salvador, Villa Mar√≠a del Triunfo, San Juan de Miraflores, Cieneguilla, Ate, Chosica, Huaycan, San Juan de Lurigancho (hasta el Metro), Anc√≥n, Santa Rosa, Carabayllo, Puente Piedra."]}),e.jsxs("p",{children:[" ","Same Day: Solo para compras efectuadas hasta las 1pm del d√≠a."]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4 bg-[#F7F9FB] p-3 rounded-xl",children:[e.jsx("div",{className:"w-5",children:e.jsx(pe,{className:"customtext-primary",width:"20px"})}),e.jsx("div",{className:"text-xs font-medium customtext-neutral-dark flex flex-col gap-2",children:e.jsx("p",{children:"Lima: 3 a 4 dias h√°biles | Provincia: de 4 a 10 dias h√°biles"})})]})]}),e.jsxs("div",{className:"bg-[#F7F9FB] rounded-xl shadow-lg p-6 col-span-2 h-max",children:[e.jsx("h3",{className:"text-2xl font-bold pb-6",children:"Resumen de compra"}),e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:c.map((t,a)=>{var h,E;return e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl",children:e.jsx("img",{src:t.type==="custom_album"?`/storage/images/item_preset/${t.image}`:`/storage/images/item/${t.image}`,alt:t.name,className:"w-20 h-20 object-cover rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:t.name}),t.type==="custom_album"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Tipo:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:"√Ålbum Personalizado"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["P√°ginas:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:((h=t.album_data)==null?void 0:h.pages_count)||"N/A"})]})]}):e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:((E=t.brand)==null?void 0:E.name)||"Sin marca"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad:"," ",e.jsx("span",{className:"customtext-neutral-dark",children:t.quantity||1})]})]})]})},t.id)})}),e.jsxs("div",{className:"space-y-4 mt-6",children:[(()=>{const t=c.reduce((a,h)=>{const E=h.price||0,G=h.final_price||h.price||0,te=h.quantity||1;return E>G?a+(E-G)*te:a},0);return t>0?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Ahorros totales"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-S/ ",b(t)]})]}):null})(),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(g)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(S)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(N)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",b(l)]})]})}),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsx(oe,{onClick:Se,children:(()=>{const t=C.find(a=>a.slug===s.paymentMethod);if(!t)return"Continuar";switch(t.type){case"gateway":return`Pagar con ${t.name}`;case"qr":case"manual":return`Confirmar ${t.name}`;default:return"Continuar"}})()}),e.jsx(he,{onClick:x,children:"Cancelar"})]}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm customtext-neutral-dark",children:["Al realizar tu pedido, aceptas los",e.jsx("a",{className:"customtext-primary font-bold",children:"T√©rminos y Condiciones"}),", y que nosotros usaremos sus datos personales de acuerdo con nuestra",e.jsx("a",{className:"customtext-primary font-bold",children:"Pol√≠tica de Privacidad"}),"."]})})]})]}),e.jsx(Ie,{isOpen:Q,onClose:()=>U(!1),paymentMethod:D,amount:l,onPaymentSuccess:ee,checkoutData:V()})]})}function Ve({cart:c,code:r,delivery:o,sale:i}){console.log("üéâ ConfirmationStep: Mostrando confirmaci√≥n",{cart:c,code:r,delivery:o,sale:i});let d=c,f=0,x=o||0;i&&i.details&&i.details.length>0?(d=i.details.map(l=>{var n,y,N;return{id:l.item_id,name:l.name,image:((n=l.item)==null?void 0:n.image)||"default.jpg",price:l.price,final_price:l.price,quantity:l.quantity,brand:((y=l.item)==null?void 0:y.brand)||{name:"N/A"},sku:((N=l.item)==null?void 0:N.sku)||"N/A"}}),f=parseFloat(i.amount||0),x=parseFloat(i.delivery||0)):f=c.reduce((n,y)=>{const N=y.final_price;return n+N*y.quantity},0)+parseFloat(o||0);const g=((f-x)/1.18).toFixed(2),S=(g*.18).toFixed(2);return e.jsx("div",{className:"mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h2",{className:"text-[20px] customtext-neutral-light",children:"Gracias por tu compra üéâ"}),e.jsx("p",{className:"customtext-neutral-dark text-5xl font-semibold",children:"Tu orden ha sido recibida"}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:" customtext-neutral-light",children:"C√≥digo de pedido"}),e.jsx("div",{className:"customtext-neutral-dark text-lg font-semibold",children:`#${r}`})]}),e.jsxs("div",{className:"space-y-4 max-w-lg bg-[#F7F9FB] mx-auto p-8 rounded-xl",children:[e.jsx("div",{className:"space-y-6 border-b-2 pb-6",children:d.map((l,n)=>{var y;return e.jsx("div",{className:"rounded-lg",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl w-max",children:e.jsx("img",{src:l.image?`/storage/images/item/${l.image}`:"/assets/img/default-product.jpg",alt:l.name,className:"w-20 h-20 object-cover rounded",onError:N=>{N.target.src="/assets/img/default-product.jpg"}})}),e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"font-medium text-lg mb-2",children:l.name}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Marca: ",e.jsx("span",{className:"customtext-neutral-dark",children:((y=l.brand)==null?void 0:y.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Cantidad: ",e.jsx("span",{className:"customtext-neutral-dark",children:l.quantity})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["SKU: ",e.jsx("span",{className:"customtext-neutral-dark",children:l.sku||"N/A"})]}),e.jsxs("p",{className:"text-sm customtext-neutral-light",children:["Precio: ",e.jsxs("span",{className:"customtext-neutral-dark",children:["S/ ",b(l.price||l.final_price)]})]})]})]})},n)})}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(g)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"IGV"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(S)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"customtext-neutral-dark",children:"Env√≠o"}),e.jsxs("span",{className:"font-semibold",children:["S/ ",b(x)]})]}),e.jsx("div",{className:"py-3 border-y-2 mt-6",children:e.jsxs("div",{className:"flex justify-between font-bold text-[20px] items-center",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["S/ ",b(f)]})]})})]}),e.jsx("div",{className:"pt-3",children:e.jsx(oe,{href:"/catalogo",children:"  Seguir Comprando"})})]})]})})})}function vs({cart:c,setCart:r,user:o}){const[i,d]=m.useState(1);m.useEffect(()=>{const j=new URLSearchParams(window.location.search),u=j.get("step"),p=j.get("status"),z=j.get("payment_type"),C=j.get("order");console.log("üîç CheckoutSteps: Par√°metros URL detectados:",{step:u,status:p,paymentType:z,orderNumber:C}),u==="3"&&p==="success"&&z==="mercadopago"&&(console.log("‚úÖ CheckoutSteps: Pago exitoso de MercadoPago detectado, navegando al paso 3"),d(3),C&&(P(C),fetch(`/api/sales/by-code/${C}`).then(_=>_.json()).then(_=>{_.status&&_.sale?(console.log("‚úÖ Venta encontrada:",_.sale),N(_.sale),window.Notify&&window.Notify.add({icon:"/assets/img/icon.svg",title:"¬°Pago exitoso!",body:`Tu pago con MercadoPago ha sido procesado correctamente. Operaci√≥n: ${C}`,type:"success"}),r([]),M.Local.remove(`${H.APP_CORRELATIVE}_cart`)):console.warn("‚ö†Ô∏è Venta no encontrada para:",C)}).catch(_=>{console.error("‚ùå Error buscando venta:",_)})),window.history.replaceState({},document.title,window.location.pathname))},[]);const x=(c.reduce((j,u)=>{const p=u.final_price;return j+p*u.quantity},0)/1.18).toFixed(2),g=(x*.18).toFixed(2),[S,l]=m.useState(0),n=parseFloat(x)+parseFloat(g)+parseFloat(S),[y,N]=m.useState([]),[s,P]=m.useState([]),[I,q]=m.useState([]);return m.useEffect(()=>{console.log("üîÑ CheckoutSteps: Sincronizando carrito con localStorage...");const j=M.Local.get(`${H.APP_CORRELATIVE}_cart`)||[];console.log("üì¶ CheckoutSteps: Carrito desde localStorage:",j),j.length>0&&JSON.stringify(j)!==JSON.stringify(c)&&(console.log("‚úÖ CheckoutSteps: Actualizando carrito desde localStorage"),r(j))},[]),m.useEffect(()=>{const j=u=>{console.log("üì¢ CheckoutSteps: Carrito actualizado:",u.detail);const p=M.Local.get(`${H.APP_CORRELATIVE}_cart`)||[];console.log("üîÑ CheckoutSteps: Cargando carrito actualizado:",p),r(p)};return window.addEventListener("cartUpdated",j),()=>{window.removeEventListener("cartUpdated",j)}},[r]),m.useEffect(()=>{const j=document.createElement("script");return j.src="https://checkout.culqi.com/js/v4",j.async=!0,j.onload=()=>{console.log("‚úÖ Culqi cargado correctamente."),window.culqi=function(){window.Culqi.token?console.log("‚úÖ Token recibido:",window.Culqi.token.id):window.Culqi.order?console.log("‚úÖ Orden recibida:",window.Culqi.order):console.error("‚ùå Error en Culqi:",window.Culqi.error)}},document.body.appendChild(j),()=>{document.body.removeChild(j)}},[]),e.jsx("div",{className:"min-h-screen  py-12 px-primary 2xl:px-0 2xl:max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white   p-8 rounded-xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx("div",{className:`text-sm ${i===1?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"1. Carrito de compra"}),e.jsx("div",{className:`text-sm ${i===2?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"2. Detalles de env√≠o"}),e.jsx("div",{className:`text-sm ${i===3?"customtext-primary font-medium":"customtext-neutral-dark"}`,children:"3. Orden confirmada"})]}),e.jsx("div",{className:"mt-4 h-1 max-w-3xl mx-auto bg-gray-200",children:e.jsx("div",{className:"h-1 bg-primary transition-all duration-500",style:{width:`${(i-1)/2*100}%`}})})]}),i===1&&e.jsx(Fe,{cart:c,setCart:r,onContinue:()=>d(2),subTotal:x,envio:S,igv:g,totalFinal:n}),i===2&&e.jsx(Be,{setCode:P,setDelivery:q,cart:c,setSale:N,setCart:r,onContinue:()=>d(3),noContinue:()=>d(1),subTotal:x,envio:S,setEnvio:l,igv:g,totalFinal:n,user:o}),i===3&&e.jsx(Ve,{code:s,delivery:I,cart:c,sale:y,subTotal:x,envio:S,igv:g,totalFinal:n})]})})}export{vs as default};
